var ts=Object.defineProperty;var es=(at,f,z)=>f in at?ts(at,f,{enumerable:!0,configurable:!0,writable:!0,value:z}):at[f]=z;var Dt=(at,f,z)=>(es(at,typeof f!="symbol"?f+"":f,z),z),he=(at,f,z)=>{if(!f.has(at))throw TypeError("Cannot "+z)};var p=(at,f,z)=>(he(at,f,"read from private field"),z?z.call(at):f.get(at)),Q=(at,f,z)=>{if(f.has(at))throw TypeError("Cannot add the same private member more than once");f instanceof WeakSet?f.add(at):f.set(at,z)},pt=(at,f,z,g)=>(he(at,f,"write to private field"),g?g.call(at,z):f.set(at,z),z);var ie=(at,f,z,g)=>({set _(T){pt(at,f,T,z)},get _(){return p(at,f,g)}}),ot=(at,f,z)=>(he(at,f,"access private method"),z);import{a as api,g as getErrorMessage,b as getAugmentedNamespace}from"../chunks/axios.ee6f9f09.js";import{S as SvelteComponent,i as init,s as safe_not_equal,k as element,l as claim_element,m as children,h as detach,n as attr,p as set_style,b as insert_hydration,E as append_hydration,C as noop,o as onMount,T as onDestroy,w as binding_callbacks,a as space,e as empty,c as claim_space,g as transition_in,d as transition_out,q as text,r as claim_text,u as set_data,y as create_component,z as claim_component,A as mount_component,B as destroy_component}from"../chunks/index.4d0bcc0c.js";import{b as beforeNavigate}from"../chunks/navigation.f5cb4891.js";import{r as resetAll,C as ChatPanel,s as sendMessage}from"../chunks/ChatPanel.b04e21c2.js";const load=async({params:at})=>{try{const{data:{pdf:f,download_url:z}}=await api.get(`/pdfs/${at.id}`);return{document:f,documentUrl:z}}catch(f){return{error:getErrorMessage(f)}}},_page=Object.freeze(Object.defineProperty({__proto__:null,load},Symbol.toStringTag,{value:"Module"}));function commonjsRequire(at){throw new Error('Could not dynamically require "'+at+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var pdf={exports:{}};const __viteBrowserExternal={},__viteBrowserExternal$1=Object.freeze(Object.defineProperty({__proto__:null,default:__viteBrowserExternal},Symbol.toStringTag,{value:"Module"})),require$$5=getAugmentedNamespace(__viteBrowserExternal$1);(function(module,exports){(function(f,z){module.exports=z()})(globalThis,()=>(()=>{var __webpack_modules__=[,(at,f)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.VerbosityLevel=f.Util=f.UnknownErrorException=f.UnexpectedResponseException=f.TextRenderingMode=f.RenderingIntentFlag=f.PermissionFlag=f.PasswordResponses=f.PasswordException=f.PageActionEventType=f.OPS=f.MissingPDFException=f.MAX_IMAGE_SIZE_TO_CACHE=f.LINE_FACTOR=f.LINE_DESCENT_FACTOR=f.InvalidPDFException=f.ImageKind=f.IDENTITY_MATRIX=f.FormatError=f.FeatureTest=f.FONT_IDENTITY_MATRIX=f.DocumentActionEventType=f.CMapCompressionType=f.BaseException=f.BASELINE_FACTOR=f.AnnotationType=f.AnnotationStateModelType=f.AnnotationReviewState=f.AnnotationReplyType=f.AnnotationMode=f.AnnotationMarkedState=f.AnnotationFlag=f.AnnotationFieldFlag=f.AnnotationEditorType=f.AnnotationEditorPrefix=f.AnnotationEditorParamsType=f.AnnotationBorderStyleType=f.AnnotationActionEventType=f.AbortException=void 0,f.assert=yt,f.bytesToString=k,f.createPromiseCapability=Pt,f.createValidAbsoluteUrl=c,f.getModificationDate=At,f.getVerbosityLevel=ft,f.info=lt,f.isArrayBuffer=gt,f.isArrayEqual=Et,f.objectFromMap=E,f.objectSize=_,f.setVerbosityLevel=nt,f.shadow=h,f.string32=r,f.stringToBytes=e,f.stringToPDFString=dt,f.stringToUTF8String=ct,f.unreachable=bt,f.utf8StringToString=mt,f.warn=ut;const z=[1,0,0,1,0,0];f.IDENTITY_MATRIX=z;const g=[.001,0,0,.001,0,0];f.FONT_IDENTITY_MATRIX=g;const T=1e7;f.MAX_IMAGE_SIZE_TO_CACHE=T;const V=1.35;f.LINE_FACTOR=V;const q=.35;f.LINE_DESCENT_FACTOR=q;const et=q/V;f.BASELINE_FACTOR=et;const I={ANY:1,DISPLAY:2,PRINT:4,SAVE:8,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,OPLIST:256};f.RenderingIntentFlag=I;const S={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3};f.AnnotationMode=S;const b="pdfjs_internal_editor_";f.AnnotationEditorPrefix=b;const w={DISABLE:-1,NONE:0,FREETEXT:3,INK:15};f.AnnotationEditorType=w;const x={FREETEXT_SIZE:1,FREETEXT_COLOR:2,FREETEXT_OPACITY:3,INK_COLOR:11,INK_THICKNESS:12,INK_OPACITY:13};f.AnnotationEditorParamsType=x;const v={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048};f.PermissionFlag=v;const d={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4};f.TextRenderingMode=d;const m={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3};f.ImageKind=m;const s={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26};f.AnnotationType=s;const a={MARKED:"Marked",REVIEW:"Review"};f.AnnotationStateModelType=a;const F={MARKED:"Marked",UNMARKED:"Unmarked"};f.AnnotationMarkedState=F;const M={ACCEPTED:"Accepted",REJECTED:"Rejected",CANCELLED:"Cancelled",COMPLETED:"Completed",NONE:"None"};f.AnnotationReviewState=M;const A={GROUP:"Group",REPLY:"R"};f.AnnotationReplyType=A;const t={INVISIBLE:1,HIDDEN:2,PRINT:4,NOZOOM:8,NOROTATE:16,NOVIEW:32,READONLY:64,LOCKED:128,TOGGLENOVIEW:256,LOCKEDCONTENTS:512};f.AnnotationFlag=t;const l={READONLY:1,REQUIRED:2,NOEXPORT:4,MULTILINE:4096,PASSWORD:8192,NOTOGGLETOOFF:16384,RADIO:32768,PUSHBUTTON:65536,COMBO:131072,EDIT:262144,SORT:524288,FILESELECT:1048576,MULTISELECT:2097152,DONOTSPELLCHECK:4194304,DONOTSCROLL:8388608,COMB:16777216,RICHTEXT:33554432,RADIOSINUNISON:33554432,COMMITONSELCHANGE:67108864};f.AnnotationFieldFlag=l;const o={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5};f.AnnotationBorderStyleType=o;const n={E:"Mouse Enter",X:"Mouse Exit",D:"Mouse Down",U:"Mouse Up",Fo:"Focus",Bl:"Blur",PO:"PageOpen",PC:"PageClose",PV:"PageVisible",PI:"PageInvisible",K:"Keystroke",F:"Format",V:"Validate",C:"Calculate"};f.AnnotationActionEventType=n;const u={WC:"WillClose",WS:"WillSave",DS:"DidSave",WP:"WillPrint",DP:"DidPrint"};f.DocumentActionEventType=u;const C={O:"PageOpen",C:"PageClose"};f.PageActionEventType=C;const i={ERRORS:0,WARNINGS:1,INFOS:5};f.VerbosityLevel=i;const O={NONE:0,BINARY:1};f.CMapCompressionType=O;const X={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91};f.OPS=X;const Y={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};f.PasswordResponses=Y;let tt=i.WARNINGS;function nt(P){Number.isInteger(P)&&(tt=P)}function ft(){return tt}function lt(P){tt>=i.INFOS&&console.log(`Info: ${P}`)}function ut(P){tt>=i.WARNINGS&&console.log(`Warning: ${P}`)}function bt(P){throw new Error(P)}function yt(P,U){P||bt(U)}function W(P){if(!P)return!1;switch(P.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function c(P,U=null,B=null){if(!P)return null;try{if(B&&typeof P=="string"){if(B.addDefaultProtocol&&P.startsWith("www.")){const Ct=P.match(/\./g);Ct&&Ct.length>=2&&(P=`http://${P}`)}if(B.tryConvertEncoding)try{P=ct(P)}catch{}}const _t=U?new URL(P,U):new URL(P);if(W(_t))return _t}catch{}return null}function h(P,U,B,_t=!1){return Object.defineProperty(P,U,{value:B,enumerable:!_t,configurable:!0,writable:!1}),B}const y=function(){function U(B,_t){this.constructor===U&&bt("Cannot initialize BaseException."),this.message=B,this.name=_t}return U.prototype=new Error,U.constructor=U,U}();f.BaseException=y;class j extends y{constructor(U,B){super(U,"PasswordException"),this.code=B}}f.PasswordException=j;class R extends y{constructor(U,B){super(U,"UnknownErrorException"),this.details=B}}f.UnknownErrorException=R;class G extends y{constructor(U){super(U,"InvalidPDFException")}}f.InvalidPDFException=G;class H extends y{constructor(U){super(U,"MissingPDFException")}}f.MissingPDFException=H;class K extends y{constructor(U,B){super(U,"UnexpectedResponseException"),this.status=B}}f.UnexpectedResponseException=K;class $ extends y{constructor(U){super(U,"FormatError")}}f.FormatError=$;class L extends y{constructor(U){super(U,"AbortException")}}f.AbortException=L;function k(P){(typeof P!="object"||P===null||P.length===void 0)&&bt("Invalid argument for bytesToString");const U=P.length,B=8192;if(U<B)return String.fromCharCode.apply(null,P);const _t=[];for(let Ct=0;Ct<U;Ct+=B){const J=Math.min(Ct+B,U),ht=P.subarray(Ct,J);_t.push(String.fromCharCode.apply(null,ht))}return _t.join("")}function e(P){typeof P!="string"&&bt("Invalid argument for stringToBytes");const U=P.length,B=new Uint8Array(U);for(let _t=0;_t<U;++_t)B[_t]=P.charCodeAt(_t)&255;return B}function r(P){return String.fromCharCode(P>>24&255,P>>16&255,P>>8&255,P&255)}function _(P){return Object.keys(P).length}function E(P){const U=Object.create(null);for(const[B,_t]of P)U[B]=_t;return U}function D(){const P=new Uint8Array(4);return P[0]=1,new Uint32Array(P.buffer,0,1)[0]===1}function N(){try{return new Function(""),!0}catch{return!1}}class st{static get isLittleEndian(){return h(this,"isLittleEndian",D())}static get isEvalSupported(){return h(this,"isEvalSupported",N())}static get isOffscreenCanvasSupported(){return h(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get platform(){return typeof navigator>"u"?h(this,"platform",{isWin:!1,isMac:!1}):h(this,"platform",{isWin:navigator.platform.includes("Win"),isMac:navigator.platform.includes("Mac")})}}f.FeatureTest=st;const Z=[...Array(256).keys()].map(P=>P.toString(16).padStart(2,"0"));class it{static makeHexColor(U,B,_t){return`#${Z[U]}${Z[B]}${Z[_t]}`}static scaleMinMax(U,B){let _t;U[0]?(U[0]<0&&(_t=B[0],B[0]=B[1],B[1]=_t),B[0]*=U[0],B[1]*=U[0],U[3]<0&&(_t=B[2],B[2]=B[3],B[3]=_t),B[2]*=U[3],B[3]*=U[3]):(_t=B[0],B[0]=B[2],B[2]=_t,_t=B[1],B[1]=B[3],B[3]=_t,U[1]<0&&(_t=B[2],B[2]=B[3],B[3]=_t),B[2]*=U[1],B[3]*=U[1],U[2]<0&&(_t=B[0],B[0]=B[1],B[1]=_t),B[0]*=U[2],B[1]*=U[2]),B[0]+=U[4],B[1]+=U[4],B[2]+=U[5],B[3]+=U[5]}static transform(U,B){return[U[0]*B[0]+U[2]*B[1],U[1]*B[0]+U[3]*B[1],U[0]*B[2]+U[2]*B[3],U[1]*B[2]+U[3]*B[3],U[0]*B[4]+U[2]*B[5]+U[4],U[1]*B[4]+U[3]*B[5]+U[5]]}static applyTransform(U,B){const _t=U[0]*B[0]+U[1]*B[2]+B[4],Ct=U[0]*B[1]+U[1]*B[3]+B[5];return[_t,Ct]}static applyInverseTransform(U,B){const _t=B[0]*B[3]-B[1]*B[2],Ct=(U[0]*B[3]-U[1]*B[2]+B[2]*B[5]-B[4]*B[3])/_t,J=(-U[0]*B[1]+U[1]*B[0]+B[4]*B[1]-B[5]*B[0])/_t;return[Ct,J]}static getAxialAlignedBoundingBox(U,B){const _t=it.applyTransform(U,B),Ct=it.applyTransform(U.slice(2,4),B),J=it.applyTransform([U[0],U[3]],B),ht=it.applyTransform([U[2],U[1]],B);return[Math.min(_t[0],Ct[0],J[0],ht[0]),Math.min(_t[1],Ct[1],J[1],ht[1]),Math.max(_t[0],Ct[0],J[0],ht[0]),Math.max(_t[1],Ct[1],J[1],ht[1])]}static inverseTransform(U){const B=U[0]*U[3]-U[1]*U[2];return[U[3]/B,-U[1]/B,-U[2]/B,U[0]/B,(U[2]*U[5]-U[4]*U[3])/B,(U[4]*U[1]-U[5]*U[0])/B]}static singularValueDecompose2dScale(U){const B=[U[0],U[2],U[1],U[3]],_t=U[0]*B[0]+U[1]*B[2],Ct=U[0]*B[1]+U[1]*B[3],J=U[2]*B[0]+U[3]*B[2],ht=U[2]*B[1]+U[3]*B[3],vt=(_t+ht)/2,St=Math.sqrt((_t+ht)**2-4*(_t*ht-J*Ct))/2,Ft=vt+St||1,kt=vt-St||1;return[Math.sqrt(Ft),Math.sqrt(kt)]}static normalizeRect(U){const B=U.slice(0);return U[0]>U[2]&&(B[0]=U[2],B[2]=U[0]),U[1]>U[3]&&(B[1]=U[3],B[3]=U[1]),B}static intersect(U,B){const _t=Math.max(Math.min(U[0],U[2]),Math.min(B[0],B[2])),Ct=Math.min(Math.max(U[0],U[2]),Math.max(B[0],B[2]));if(_t>Ct)return null;const J=Math.max(Math.min(U[1],U[3]),Math.min(B[1],B[3])),ht=Math.min(Math.max(U[1],U[3]),Math.max(B[1],B[3]));return J>ht?null:[_t,J,Ct,ht]}static bezierBoundingBox(U,B,_t,Ct,J,ht,vt,St){const Ft=[],kt=[[],[]];let wt,xt,Rt,Tt,Nt,Mt,Ot,Lt;for(let Ht=0;Ht<2;++Ht){if(Ht===0?(xt=6*U-12*_t+6*J,wt=-3*U+9*_t-9*J+3*vt,Rt=3*_t-3*U):(xt=6*B-12*Ct+6*ht,wt=-3*B+9*Ct-9*ht+3*St,Rt=3*Ct-3*B),Math.abs(wt)<1e-12){if(Math.abs(xt)<1e-12)continue;Tt=-Rt/xt,0<Tt&&Tt<1&&Ft.push(Tt);continue}Ot=xt*xt-4*Rt*wt,Lt=Math.sqrt(Ot),!(Ot<0)&&(Nt=(-xt+Lt)/(2*wt),0<Nt&&Nt<1&&Ft.push(Nt),Mt=(-xt-Lt)/(2*wt),0<Mt&&Mt<1&&Ft.push(Mt))}let jt=Ft.length,It;const Bt=jt;for(;jt--;)Tt=Ft[jt],It=1-Tt,kt[0][jt]=It*It*It*U+3*It*It*Tt*_t+3*It*Tt*Tt*J+Tt*Tt*Tt*vt,kt[1][jt]=It*It*It*B+3*It*It*Tt*Ct+3*It*Tt*Tt*ht+Tt*Tt*Tt*St;return kt[0][Bt]=U,kt[1][Bt]=B,kt[0][Bt+1]=vt,kt[1][Bt+1]=St,kt[0].length=kt[1].length=Bt+2,[Math.min(...kt[0]),Math.min(...kt[1]),Math.max(...kt[0]),Math.max(...kt[1])]}}f.Util=it;const rt=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,728,711,710,729,733,731,730,732,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8226,8224,8225,8230,8212,8211,402,8260,8249,8250,8722,8240,8222,8220,8221,8216,8217,8218,8482,64257,64258,321,338,352,376,381,305,322,339,353,382,0,8364];function dt(P){if(P[0]>="ï"){let B;if(P[0]==="þ"&&P[1]==="ÿ"?B="utf-16be":P[0]==="ÿ"&&P[1]==="þ"?B="utf-16le":P[0]==="ï"&&P[1]==="»"&&P[2]==="¿"&&(B="utf-8"),B)try{const _t=new TextDecoder(B,{fatal:!0}),Ct=e(P);return _t.decode(Ct)}catch(_t){ut(`stringToPDFString: "${_t}".`)}}const U=[];for(let B=0,_t=P.length;B<_t;B++){const Ct=rt[P.charCodeAt(B)];U.push(Ct?String.fromCharCode(Ct):P.charAt(B))}return U.join("")}function ct(P){return decodeURIComponent(escape(P))}function mt(P){return unescape(encodeURIComponent(P))}function gt(P){return typeof P=="object"&&P!==null&&P.byteLength!==void 0}function Et(P,U){if(P.length!==U.length)return!1;for(let B=0,_t=P.length;B<_t;B++)if(P[B]!==U[B])return!1;return!0}function At(P=new Date){return[P.getUTCFullYear().toString(),(P.getUTCMonth()+1).toString().padStart(2,"0"),P.getUTCDate().toString().padStart(2,"0"),P.getUTCHours().toString().padStart(2,"0"),P.getUTCMinutes().toString().padStart(2,"0"),P.getUTCSeconds().toString().padStart(2,"0")].join("")}function Pt(){const P=Object.create(null);let U=!1;return Object.defineProperty(P,"settled",{get(){return U}}),P.promise=new Promise(function(B,_t){P.resolve=function(Ct){U=!0,B(Ct)},P.reject=function(Ct){U=!0,_t(Ct)}}),P}},(__unused_webpack_module,exports,__w_pdfjs_require__)=>{var at,z,g,T,$t,q,re,I,S,b,w,x,v,d,m,de,a,F,ue,A,t;Object.defineProperty(exports,"__esModule",{value:!0}),exports.build=exports.RenderTask=exports.PDFWorkerUtil=exports.PDFWorker=exports.PDFPageProxy=exports.PDFDocumentProxy=exports.PDFDocumentLoadingTask=exports.PDFDataRangeTransport=exports.LoopbackPort=exports.DefaultStandardFontDataFactory=exports.DefaultFilterFactory=exports.DefaultCanvasFactory=exports.DefaultCMapReaderFactory=void 0,exports.getDocument=getDocument,exports.version=void 0;var _util=__w_pdfjs_require__(1),_annotation_storage=__w_pdfjs_require__(3),_display_utils=__w_pdfjs_require__(6),_font_loader=__w_pdfjs_require__(9),_canvas=__w_pdfjs_require__(11),_worker_options=__w_pdfjs_require__(14),_is_node=__w_pdfjs_require__(10),_message_handler=__w_pdfjs_require__(15),_metadata=__w_pdfjs_require__(16),_optional_content_config=__w_pdfjs_require__(17),_transport_stream=__w_pdfjs_require__(18),_xfa_text=__w_pdfjs_require__(19);const DEFAULT_RANGE_CHUNK_SIZE=65536,RENDERING_CANCELLED_TIMEOUT=100,DELAYED_CLEANUP_TIMEOUT=5e3;let DefaultCanvasFactory=_display_utils.DOMCanvasFactory;exports.DefaultCanvasFactory=DefaultCanvasFactory;let DefaultCMapReaderFactory=_display_utils.DOMCMapReaderFactory;exports.DefaultCMapReaderFactory=DefaultCMapReaderFactory;let DefaultFilterFactory=_display_utils.DOMFilterFactory;exports.DefaultFilterFactory=DefaultFilterFactory;let DefaultStandardFontDataFactory=_display_utils.DOMStandardFontDataFactory;if(exports.DefaultStandardFontDataFactory=DefaultStandardFontDataFactory,_is_node.isNodeJS){const{NodeCanvasFactory:o,NodeCMapReaderFactory:n,NodeFilterFactory:u,NodeStandardFontDataFactory:C}=__w_pdfjs_require__(20);exports.DefaultCanvasFactory=DefaultCanvasFactory=o,exports.DefaultCMapReaderFactory=DefaultCMapReaderFactory=n,exports.DefaultFilterFactory=DefaultFilterFactory=u,exports.DefaultStandardFontDataFactory=DefaultStandardFontDataFactory=C}let createPDFNetworkStream;if(_is_node.isNodeJS){const{PDFNodeStream:o}=__w_pdfjs_require__(21);createPDFNetworkStream=n=>new o(n)}else{const{PDFNetworkStream:o}=__w_pdfjs_require__(24),{PDFFetchStream:n}=__w_pdfjs_require__(25);createPDFNetworkStream=u=>(0,_display_utils.isValidFetchUrl)(u.url)?new n(u):new o(u)}function getDocument(o){if(typeof o=="string"||o instanceof URL?o={url:o}:(0,_util.isArrayBuffer)(o)&&(o={data:o}),typeof o!="object")throw new Error("Invalid parameter in getDocument, need parameter object.");if(!o.url&&!o.data&&!o.range)throw new Error("Invalid parameter object: need either .data, .range or .url");const n=new PDFDocumentLoadingTask,{docId:u}=n,C=o.url?getUrlProp(o.url):null,i=o.data?getDataProp(o.data):null,O=o.httpHeaders||null,X=o.withCredentials===!0,Y=o.password??null,tt=o.range instanceof PDFDataRangeTransport?o.range:null,nt=Number.isInteger(o.rangeChunkSize)&&o.rangeChunkSize>0?o.rangeChunkSize:DEFAULT_RANGE_CHUNK_SIZE;let ft=o.worker instanceof PDFWorker?o.worker:null;const lt=o.verbosity,ut=typeof o.docBaseUrl=="string"&&!(0,_display_utils.isDataScheme)(o.docBaseUrl)?o.docBaseUrl:null,bt=typeof o.cMapUrl=="string"?o.cMapUrl:null,yt=o.cMapPacked!==!1,W=o.CMapReaderFactory||DefaultCMapReaderFactory,c=typeof o.standardFontDataUrl=="string"?o.standardFontDataUrl:null,h=o.StandardFontDataFactory||DefaultStandardFontDataFactory,y=o.stopAtErrors!==!0,j=Number.isInteger(o.maxImageSize)&&o.maxImageSize>-1?o.maxImageSize:-1,R=o.isEvalSupported!==!1,G=typeof o.isOffscreenCanvasSupported=="boolean"?o.isOffscreenCanvasSupported:!_is_node.isNodeJS,H=Number.isInteger(o.canvasMaxAreaInBytes)?o.canvasMaxAreaInBytes:-1,K=typeof o.disableFontFace=="boolean"?o.disableFontFace:_is_node.isNodeJS,$=o.fontExtraProperties===!0,L=o.enableXfa===!0,k=o.ownerDocument||globalThis.document,e=o.disableRange===!0,r=o.disableStream===!0,_=o.disableAutoFetch===!0,E=o.pdfBug===!0,D=tt?tt.length:o.length??NaN,N=typeof o.useSystemFonts=="boolean"?o.useSystemFonts:!_is_node.isNodeJS&&!K,st=typeof o.useWorkerFetch=="boolean"?o.useWorkerFetch:W===_display_utils.DOMCMapReaderFactory&&h===_display_utils.DOMStandardFontDataFactory&&(0,_display_utils.isValidFetchUrl)(bt,document.baseURI)&&(0,_display_utils.isValidFetchUrl)(c,document.baseURI),Z=o.canvasFactory||new DefaultCanvasFactory({ownerDocument:k}),it=o.filterFactory||new DefaultFilterFactory({docId:u,ownerDocument:k}),rt=null;(0,_util.setVerbosityLevel)(lt);const dt={canvasFactory:Z,filterFactory:it};if(st||(dt.cMapReaderFactory=new W({baseUrl:bt,isCompressed:yt}),dt.standardFontDataFactory=new h({baseUrl:c})),!ft){const gt={verbosity:lt,port:_worker_options.GlobalWorkerOptions.workerPort};ft=gt.port?PDFWorker.fromPort(gt):new PDFWorker(gt),n._worker=ft}const ct={docId:u,apiVersion:"3.5.141",data:i,password:Y,disableAutoFetch:_,rangeChunkSize:nt,length:D,docBaseUrl:ut,enableXfa:L,evaluatorOptions:{maxImageSize:j,disableFontFace:K,ignoreErrors:y,isEvalSupported:R,isOffscreenCanvasSupported:G,canvasMaxAreaInBytes:H,fontExtraProperties:$,useSystemFonts:N,cMapUrl:st?bt:null,standardFontDataUrl:st?c:null}},mt={ignoreErrors:y,isEvalSupported:R,disableFontFace:K,fontExtraProperties:$,enableXfa:L,ownerDocument:k,disableAutoFetch:_,pdfBug:E,styleElement:rt};return ft.promise.then(function(){if(n.destroyed)throw new Error("Loading aborted");const gt=_fetchDocument(ft,ct),Et=new Promise(function(At){let Pt;tt?Pt=new _transport_stream.PDFDataTransportStream({length:D,initialData:tt.initialData,progressiveDone:tt.progressiveDone,contentDispositionFilename:tt.contentDispositionFilename,disableRange:e,disableStream:r},tt):i||(Pt=createPDFNetworkStream({url:C,length:D,httpHeaders:O,withCredentials:X,rangeChunkSize:nt,disableRange:e,disableStream:r})),At(Pt)});return Promise.all([gt,Et]).then(function([At,Pt]){if(n.destroyed)throw new Error("Loading aborted");const P=new _message_handler.MessageHandler(u,At,ft.port),U=new WorkerTransport(P,n,Pt,mt,dt);n._transport=U,P.send("Ready",null)})}).catch(n._capability.reject),n}async function _fetchDocument(o,n){if(o.destroyed)throw new Error("Worker was destroyed");const u=await o.messageHandler.sendWithPromise("GetDocRequest",n,n.data?[n.data.buffer]:null);if(o.destroyed)throw new Error("Worker was destroyed");return u}function getUrlProp(o){if(o instanceof URL)return o.href;try{return new URL(o,window.location).href}catch{if(_is_node.isNodeJS&&typeof o=="string")return o}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function getDataProp(o){if(_is_node.isNodeJS&&typeof Buffer<"u"&&o instanceof Buffer)return(0,_display_utils.deprecated)("Please provide binary data as `Uint8Array`, rather than `Buffer`."),new Uint8Array(o);if(o instanceof Uint8Array&&o.byteLength===o.buffer.byteLength)return o;if(typeof o=="string")return(0,_util.stringToBytes)(o);if(typeof o=="object"&&!isNaN(o==null?void 0:o.length)||(0,_util.isArrayBuffer)(o))return new Uint8Array(o);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}const f=class f{constructor(){this._capability=(0,_util.createPromiseCapability)(),this._transport=null,this._worker=null,this.docId=`d${ie(f,at)._++}`,this.destroyed=!1,this.onPassword=null,this.onProgress=null}get promise(){return this._capability.promise}async destroy(){var n;this.destroyed=!0,await((n=this._transport)==null?void 0:n.destroy()),this._transport=null,this._worker&&(this._worker.destroy(),this._worker=null)}};at=new WeakMap,Q(f,at,0);let PDFDocumentLoadingTask=f;exports.PDFDocumentLoadingTask=PDFDocumentLoadingTask;class PDFDataRangeTransport{constructor(n,u,C=!1,i=null){this.length=n,this.initialData=u,this.progressiveDone=C,this.contentDispositionFilename=i,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=(0,_util.createPromiseCapability)()}addRangeListener(n){this._rangeListeners.push(n)}addProgressListener(n){this._progressListeners.push(n)}addProgressiveReadListener(n){this._progressiveReadListeners.push(n)}addProgressiveDoneListener(n){this._progressiveDoneListeners.push(n)}onDataRange(n,u){for(const C of this._rangeListeners)C(n,u)}onDataProgress(n,u){this._readyCapability.promise.then(()=>{for(const C of this._progressListeners)C(n,u)})}onDataProgressiveRead(n){this._readyCapability.promise.then(()=>{for(const u of this._progressiveReadListeners)u(n)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(const n of this._progressiveDoneListeners)n()})}transportReady(){this._readyCapability.resolve()}requestDataRange(n,u){(0,_util.unreachable)("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}exports.PDFDataRangeTransport=PDFDataRangeTransport;class PDFDocumentProxy{constructor(n,u){this._pdfInfo=n,this._transport=u}get annotationStorage(){return this._transport.annotationStorage}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return(0,_util.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(n){return this._transport.getPage(n)}getPageIndex(n){return this._transport.getPageIndex(n)}getDestinations(){return this._transport.getDestinations()}getDestination(n){return this._transport.getDestination(n)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJavaScript(){return this._transport.getJavaScript()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig(){return this._transport.getOptionalContentConfig()}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(n=!1){return this._transport.startCleanup(n||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}exports.PDFDocumentProxy=PDFDocumentProxy;class PDFPageProxy{constructor(n,u,C,i=!1){Q(this,T);Q(this,q);Q(this,z,null);Q(this,g,!1);this._pageIndex=n,this._pageInfo=u,this._transport=C,this._stats=i?new _display_utils.StatTimer:null,this._pdfBug=i,this.commonObjs=C.commonObjs,this.objs=new PDFObjects,this._maybeCleanupAfterRender=!1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:n,rotation:u=this.rotate,offsetX:C=0,offsetY:i=0,dontFlip:O=!1}={}){return new _display_utils.PageViewport({viewBox:this.view,scale:n,rotation:u,offsetX:C,offsetY:i,dontFlip:O})}getAnnotations({intent:n="display"}={}){const u=this._transport.getRenderingIntent(n);return this._transport.getAnnotations(this._pageIndex,u.renderingIntent)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get isPureXfa(){return(0,_util.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){var n;return((n=this._transport._htmlForXfa)==null?void 0:n.children[this._pageIndex])||null}render({canvasContext:n,viewport:u,intent:C="display",annotationMode:i=_util.AnnotationMode.ENABLE,transform:O=null,background:X=null,optionalContentConfigPromise:Y=null,annotationCanvasMap:tt=null,pageColors:nt=null,printAnnotationStorage:ft=null}){var h,y,j;if((h=arguments[0])!=null&&h.canvasFactory)throw new Error("render no longer accepts the `canvasFactory`-option, please pass it to the `getDocument`-function instead.");(y=this._stats)==null||y.time("Overall");const lt=this._transport.getRenderingIntent(C,i,ft);pt(this,g,!1),ot(this,q,re).call(this),Y||(Y=this._transport.getOptionalContentConfig());let ut=this._intentStates.get(lt.cacheKey);ut||(ut=Object.create(null),this._intentStates.set(lt.cacheKey,ut)),ut.streamReaderCancelTimeout&&(clearTimeout(ut.streamReaderCancelTimeout),ut.streamReaderCancelTimeout=null);const bt=!!(lt.renderingIntent&_util.RenderingIntentFlag.PRINT);ut.displayReadyCapability||(ut.displayReadyCapability=(0,_util.createPromiseCapability)(),ut.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(j=this._stats)==null||j.time("Page Request"),this._pumpOperatorList(lt));const yt=R=>{var G,H;ut.renderTasks.delete(W),(this._maybeCleanupAfterRender||bt)&&pt(this,g,!0),ot(this,T,$t).call(this,!bt),R?(W.capability.reject(R),this._abortOperatorList({intentState:ut,reason:R instanceof Error?R:new Error(R)})):W.capability.resolve(),(G=this._stats)==null||G.timeEnd("Rendering"),(H=this._stats)==null||H.timeEnd("Overall")},W=new InternalRenderTask({callback:yt,params:{canvasContext:n,viewport:u,transform:O,background:X},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:tt,operatorList:ut.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!bt,pdfBug:this._pdfBug,pageColors:nt});(ut.renderTasks||(ut.renderTasks=new Set)).add(W);const c=W.task;return Promise.all([ut.displayReadyCapability.promise,Y]).then(([R,G])=>{var H;if(p(this,g)){yt();return}(H=this._stats)==null||H.time("Rendering"),W.initializeGraphics({transparency:R,optionalContentConfig:G}),W.operatorListChanged()}).catch(yt),c}getOperatorList({intent:n="display",annotationMode:u=_util.AnnotationMode.ENABLE,printAnnotationStorage:C=null}={}){var tt;function i(){X.operatorList.lastChunk&&(X.opListReadCapability.resolve(X.operatorList),X.renderTasks.delete(Y))}const O=this._transport.getRenderingIntent(n,u,C,!0);let X=this._intentStates.get(O.cacheKey);X||(X=Object.create(null),this._intentStates.set(O.cacheKey,X));let Y;return X.opListReadCapability||(Y=Object.create(null),Y.operatorListChanged=i,X.opListReadCapability=(0,_util.createPromiseCapability)(),(X.renderTasks||(X.renderTasks=new Set)).add(Y),X.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(tt=this._stats)==null||tt.time("Page Request"),this._pumpOperatorList(O)),X.opListReadCapability.promise}streamTextContent({includeMarkedContent:n=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:n===!0},{highWaterMark:100,size(C){return C.items.length}})}getTextContent(n={}){if(this._transport._htmlForXfa)return this.getXfa().then(C=>_xfa_text.XfaText.textContent(C));const u=this.streamTextContent(n);return new Promise(function(C,i){function O(){X.read().then(function({value:tt,done:nt}){if(nt){C(Y);return}Object.assign(Y.styles,tt.styles),Y.items.push(...tt.items),O()},i)}const X=u.getReader(),Y={items:[],styles:Object.create(null)};O()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const n=[];for(const u of this._intentStates.values())if(this._abortOperatorList({intentState:u,reason:new Error("Page was destroyed."),force:!0}),!u.opListReadCapability)for(const C of u.renderTasks)n.push(C.completed),C.cancel();return this.objs.clear(),pt(this,g,!1),ot(this,q,re).call(this),Promise.all(n)}cleanup(n=!1){pt(this,g,!0);const u=ot(this,T,$t).call(this,!1);return n&&u&&this._stats&&(this._stats=new _display_utils.StatTimer),u}_startRenderPage(n,u){var i,O;const C=this._intentStates.get(u);C&&((i=this._stats)==null||i.timeEnd("Page Request"),(O=C.displayReadyCapability)==null||O.resolve(n))}_renderPageChunk(n,u){for(let C=0,i=n.length;C<i;C++)u.operatorList.fnArray.push(n.fnArray[C]),u.operatorList.argsArray.push(n.argsArray[C]);u.operatorList.lastChunk=n.lastChunk,u.operatorList.separateAnnots=n.separateAnnots;for(const C of u.renderTasks)C.operatorListChanged();n.lastChunk&&ot(this,T,$t).call(this,!0)}_pumpOperatorList({renderingIntent:n,cacheKey:u,annotationStorageMap:C}){const O=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:n,cacheKey:u,annotationStorage:C}).getReader(),X=this._intentStates.get(u);X.streamReader=O;const Y=()=>{O.read().then(({value:tt,done:nt})=>{if(nt){X.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(tt,X),Y())},tt=>{if(X.streamReader=null,!this._transport.destroyed){if(X.operatorList){X.operatorList.lastChunk=!0;for(const nt of X.renderTasks)nt.operatorListChanged();ot(this,T,$t).call(this,!0)}if(X.displayReadyCapability)X.displayReadyCapability.reject(tt);else if(X.opListReadCapability)X.opListReadCapability.reject(tt);else throw tt}})};Y()}_abortOperatorList({intentState:n,reason:u,force:C=!1}){if(n.streamReader){if(n.streamReaderCancelTimeout&&(clearTimeout(n.streamReaderCancelTimeout),n.streamReaderCancelTimeout=null),!C){if(n.renderTasks.size>0)return;if(u instanceof _display_utils.RenderingCancelledException){let i=RENDERING_CANCELLED_TIMEOUT;u.extraDelay>0&&u.extraDelay<1e3&&(i+=u.extraDelay),n.streamReaderCancelTimeout=setTimeout(()=>{n.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:n,reason:u,force:!0})},i);return}}if(n.streamReader.cancel(new _util.AbortException(u.message)).catch(()=>{}),n.streamReader=null,!this._transport.destroyed){for(const[i,O]of this._intentStates)if(O===n){this._intentStates.delete(i);break}this.cleanup()}}}get stats(){return this._stats}}z=new WeakMap,g=new WeakMap,T=new WeakSet,$t=function(n=!1){if(ot(this,q,re).call(this),!p(this,g))return!1;if(n)return pt(this,z,setTimeout(()=>{pt(this,z,null),ot(this,T,$t).call(this,!1)},DELAYED_CLEANUP_TIMEOUT)),!1;for(const{renderTasks:u,operatorList:C}of this._intentStates.values())if(u.size>0||!C.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),pt(this,g,!1),!0},q=new WeakSet,re=function(){p(this,z)&&(clearTimeout(p(this,z)),pt(this,z,null))},exports.PDFPageProxy=PDFPageProxy;class LoopbackPort{constructor(){Q(this,I,new Set);Q(this,S,Promise.resolve())}postMessage(n,u){const C={data:structuredClone(n,u?{transfer:u}:null)};p(this,S).then(()=>{for(const i of p(this,I))i.call(this,C)})}addEventListener(n,u){p(this,I).add(u)}removeEventListener(n,u){p(this,I).delete(u)}terminate(){p(this,I).clear()}}I=new WeakMap,S=new WeakMap,exports.LoopbackPort=LoopbackPort;const PDFWorkerUtil={isWorkerDisabled:!1,fallbackWorkerSrc:null,fakeWorkerId:0};exports.PDFWorkerUtil=PDFWorkerUtil;{if(_is_node.isNodeJS&&typeof commonjsRequire=="function")PDFWorkerUtil.isWorkerDisabled=!0,PDFWorkerUtil.fallbackWorkerSrc="./pdf.worker.js";else if(typeof document=="object"){const o=(b=document==null?void 0:document.currentScript)==null?void 0:b.src;o&&(PDFWorkerUtil.fallbackWorkerSrc=o.replace(/(\.(?:min\.)?js)(\?.*)?$/i,".worker$1$2"))}PDFWorkerUtil.isSameOrigin=function(o,n){let u;try{if(u=new URL(o),!u.origin||u.origin==="null")return!1}catch{return!1}const C=new URL(n,u);return u.origin===C.origin},PDFWorkerUtil.createCDNWrapper=function(o){const n=`importScripts("${o}");`;return URL.createObjectURL(new Blob([n]))}}const _PDFWorker=class _PDFWorker{constructor({name:o=null,port:n=null,verbosity:u=(0,_util.getVerbosityLevel)()}={}){if(n&&p(_PDFWorker,w).has(n))throw new Error("Cannot use more than one PDFWorker per port.");if(this.name=o,this.destroyed=!1,this.verbosity=u,this._readyCapability=(0,_util.createPromiseCapability)(),this._port=null,this._webWorker=null,this._messageHandler=null,n){p(_PDFWorker,w).set(n,this),this._initializeFromPort(n);return}this._initialize()}get promise(){return this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(o){this._port=o,this._messageHandler=new _message_handler.MessageHandler("main","worker",o),this._messageHandler.on("ready",function(){}),this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})}_initialize(){if(!PDFWorkerUtil.isWorkerDisabled&&!_PDFWorker._mainThreadWorkerMessageHandler){let{workerSrc:o}=_PDFWorker;try{PDFWorkerUtil.isSameOrigin(window.location.href,o)||(o=PDFWorkerUtil.createCDNWrapper(new URL(o,window.location).href));const n=new Worker(o),u=new _message_handler.MessageHandler("main","worker",n),C=()=>{n.removeEventListener("error",i),u.destroy(),n.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},i=()=>{this._webWorker||C()};n.addEventListener("error",i),u.on("test",X=>{if(n.removeEventListener("error",i),this.destroyed){C();return}X?(this._messageHandler=u,this._port=n,this._webWorker=n,this._readyCapability.resolve(),u.send("configure",{verbosity:this.verbosity})):(this._setupFakeWorker(),u.destroy(),n.terminate())}),u.on("ready",X=>{if(n.removeEventListener("error",i),this.destroyed){C();return}try{O()}catch{this._setupFakeWorker()}});const O=()=>{const X=new Uint8Array;u.send("test",X,[X.buffer])};O();return}catch{(0,_util.info)("The worker has been disabled.")}}this._setupFakeWorker()}_setupFakeWorker(){PDFWorkerUtil.isWorkerDisabled||((0,_util.warn)("Setting up fake worker."),PDFWorkerUtil.isWorkerDisabled=!0),_PDFWorker._setupFakeWorkerGlobal.then(o=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}const n=new LoopbackPort;this._port=n;const u=`fake${PDFWorkerUtil.fakeWorkerId++}`,C=new _message_handler.MessageHandler(u+"_worker",u,n);o.setup(C,n);const i=new _message_handler.MessageHandler(u,u+"_worker",n);this._messageHandler=i,this._readyCapability.resolve(),i.send("configure",{verbosity:this.verbosity})}).catch(o=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${o.message}".`))})}destroy(){this.destroyed=!0,this._webWorker&&(this._webWorker.terminate(),this._webWorker=null),p(_PDFWorker,w).delete(this._port),this._port=null,this._messageHandler&&(this._messageHandler.destroy(),this._messageHandler=null)}static fromPort(o){if(!(o!=null&&o.port))throw new Error("PDFWorker.fromPort - invalid method signature.");return p(this,w).has(o.port)?p(this,w).get(o.port):new _PDFWorker(o)}static get workerSrc(){if(_worker_options.GlobalWorkerOptions.workerSrc)return _worker_options.GlobalWorkerOptions.workerSrc;if(PDFWorkerUtil.fallbackWorkerSrc!==null)return _is_node.isNodeJS||(0,_display_utils.deprecated)('No "GlobalWorkerOptions.workerSrc" specified.'),PDFWorkerUtil.fallbackWorkerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _mainThreadWorkerMessageHandler(){var o;try{return((o=globalThis.pdfjsWorker)==null?void 0:o.WorkerMessageHandler)||null}catch{return null}}static get _setupFakeWorkerGlobal(){const loader=async()=>{const mainWorkerMessageHandler=this._mainThreadWorkerMessageHandler;if(mainWorkerMessageHandler)return mainWorkerMessageHandler;if(_is_node.isNodeJS&&typeof commonjsRequire=="function"){const worker=eval("require")(this.workerSrc);return worker.WorkerMessageHandler}return await(0,_display_utils.loadScript)(this.workerSrc),window.pdfjsWorker.WorkerMessageHandler};return(0,_util.shadow)(this,"_setupFakeWorkerGlobal",loader())}};w=new WeakMap,Q(_PDFWorker,w,new WeakMap);let PDFWorker=_PDFWorker;exports.PDFWorker=PDFWorker;class WorkerTransport{constructor(n,u,C,i,O){Q(this,m);Q(this,x,new Map);Q(this,v,new Map);Q(this,d,new Map);this.messageHandler=n,this.loadingTask=u,this.commonObjs=new PDFObjects,this.fontLoader=new _font_loader.FontLoader({ownerDocument:i.ownerDocument,styleElement:i.styleElement}),this._params=i,this.canvasFactory=O.canvasFactory,this.filterFactory=O.filterFactory,this.cMapReaderFactory=O.cMapReaderFactory,this.standardFontDataFactory=O.standardFontDataFactory,this.destroyed=!1,this.destroyCapability=null,this._passwordCapability=null,this._networkStream=C,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=(0,_util.createPromiseCapability)(),this.setupMessageHandler()}get annotationStorage(){return(0,_util.shadow)(this,"annotationStorage",new _annotation_storage.AnnotationStorage)}getRenderingIntent(n,u=_util.AnnotationMode.ENABLE,C=null,i=!1){let O=_util.RenderingIntentFlag.DISPLAY,X=null;switch(n){case"any":O=_util.RenderingIntentFlag.ANY;break;case"display":break;case"print":O=_util.RenderingIntentFlag.PRINT;break;default:(0,_util.warn)(`getRenderingIntent - invalid intent: ${n}`)}switch(u){case _util.AnnotationMode.DISABLE:O+=_util.RenderingIntentFlag.ANNOTATIONS_DISABLE;break;case _util.AnnotationMode.ENABLE:break;case _util.AnnotationMode.ENABLE_FORMS:O+=_util.RenderingIntentFlag.ANNOTATIONS_FORMS;break;case _util.AnnotationMode.ENABLE_STORAGE:O+=_util.RenderingIntentFlag.ANNOTATIONS_STORAGE,X=(O&_util.RenderingIntentFlag.PRINT&&C instanceof _annotation_storage.PrintAnnotationStorage?C:this.annotationStorage).serializable;break;default:(0,_util.warn)(`getRenderingIntent - invalid annotationMode: ${u}`)}return i&&(O+=_util.RenderingIntentFlag.OPLIST),{renderingIntent:O,cacheKey:`${O}_${_annotation_storage.AnnotationStorage.getHash(X)}`,annotationStorageMap:X}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=(0,_util.createPromiseCapability)(),this._passwordCapability&&this._passwordCapability.reject(new Error("Worker was destroyed during onPassword callback"));const n=[];for(const C of p(this,v).values())n.push(C._destroy());p(this,v).clear(),p(this,d).clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const u=this.messageHandler.sendWithPromise("Terminate",null);return n.push(u),Promise.all(n).then(()=>{this.commonObjs.clear(),this.fontLoader.clear(),p(this,x).clear(),this.filterFactory.destroy(),this._networkStream&&this._networkStream.cancelAllRequests(new _util.AbortException("Worker was terminated.")),this.messageHandler&&(this.messageHandler.destroy(),this.messageHandler=null),this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:n,loadingTask:u}=this;n.on("GetReader",(C,i)=>{(0,_util.assert)(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=O=>{this._lastProgress={loaded:O.loaded,total:O.total}},i.onPull=()=>{this._fullReader.read().then(function({value:O,done:X}){if(X){i.close();return}(0,_util.assert)(O instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),i.enqueue(new Uint8Array(O),1,[O])}).catch(O=>{i.error(O)})},i.onCancel=O=>{this._fullReader.cancel(O),i.ready.catch(X=>{if(!this.destroyed)throw X})}}),n.on("ReaderHeadersReady",C=>{const i=(0,_util.createPromiseCapability)(),O=this._fullReader;return O.headersReady.then(()=>{var X;(!O.isStreamingSupported||!O.isRangeSupported)&&(this._lastProgress&&((X=u.onProgress)==null||X.call(u,this._lastProgress)),O.onProgress=Y=>{var tt;(tt=u.onProgress)==null||tt.call(u,{loaded:Y.loaded,total:Y.total})}),i.resolve({isStreamingSupported:O.isStreamingSupported,isRangeSupported:O.isRangeSupported,contentLength:O.contentLength})},i.reject),i.promise}),n.on("GetRangeReader",(C,i)=>{(0,_util.assert)(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const O=this._networkStream.getRangeReader(C.begin,C.end);if(!O){i.close();return}i.onPull=()=>{O.read().then(function({value:X,done:Y}){if(Y){i.close();return}(0,_util.assert)(X instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),i.enqueue(new Uint8Array(X),1,[X])}).catch(X=>{i.error(X)})},i.onCancel=X=>{O.cancel(X),i.ready.catch(Y=>{if(!this.destroyed)throw Y})}}),n.on("GetDoc",({pdfInfo:C})=>{this._numPages=C.numPages,this._htmlForXfa=C.htmlForXfa,delete C.htmlForXfa,u._capability.resolve(new PDFDocumentProxy(C,this))}),n.on("DocException",function(C){let i;switch(C.name){case"PasswordException":i=new _util.PasswordException(C.message,C.code);break;case"InvalidPDFException":i=new _util.InvalidPDFException(C.message);break;case"MissingPDFException":i=new _util.MissingPDFException(C.message);break;case"UnexpectedResponseException":i=new _util.UnexpectedResponseException(C.message,C.status);break;case"UnknownErrorException":i=new _util.UnknownErrorException(C.message,C.details);break;default:(0,_util.unreachable)("DocException - expected a valid Error.")}u._capability.reject(i)}),n.on("PasswordRequest",C=>{if(this._passwordCapability=(0,_util.createPromiseCapability)(),u.onPassword){const i=O=>{O instanceof Error?this._passwordCapability.reject(O):this._passwordCapability.resolve({password:O})};try{u.onPassword(i,C.code)}catch(O){this._passwordCapability.reject(O)}}else this._passwordCapability.reject(new _util.PasswordException(C.message,C.code));return this._passwordCapability.promise}),n.on("DataLoaded",C=>{var i;(i=u.onProgress)==null||i.call(u,{loaded:C.length,total:C.length}),this.downloadInfoCapability.resolve(C)}),n.on("StartRenderPage",C=>{if(this.destroyed)return;p(this,v).get(C.pageIndex)._startRenderPage(C.transparency,C.cacheKey)}),n.on("commonobj",([C,i,O])=>{var X;if(!this.destroyed&&!this.commonObjs.has(C))switch(i){case"Font":const Y=this._params;if("error"in O){const ft=O.error;(0,_util.warn)(`Error during font loading: ${ft}`),this.commonObjs.resolve(C,ft);break}const tt=Y.pdfBug&&((X=globalThis.FontInspector)!=null&&X.enabled)?(ft,lt)=>globalThis.FontInspector.fontAdded(ft,lt):null,nt=new _font_loader.FontFaceObject(O,{isEvalSupported:Y.isEvalSupported,disableFontFace:Y.disableFontFace,ignoreErrors:Y.ignoreErrors,inspectFont:tt});this.fontLoader.bind(nt).catch(ft=>n.sendWithPromise("FontFallback",{id:C})).finally(()=>{!Y.fontExtraProperties&&nt.data&&(nt.data=null),this.commonObjs.resolve(C,nt)});break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(C,O);break;default:throw new Error(`Got unknown common object type ${i}`)}}),n.on("obj",([C,i,O,X])=>{var tt;if(this.destroyed)return;const Y=p(this,v).get(i);if(!Y.objs.has(C))switch(O){case"Image":if(Y.objs.resolve(C,X),X){let nt;if(X.bitmap){const{width:ft,height:lt}=X;nt=ft*lt*4}else nt=((tt=X.data)==null?void 0:tt.length)||0;nt>_util.MAX_IMAGE_SIZE_TO_CACHE&&(Y._maybeCleanupAfterRender=!0)}break;case"Pattern":Y.objs.resolve(C,X);break;default:throw new Error(`Got unknown object type ${O}`)}}),n.on("DocProgress",C=>{var i;this.destroyed||(i=u.onProgress)==null||i.call(u,{loaded:C.loaded,total:C.total})}),n.on("FetchBuiltInCMap",C=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.cMapReaderFactory?this.cMapReaderFactory.fetch(C):Promise.reject(new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter."))),n.on("FetchStandardFontData",C=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.standardFontDataFactory?this.standardFontDataFactory.fetch(C):Promise.reject(new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.")))}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){var n;return this.annotationStorage.size<=0&&(0,_util.warn)("saveDocument called while `annotationStorage` is empty, please use the getData-method instead."),this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:this.annotationStorage.serializable,filename:((n=this._fullReader)==null?void 0:n.filename)??null}).finally(()=>{this.annotationStorage.resetModified()})}getPage(n){if(!Number.isInteger(n)||n<=0||n>this._numPages)return Promise.reject(new Error("Invalid page request."));const u=n-1,C=p(this,d).get(u);if(C)return C;const i=this.messageHandler.sendWithPromise("GetPage",{pageIndex:u}).then(O=>{if(this.destroyed)throw new Error("Transport destroyed");const X=new PDFPageProxy(u,O,this,this._params.pdfBug);return p(this,v).set(u,X),X});return p(this,d).set(u,i),i}getPageIndex(n){return typeof n!="object"||n===null||!Number.isInteger(n.num)||n.num<0||!Number.isInteger(n.gen)||n.gen<0?Promise.reject(new Error("Invalid pageIndex request.")):this.messageHandler.sendWithPromise("GetPageIndex",{num:n.num,gen:n.gen})}getAnnotations(n,u){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:n,intent:u})}getFieldObjects(){return ot(this,m,de).call(this,"GetFieldObjects")}hasJSActions(){return ot(this,m,de).call(this,"HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(n){return typeof n!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:n})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getJavaScript(){return this.messageHandler.sendWithPromise("GetJavaScript",null)}getDocJSActions(){return this.messageHandler.sendWithPromise("GetDocJSActions",null)}getPageJSActions(n){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:n})}getStructTree(n){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:n})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(){return this.messageHandler.sendWithPromise("GetOptionalContentConfig",null).then(n=>new _optional_content_config.OptionalContentConfig(n))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const n="GetMetadata",u=p(this,x).get(n);if(u)return u;const C=this.messageHandler.sendWithPromise(n,null).then(i=>{var O,X;return{info:i[0],metadata:i[1]?new _metadata.Metadata(i[1]):null,contentDispositionFilename:((O=this._fullReader)==null?void 0:O.filename)??null,contentLength:((X=this._fullReader)==null?void 0:X.contentLength)??null}});return p(this,x).set(n,C),C}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(n=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const u of p(this,v).values())if(!u.cleanup())throw new Error(`startCleanup: Page ${u.pageNumber} is currently rendering.`);this.commonObjs.clear(),n||this.fontLoader.clear(),p(this,x).clear(),this.filterFactory.destroy(!0)}}get loadingParams(){const{disableAutoFetch:n,enableXfa:u}=this._params;return(0,_util.shadow)(this,"loadingParams",{disableAutoFetch:n,enableXfa:u})}}x=new WeakMap,v=new WeakMap,d=new WeakMap,m=new WeakSet,de=function(n,u=null){const C=p(this,x).get(n);if(C)return C;const i=this.messageHandler.sendWithPromise(n,u);return p(this,x).set(n,i),i};class PDFObjects{constructor(){Q(this,F);Q(this,a,Object.create(null))}get(n,u=null){if(u){const i=ot(this,F,ue).call(this,n);return i.capability.promise.then(()=>u(i.data)),null}const C=p(this,a)[n];if(!(C!=null&&C.capability.settled))throw new Error(`Requesting object that isn't resolved yet ${n}.`);return C.data}has(n){const u=p(this,a)[n];return(u==null?void 0:u.capability.settled)||!1}resolve(n,u=null){const C=ot(this,F,ue).call(this,n);C.data=u,C.capability.resolve()}clear(){var n;for(const u in p(this,a)){const{data:C}=p(this,a)[u];(n=C==null?void 0:C.bitmap)==null||n.close()}pt(this,a,Object.create(null))}}a=new WeakMap,F=new WeakSet,ue=function(n){const u=p(this,a)[n];return u||(p(this,a)[n]={capability:(0,_util.createPromiseCapability)(),data:null})};class RenderTask{constructor(n){Q(this,A,null);pt(this,A,n),this.onContinue=null}get promise(){return p(this,A).capability.promise}cancel(n=0){p(this,A).cancel(null,n)}get separateAnnots(){const{separateAnnots:n}=p(this,A).operatorList;if(!n)return!1;const{annotationCanvasMap:u}=p(this,A);return n.form||n.canvas&&(u==null?void 0:u.size)>0}}A=new WeakMap,exports.RenderTask=RenderTask;const l=class l{constructor({callback:n,params:u,objs:C,commonObjs:i,annotationCanvasMap:O,operatorList:X,pageIndex:Y,canvasFactory:tt,filterFactory:nt,useRequestAnimationFrame:ft=!1,pdfBug:lt=!1,pageColors:ut=null}){this.callback=n,this.params=u,this.objs=C,this.commonObjs=i,this.annotationCanvasMap=O,this.operatorListIdx=null,this.operatorList=X,this._pageIndex=Y,this.canvasFactory=tt,this.filterFactory=nt,this._pdfBug=lt,this.pageColors=ut,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=ft===!0&&typeof window<"u",this.cancelled=!1,this.capability=(0,_util.createPromiseCapability)(),this.task=new RenderTask(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=u.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:n=!1,optionalContentConfig:u}){var Y,tt;if(this.cancelled)return;if(this._canvas){if(p(l,t).has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");p(l,t).add(this._canvas)}this._pdfBug&&((Y=globalThis.StepperManager)!=null&&Y.enabled)&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{canvasContext:C,viewport:i,transform:O,background:X}=this.params;this.gfx=new _canvas.CanvasGraphics(C,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:u},this.annotationCanvasMap),this.gfx.beginDrawing({transform:O,viewport:i,transparency:n,background:X}),this.operatorListIdx=0,this.graphicsReady=!0,(tt=this.graphicsReadyCallback)==null||tt.call(this)}cancel(n=null,u=0){var C;this.running=!1,this.cancelled=!0,(C=this.gfx)==null||C.endDrawing(this.pageColors),this._canvas&&p(l,t).delete(this._canvas),this.callback(n||new _display_utils.RenderingCancelledException(`Rendering cancelled, page ${this._pageIndex+1}`,"canvas",u))}operatorListChanged(){var n;if(!this.graphicsReady){this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound);return}(n=this.stepper)==null||n.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?window.requestAnimationFrame(()=>{this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(this.pageColors),this._canvas&&p(l,t).delete(this._canvas),this.callback())))}};t=new WeakMap,Q(l,t,new WeakSet);let InternalRenderTask=l;const version="3.5.141";exports.version=version;const build="be0f6ee08";exports.build=build},(at,f,z)=>{var I,S,b,Me,x;Object.defineProperty(f,"__esModule",{value:!0}),f.PrintAnnotationStorage=f.AnnotationStorage=void 0;var g=z(1),T=z(4),V=z(8);class q{constructor(){Q(this,b);Q(this,I,!1);Q(this,S,new Map);this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(d,m){const s=p(this,S).get(d);return s===void 0?m:Object.assign(m,s)}getRawValue(d){return p(this,S).get(d)}remove(d){if(p(this,S).delete(d),p(this,S).size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(const m of p(this,S).values())if(m instanceof T.AnnotationEditor)return;this.onAnnotationEditor(null)}}setValue(d,m){const s=p(this,S).get(d);let a=!1;if(s!==void 0)for(const[F,M]of Object.entries(m))s[F]!==M&&(a=!0,s[F]=M);else a=!0,p(this,S).set(d,m);a&&ot(this,b,Me).call(this),m instanceof T.AnnotationEditor&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(m.constructor._type)}has(d){return p(this,S).has(d)}getAll(){return p(this,S).size>0?(0,g.objectFromMap)(p(this,S)):null}setAll(d){for(const[m,s]of Object.entries(d))this.setValue(m,s)}get size(){return p(this,S).size}resetModified(){p(this,I)&&(pt(this,I,!1),typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new et(this)}get serializable(){if(p(this,S).size===0)return null;const d=new Map;for(const[m,s]of p(this,S)){const a=s instanceof T.AnnotationEditor?s.serialize():s;a&&d.set(m,a)}return d}static getHash(d){if(!d)return"";const m=new V.MurmurHash3_64;for(const[s,a]of d)m.update(`${s}:${JSON.stringify(a)}`);return m.hexdigest()}}I=new WeakMap,S=new WeakMap,b=new WeakSet,Me=function(){p(this,I)||(pt(this,I,!0),typeof this.onSetModified=="function"&&this.onSetModified())},f.AnnotationStorage=q;class et extends q{constructor(m){super();Q(this,x,null);pt(this,x,structuredClone(m.serializable))}get print(){(0,g.unreachable)("Should not call PrintAnnotationStorage.print")}get serializable(){return p(this,x)}}x=new WeakMap,f.PrintAnnotationStorage=et},(at,f,z)=>{var q,et,I,S,b,w;Object.defineProperty(f,"__esModule",{value:!0}),f.AnnotationEditor=void 0;var g=z(5),T=z(1);const x=class x{constructor(d){Q(this,q,this.focusin.bind(this));Q(this,et,this.focusout.bind(this));Q(this,I,!1);Q(this,S,!1);Q(this,b,!1);Dt(this,"_uiManager",null);Q(this,w,x._zIndex++);this.constructor===x&&(0,T.unreachable)("Cannot initialize AnnotationEditor."),this.parent=d.parent,this.id=d.id,this.width=this.height=null,this.pageIndex=d.parent.pageIndex,this.name=d.name,this.div=null,this._uiManager=d.uiManager;const{rotation:m,rawDims:{pageWidth:s,pageHeight:a,pageX:F,pageY:M}}=this.parent.viewport;this.rotation=m,this.pageDimensions=[s,a],this.pageTranslation=[F,M];const[A,t]=this.parentDimensions;this.x=d.x/A,this.y=d.y/t,this.isAttachedToDOM=!1}static get _defaultLineColor(){return(0,T.shadow)(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}addCommands(d){this._uiManager.addCommands(d)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=p(this,w)}setParent(d){d!==null&&(this.pageIndex=d.pageIndex,this.pageDimensions=d.pageDimensions),this.parent=d}focusin(d){p(this,I)?pt(this,I,!1):this.parent.setSelected(this)}focusout(d){var s;if(!this.isAttachedToDOM)return;const m=d.relatedTarget;m!=null&&m.closest(`#${this.id}`)||(d.preventDefault(),(s=this.parent)!=null&&s.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}dragstart(d){const m=this.parent.div.getBoundingClientRect();this.startX=d.clientX-m.x,this.startY=d.clientY-m.y,d.dataTransfer.setData("text/plain",this.id),d.dataTransfer.effectAllowed="move"}setAt(d,m,s,a){const[F,M]=this.parentDimensions;[s,a]=this.screenToPageTranslation(s,a),this.x=(d+s)/F,this.y=(m+a)/M,this.div.style.left=`${100*this.x}%`,this.div.style.top=`${100*this.y}%`}translate(d,m){const[s,a]=this.parentDimensions;[d,m]=this.screenToPageTranslation(d,m),this.x+=d/s,this.y+=m/a,this.div.style.left=`${100*this.x}%`,this.div.style.top=`${100*this.y}%`}screenToPageTranslation(d,m){switch(this.parentRotation){case 90:return[m,-d];case 180:return[-d,-m];case 270:return[-m,d];default:return[d,m]}}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return this._uiManager.viewParameters.rotation}get parentDimensions(){const{realScale:d}=this._uiManager.viewParameters,[m,s]=this.pageDimensions;return[m*d,s*d]}setDims(d,m){const[s,a]=this.parentDimensions;this.div.style.width=`${100*d/s}%`,this.div.style.height=`${100*m/a}%`}fixDims(){const{style:d}=this.div,{height:m,width:s}=d,a=s.endsWith("%"),F=m.endsWith("%");if(a&&F)return;const[M,A]=this.parentDimensions;a||(d.width=`${100*parseFloat(s)/M}%`),F||(d.height=`${100*parseFloat(m)/A}%`)}getInitialTranslation(){return[0,0]}render(){this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.setAttribute("tabIndex",0),this.setInForeground(),this.div.addEventListener("focusin",p(this,q)),this.div.addEventListener("focusout",p(this,et));const[d,m]=this.getInitialTranslation();return this.translate(d,m),(0,g.bindEvents)(this,this.div,["dragstart","pointerdown"]),this.div}pointerdown(d){const{isMac:m}=T.FeatureTest.platform;if(d.button!==0||d.ctrlKey&&m){d.preventDefault();return}d.ctrlKey&&!m||d.shiftKey||d.metaKey&&m?this.parent.toggleSelected(this):this.parent.setSelected(this),pt(this,I,!0)}getRect(d,m){const s=this.parentScale,[a,F]=this.pageDimensions,[M,A]=this.pageTranslation,t=d/s,l=m/s,o=this.x*a,n=this.y*F,u=this.width*a,C=this.height*F;switch(this.rotation){case 0:return[o+t+M,F-n-l-C+A,o+t+u+M,F-n-l+A];case 90:return[o+l+M,F-n+t+A,o+l+C+M,F-n+t+u+A];case 180:return[o-t-u+M,F-n+l+A,o-t+M,F-n+l+C+A];case 270:return[o-l-C+M,F-n-t-u+A,o-l+M,F-n-t+A];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(d,m){const[s,a,F,M]=d,A=F-s,t=M-a;switch(this.rotation){case 0:return[s,m-M,A,t];case 90:return[s,m-a,t,A];case 180:return[F,m-a,A,t];case 270:return[F,m-M,t,A];default:throw new Error("Invalid rotation")}}onceAdded(){}isEmpty(){return!1}enableEditMode(){pt(this,b,!0)}disableEditMode(){pt(this,b,!1)}isInEditMode(){return p(this,b)}shouldGetKeyboardEvents(){return!1}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}rebuild(){var d;(d=this.div)==null||d.addEventListener("focusin",p(this,q))}serialize(){(0,T.unreachable)("An editor must be serializable")}static deserialize(d,m,s){const a=new this.prototype.constructor({parent:m,id:m.getNextId(),uiManager:s});a.rotation=d.rotation;const[F,M]=a.pageDimensions,[A,t,l,o]=a.getRectInCurrentCoords(d.rect,M);return a.x=A/F,a.y=t/M,a.width=l/F,a.height=o/M,a}remove(){this.div.removeEventListener("focusin",p(this,q)),this.div.removeEventListener("focusout",p(this,et)),this.isEmpty()||this.commit(),this.parent.remove(this)}select(){var d;(d=this.div)==null||d.classList.add("selectedEditor")}unselect(){var d;(d=this.div)==null||d.classList.remove("selectedEditor")}updateParams(d,m){}disableEditing(){}enableEditing(){}get propertiesToUpdate(){return{}}get contentDiv(){return this.div}get isEditing(){return p(this,S)}set isEditing(d){pt(this,S,d),d?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null)}};q=new WeakMap,et=new WeakMap,I=new WeakMap,S=new WeakMap,b=new WeakMap,w=new WeakMap,Dt(x,"_colorManager",new g.ColorManager),Dt(x,"_zIndex",1);let V=x;f.AnnotationEditor=V},(at,f,z)=>{var x,v,d,m,s,a,De,A,t,l,o,n,u,C,i,O,X,Y,tt,nt,ft,lt,ut,bt,yt,W,c,h,y,j,R,Oe,H,fe,$,Ie,k,Le,r,Wt,E,Jt,N,Ne,Z,je,rt,pe,ct,Qt,gt,ge;Object.defineProperty(f,"__esModule",{value:!0}),f.KeyboardManager=f.CommandManager=f.ColorManager=f.AnnotationEditorUIManager=void 0,f.bindEvents=V,f.opacityToHex=q;var g=z(1),T=z(6);function V(Pt,P,U){for(const B of U)P.addEventListener(B,Pt[B].bind(Pt))}function q(Pt){return Math.round(Math.min(255,Math.max(1,255*Pt))).toString(16).padStart(2,"0")}class et{constructor(){Q(this,x,0)}getId(){return`${g.AnnotationEditorPrefix}${ie(this,x)._++}`}}x=new WeakMap;class I{constructor(P=128){Q(this,v,[]);Q(this,d,!1);Q(this,m,void 0);Q(this,s,-1);pt(this,m,P)}add({cmd:P,undo:U,mustExec:B,type:_t=NaN,overwriteIfSameType:Ct=!1,keepUndo:J=!1}){if(B&&P(),p(this,d))return;const ht={cmd:P,undo:U,type:_t};if(p(this,s)===-1){p(this,v).length>0&&(p(this,v).length=0),pt(this,s,0),p(this,v).push(ht);return}if(Ct&&p(this,v)[p(this,s)].type===_t){J&&(ht.undo=p(this,v)[p(this,s)].undo),p(this,v)[p(this,s)]=ht;return}const vt=p(this,s)+1;vt===p(this,m)?p(this,v).splice(0,1):(pt(this,s,vt),vt<p(this,v).length&&p(this,v).splice(vt)),p(this,v).push(ht)}undo(){p(this,s)!==-1&&(pt(this,d,!0),p(this,v)[p(this,s)].undo(),pt(this,d,!1),pt(this,s,p(this,s)-1))}redo(){p(this,s)<p(this,v).length-1&&(pt(this,s,p(this,s)+1),pt(this,d,!0),p(this,v)[p(this,s)].cmd(),pt(this,d,!1))}hasSomethingToUndo(){return p(this,s)!==-1}hasSomethingToRedo(){return p(this,s)<p(this,v).length-1}destroy(){pt(this,v,null)}}v=new WeakMap,d=new WeakMap,m=new WeakMap,s=new WeakMap,f.CommandManager=I;class S{constructor(P){Q(this,a);this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:U}=g.FeatureTest.platform;for(const[B,_t]of P)for(const Ct of B){const J=Ct.startsWith("mac+");U&&J?(this.callbacks.set(Ct.slice(4),_t),this.allKeys.add(Ct.split("+").at(-1))):!U&&!J&&(this.callbacks.set(Ct,_t),this.allKeys.add(Ct.split("+").at(-1)))}}exec(P,U){if(!this.allKeys.has(U.key))return;const B=this.callbacks.get(ot(this,a,De).call(this,U));B&&(B.bind(P)(),U.stopPropagation(),U.preventDefault())}}a=new WeakSet,De=function(P){P.altKey&&this.buffer.push("alt"),P.ctrlKey&&this.buffer.push("ctrl"),P.metaKey&&this.buffer.push("meta"),P.shiftKey&&this.buffer.push("shift"),this.buffer.push(P.key);const U=this.buffer.join("+");return this.buffer.length=0,U},f.KeyboardManager=S;const M=class M{get _colors(){const P=new Map([["CanvasText",null],["Canvas",null]]);return(0,T.getColorValues)(P),(0,g.shadow)(this,"_colors",P)}convert(P){const U=(0,T.getRGB)(P);if(!window.matchMedia("(forced-colors: active)").matches)return U;for(const[B,_t]of this._colors)if(_t.every((Ct,J)=>Ct===U[J]))return M._colorsMapping.get(B);return U}getHexCode(P){const U=this._colors.get(P);return U?g.Util.makeHexColor(...U):P}};Dt(M,"_colorsMapping",new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]));let b=M;f.ColorManager=b;const At=class At{constructor(P,U,B){Q(this,R);Q(this,H);Q(this,$);Q(this,k);Q(this,r);Q(this,E);Q(this,N);Q(this,Z);Q(this,rt);Q(this,ct);Q(this,gt);Q(this,A,null);Q(this,t,new Map);Q(this,l,new Map);Q(this,o,null);Q(this,n,new I);Q(this,u,0);Q(this,C,null);Q(this,i,new Set);Q(this,O,null);Q(this,X,new et);Q(this,Y,!1);Q(this,tt,g.AnnotationEditorType.NONE);Q(this,nt,new Set);Q(this,ft,this.copy.bind(this));Q(this,lt,this.cut.bind(this));Q(this,ut,this.paste.bind(this));Q(this,bt,this.keydown.bind(this));Q(this,yt,this.onEditingAction.bind(this));Q(this,W,this.onPageChanging.bind(this));Q(this,c,this.onScaleChanging.bind(this));Q(this,h,this.onRotationChanging.bind(this));Q(this,y,{isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1});Q(this,j,null);pt(this,j,P),pt(this,O,U),p(this,O)._on("editingaction",p(this,yt)),p(this,O)._on("pagechanging",p(this,W)),p(this,O)._on("scalechanging",p(this,c)),p(this,O)._on("rotationchanging",p(this,h)),pt(this,o,B),this.viewParameters={realScale:T.PixelsPerInch.PDF_TO_CSS_UNITS,rotation:0}}destroy(){ot(this,H,fe).call(this),p(this,O)._off("editingaction",p(this,yt)),p(this,O)._off("pagechanging",p(this,W)),p(this,O)._off("scalechanging",p(this,c)),p(this,O)._off("rotationchanging",p(this,h));for(const P of p(this,l).values())P.destroy();p(this,l).clear(),p(this,t).clear(),p(this,i).clear(),pt(this,A,null),p(this,nt).clear(),p(this,n).destroy()}onPageChanging({pageNumber:P}){pt(this,u,P-1)}focusMainContainer(){p(this,j).focus()}addShouldRescale(P){p(this,i).add(P)}removeShouldRescale(P){p(this,i).delete(P)}onScaleChanging({scale:P}){this.commitOrRemove(),this.viewParameters.realScale=P*T.PixelsPerInch.PDF_TO_CSS_UNITS;for(const U of p(this,i))U.onScaleChanging()}onRotationChanging({pagesRotation:P}){this.commitOrRemove(),this.viewParameters.rotation=P}addToAnnotationStorage(P){!P.isEmpty()&&p(this,o)&&!p(this,o).has(P.id)&&p(this,o).setValue(P.id,P)}copy(P){if(P.preventDefault(),p(this,A)&&p(this,A).commitOrRemove(),!this.hasSelection)return;const U=[];for(const B of p(this,nt))B.isEmpty()||U.push(B.serialize());U.length!==0&&P.clipboardData.setData("application/pdfjs",JSON.stringify(U))}cut(P){this.copy(P),this.delete()}paste(P){P.preventDefault();let U=P.clipboardData.getData("application/pdfjs");if(!U)return;try{U=JSON.parse(U)}catch(_t){(0,g.warn)(`paste: "${_t.message}".`);return}if(!Array.isArray(U))return;this.unselectAll();const B=p(this,l).get(p(this,u));try{const _t=[];for(const ht of U){const vt=B.deserialize(ht);if(!vt)return;_t.push(vt)}const Ct=()=>{for(const ht of _t)ot(this,rt,pe).call(this,ht);ot(this,gt,ge).call(this,_t)},J=()=>{for(const ht of _t)ht.remove()};this.addCommands({cmd:Ct,undo:J,mustExec:!0})}catch(_t){(0,g.warn)(`paste: "${_t.message}".`)}}keydown(P){var U;(U=this.getActive())!=null&&U.shouldGetKeyboardEvents()||At._keyboardManager.exec(this,P)}onEditingAction(P){["undo","redo","delete","selectAll"].includes(P.name)&&this[P.name]()}setEditingState(P){P?(ot(this,R,Oe).call(this),ot(this,$,Ie).call(this),ot(this,r,Wt).call(this,{isEditing:p(this,tt)!==g.AnnotationEditorType.NONE,isEmpty:ot(this,ct,Qt).call(this),hasSomethingToUndo:p(this,n).hasSomethingToUndo(),hasSomethingToRedo:p(this,n).hasSomethingToRedo(),hasSelectedEditor:!1})):(ot(this,H,fe).call(this),ot(this,k,Le).call(this),ot(this,r,Wt).call(this,{isEditing:!1}))}registerEditorTypes(P){if(!p(this,C)){pt(this,C,P);for(const U of p(this,C))ot(this,E,Jt).call(this,U.defaultPropertiesToUpdate)}}getId(){return p(this,X).getId()}get currentLayer(){return p(this,l).get(p(this,u))}get currentPageIndex(){return p(this,u)}addLayer(P){p(this,l).set(P.pageIndex,P),p(this,Y)?P.enable():P.disable()}removeLayer(P){p(this,l).delete(P.pageIndex)}updateMode(P){if(pt(this,tt,P),P===g.AnnotationEditorType.NONE)this.setEditingState(!1),ot(this,Z,je).call(this);else{this.setEditingState(!0),ot(this,N,Ne).call(this);for(const U of p(this,l).values())U.updateMode(P)}}updateToolbar(P){P!==p(this,tt)&&p(this,O).dispatch("switchannotationeditormode",{source:this,mode:P})}updateParams(P,U){if(p(this,C)){for(const B of p(this,nt))B.updateParams(P,U);for(const B of p(this,C))B.updateDefaultParams(P,U)}}getEditors(P){const U=[];for(const B of p(this,t).values())B.pageIndex===P&&U.push(B);return U}getEditor(P){return p(this,t).get(P)}addEditor(P){p(this,t).set(P.id,P)}removeEditor(P){var U;p(this,t).delete(P.id),this.unselect(P),(U=p(this,o))==null||U.remove(P.id)}setActiveEditor(P){p(this,A)!==P&&(pt(this,A,P),P&&ot(this,E,Jt).call(this,P.propertiesToUpdate))}toggleSelected(P){if(p(this,nt).has(P)){p(this,nt).delete(P),P.unselect(),ot(this,r,Wt).call(this,{hasSelectedEditor:this.hasSelection});return}p(this,nt).add(P),P.select(),ot(this,E,Jt).call(this,P.propertiesToUpdate),ot(this,r,Wt).call(this,{hasSelectedEditor:!0})}setSelected(P){for(const U of p(this,nt))U!==P&&U.unselect();p(this,nt).clear(),p(this,nt).add(P),P.select(),ot(this,E,Jt).call(this,P.propertiesToUpdate),ot(this,r,Wt).call(this,{hasSelectedEditor:!0})}isSelected(P){return p(this,nt).has(P)}unselect(P){P.unselect(),p(this,nt).delete(P),ot(this,r,Wt).call(this,{hasSelectedEditor:this.hasSelection})}get hasSelection(){return p(this,nt).size!==0}undo(){p(this,n).undo(),ot(this,r,Wt).call(this,{hasSomethingToUndo:p(this,n).hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:ot(this,ct,Qt).call(this)})}redo(){p(this,n).redo(),ot(this,r,Wt).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:p(this,n).hasSomethingToRedo(),isEmpty:ot(this,ct,Qt).call(this)})}addCommands(P){p(this,n).add(P),ot(this,r,Wt).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:ot(this,ct,Qt).call(this)})}delete(){if(this.commitOrRemove(),!this.hasSelection)return;const P=[...p(this,nt)],U=()=>{for(const _t of P)_t.remove()},B=()=>{for(const _t of P)ot(this,rt,pe).call(this,_t)};this.addCommands({cmd:U,undo:B,mustExec:!0})}commitOrRemove(){var P;(P=p(this,A))==null||P.commitOrRemove()}selectAll(){for(const P of p(this,nt))P.commit();ot(this,gt,ge).call(this,p(this,t).values())}unselectAll(){if(p(this,A)){p(this,A).commitOrRemove();return}if(p(this,nt).size!==0){for(const P of p(this,nt))P.unselect();p(this,nt).clear(),ot(this,r,Wt).call(this,{hasSelectedEditor:!1})}}isActive(P){return p(this,A)===P}getActive(){return p(this,A)}getMode(){return p(this,tt)}};A=new WeakMap,t=new WeakMap,l=new WeakMap,o=new WeakMap,n=new WeakMap,u=new WeakMap,C=new WeakMap,i=new WeakMap,O=new WeakMap,X=new WeakMap,Y=new WeakMap,tt=new WeakMap,nt=new WeakMap,ft=new WeakMap,lt=new WeakMap,ut=new WeakMap,bt=new WeakMap,yt=new WeakMap,W=new WeakMap,c=new WeakMap,h=new WeakMap,y=new WeakMap,j=new WeakMap,R=new WeakSet,Oe=function(){p(this,j).addEventListener("keydown",p(this,bt))},H=new WeakSet,fe=function(){p(this,j).removeEventListener("keydown",p(this,bt))},$=new WeakSet,Ie=function(){document.addEventListener("copy",p(this,ft)),document.addEventListener("cut",p(this,lt)),document.addEventListener("paste",p(this,ut))},k=new WeakSet,Le=function(){document.removeEventListener("copy",p(this,ft)),document.removeEventListener("cut",p(this,lt)),document.removeEventListener("paste",p(this,ut))},r=new WeakSet,Wt=function(P){Object.entries(P).some(([B,_t])=>p(this,y)[B]!==_t)&&p(this,O).dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(p(this,y),P)})},E=new WeakSet,Jt=function(P){p(this,O).dispatch("annotationeditorparamschanged",{source:this,details:P})},N=new WeakSet,Ne=function(){if(!p(this,Y)){pt(this,Y,!0);for(const P of p(this,l).values())P.enable()}},Z=new WeakSet,je=function(){if(this.unselectAll(),p(this,Y)){pt(this,Y,!1);for(const P of p(this,l).values())P.disable()}},rt=new WeakSet,pe=function(P){const U=p(this,l).get(P.pageIndex);U?U.addOrRebuild(P):this.addEditor(P)},ct=new WeakSet,Qt=function(){if(p(this,t).size===0)return!0;if(p(this,t).size===1)for(const P of p(this,t).values())return P.isEmpty();return!1},gt=new WeakSet,ge=function(P){p(this,nt).clear();for(const U of P)U.isEmpty()||(p(this,nt).add(U),U.select());ot(this,r,Wt).call(this,{hasSelectedEditor:!0})},Dt(At,"_keyboardManager",new S([[["ctrl+a","mac+meta+a"],At.prototype.selectAll],[["ctrl+z","mac+meta+z"],At.prototype.undo],[["ctrl+y","ctrl+shift+Z","mac+meta+shift+Z"],At.prototype.redo],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete"],At.prototype.delete],[["Escape","mac+Escape"],At.prototype.unselectAll]]));let w=At;f.AnnotationEditorUIManager=w},(at,f,z)=>{var ft,lt,ut,bt,yt,W,c,h,y,zt,R,Xt,H,qt;Object.defineProperty(f,"__esModule",{value:!0}),f.StatTimer=f.RenderingCancelledException=f.PixelsPerInch=f.PageViewport=f.PDFDateString=f.DOMStandardFontDataFactory=f.DOMSVGFactory=f.DOMFilterFactory=f.DOMCanvasFactory=f.DOMCMapReaderFactory=f.AnnotationPrefix=void 0,f.deprecated=o,f.getColorValues=O,f.getCurrentTransform=X,f.getCurrentTransformInverse=Y,f.getFilenameFromUrl=F,f.getPdfFilenameFromUrl=M,f.getRGB=i,f.getXfaPageViewport=C,f.isDataScheme=s,f.isPdfFile=a,f.isValidFetchUrl=t,f.loadScript=l,f.setLayerDimensions=tt;var g=z(7),T=z(1);const V="http://www.w3.org/2000/svg",q="pdfjs_internal_id_";f.AnnotationPrefix=q;const nt=class nt{};Dt(nt,"CSS",96),Dt(nt,"PDF",72),Dt(nt,"PDF_TO_CSS_UNITS",nt.CSS/nt.PDF);let et=nt;f.PixelsPerInch=et;class I extends g.BaseFilterFactory{constructor({docId:k,ownerDocument:e=globalThis.document}={}){super();Q(this,y);Q(this,R);Q(this,H);Q(this,ft,void 0);Q(this,lt,void 0);Q(this,ut,void 0);Q(this,bt,void 0);Q(this,yt,void 0);Q(this,W,void 0);Q(this,c,void 0);Q(this,h,0);pt(this,ut,k),pt(this,bt,e)}addFilter(k){if(!k)return"none";let e=p(this,y,zt).get(k);if(e)return e;let r,_,E,D;if(k.length===1){const rt=k[0],dt=new Array(256);for(let ct=0;ct<256;ct++)dt[ct]=rt[ct]/255;D=r=_=E=dt.join(",")}else{const[rt,dt,ct]=k,mt=new Array(256),gt=new Array(256),Et=new Array(256);for(let At=0;At<256;At++)mt[At]=rt[At]/255,gt[At]=dt[At]/255,Et[At]=ct[At]/255;r=mt.join(","),_=gt.join(","),E=Et.join(","),D=`${r}${_}${E}`}if(e=p(this,y,zt).get(D),e)return p(this,y,zt).set(k,e),e;const N=`g_${p(this,ut)}_transfer_map_${ie(this,h)._++}`,st=`url(#${N})`;p(this,y,zt).set(k,st),p(this,y,zt).set(D,st);const Z=p(this,bt).createElementNS(V,"filter",V);Z.setAttribute("id",N),Z.setAttribute("color-interpolation-filters","sRGB");const it=p(this,bt).createElementNS(V,"feComponentTransfer");return Z.append(it),ot(this,H,qt).call(this,it,"feFuncR",r),ot(this,H,qt).call(this,it,"feFuncG",_),ot(this,H,qt).call(this,it,"feFuncB",E),p(this,R,Xt).append(Z),st}addHCMFilter(k,e){var ct;const r=`${k}-${e}`;if(p(this,W)===r)return p(this,c);if(pt(this,W,r),pt(this,c,"none"),(ct=p(this,yt))==null||ct.remove(),!k||!e)return p(this,c);p(this,R,Xt).style.color=k,k=getComputedStyle(p(this,R,Xt)).getPropertyValue("color");const _=i(k);k=T.Util.makeHexColor(..._),p(this,R,Xt).style.color=e,e=getComputedStyle(p(this,R,Xt)).getPropertyValue("color");const E=i(e);if(e=T.Util.makeHexColor(...E),p(this,R,Xt).style.color="",k==="#000000"&&e==="#ffffff"||k===e)return p(this,c);const D=new Array(256);for(let mt=0;mt<=255;mt++){const gt=mt/255;D[mt]=gt<=.03928?gt/12.92:((gt+.055)/1.055)**2.4}const N=D.join(","),st=`g_${p(this,ut)}_hcm_filter`,Z=pt(this,yt,p(this,bt).createElementNS(V,"filter",V));Z.setAttribute("id",st),Z.setAttribute("color-interpolation-filters","sRGB");let it=p(this,bt).createElementNS(V,"feComponentTransfer");Z.append(it),ot(this,H,qt).call(this,it,"feFuncR",N),ot(this,H,qt).call(this,it,"feFuncG",N),ot(this,H,qt).call(this,it,"feFuncB",N);const rt=p(this,bt).createElementNS(V,"feColorMatrix");rt.setAttribute("type","matrix"),rt.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),Z.append(rt),it=p(this,bt).createElementNS(V,"feComponentTransfer"),Z.append(it);const dt=(mt,gt)=>{const Et=_[mt]/255,At=E[mt]/255,Pt=new Array(gt+1);for(let P=0;P<=gt;P++)Pt[P]=Et+P/gt*(At-Et);return Pt.join(",")};return ot(this,H,qt).call(this,it,"feFuncR",dt(0,5)),ot(this,H,qt).call(this,it,"feFuncG",dt(1,5)),ot(this,H,qt).call(this,it,"feFuncB",dt(2,5)),p(this,R,Xt).append(Z),pt(this,c,`url(#${st})`),p(this,c)}destroy(k=!1){k&&p(this,c)||(p(this,lt)&&(p(this,lt).parentNode.parentNode.remove(),pt(this,lt,null)),p(this,ft)&&(p(this,ft).clear(),pt(this,ft,null)),pt(this,h,0))}}ft=new WeakMap,lt=new WeakMap,ut=new WeakMap,bt=new WeakMap,yt=new WeakMap,W=new WeakMap,c=new WeakMap,h=new WeakMap,y=new WeakSet,zt=function(){return p(this,ft)||pt(this,ft,new Map)},R=new WeakSet,Xt=function(){if(!p(this,lt)){const k=p(this,bt).createElement("div"),{style:e}=k;e.visibility="hidden",e.contain="strict",e.width=e.height=0,e.position="absolute",e.top=e.left=0,e.zIndex=-1;const r=p(this,bt).createElementNS(V,"svg");r.setAttribute("width",0),r.setAttribute("height",0),pt(this,lt,p(this,bt).createElementNS(V,"defs")),k.append(r),r.append(p(this,lt)),p(this,bt).body.append(k)}return p(this,lt)},H=new WeakSet,qt=function(k,e,r){const _=p(this,bt).createElementNS(V,e);_.setAttribute("type","discrete"),_.setAttribute("tableValues",r),k.append(_)},f.DOMFilterFactory=I;class S extends g.BaseCanvasFactory{constructor({ownerDocument:L=globalThis.document}={}){super(),this._document=L}_createCanvas(L,k){const e=this._document.createElement("canvas");return e.width=L,e.height=k,e}}f.DOMCanvasFactory=S;async function b($,L=!1){if(t($,document.baseURI)){const k=await fetch($);if(!k.ok)throw new Error(k.statusText);return L?new Uint8Array(await k.arrayBuffer()):(0,T.stringToBytes)(await k.text())}return new Promise((k,e)=>{const r=new XMLHttpRequest;r.open("GET",$,!0),L&&(r.responseType="arraybuffer"),r.onreadystatechange=()=>{if(r.readyState===XMLHttpRequest.DONE){if(r.status===200||r.status===0){let _;if(L&&r.response?_=new Uint8Array(r.response):!L&&r.responseText&&(_=(0,T.stringToBytes)(r.responseText)),_){k(_);return}}e(new Error(r.statusText))}},r.send(null)})}class w extends g.BaseCMapReaderFactory{_fetchData(L,k){return b(L,this.isCompressed).then(e=>({cMapData:e,compressionType:k}))}}f.DOMCMapReaderFactory=w;class x extends g.BaseStandardFontDataFactory{_fetchData(L){return b(L,!0)}}f.DOMStandardFontDataFactory=x;class v extends g.BaseSVGFactory{_createSVG(L){return document.createElementNS(V,L)}}f.DOMSVGFactory=v;class d{constructor({viewBox:L,scale:k,rotation:e,offsetX:r=0,offsetY:_=0,dontFlip:E=!1}){this.viewBox=L,this.scale=k,this.rotation=e,this.offsetX=r,this.offsetY=_;const D=(L[2]+L[0])/2,N=(L[3]+L[1])/2;let st,Z,it,rt;switch(e%=360,e<0&&(e+=360),e){case 180:st=-1,Z=0,it=0,rt=1;break;case 90:st=0,Z=1,it=1,rt=0;break;case 270:st=0,Z=-1,it=-1,rt=0;break;case 0:st=1,Z=0,it=0,rt=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}E&&(it=-it,rt=-rt);let dt,ct,mt,gt;st===0?(dt=Math.abs(N-L[1])*k+r,ct=Math.abs(D-L[0])*k+_,mt=(L[3]-L[1])*k,gt=(L[2]-L[0])*k):(dt=Math.abs(D-L[0])*k+r,ct=Math.abs(N-L[1])*k+_,mt=(L[2]-L[0])*k,gt=(L[3]-L[1])*k),this.transform=[st*k,Z*k,it*k,rt*k,dt-st*k*D-it*k*N,ct-Z*k*D-rt*k*N],this.width=mt,this.height=gt}get rawDims(){const{viewBox:L}=this;return(0,T.shadow)(this,"rawDims",{pageWidth:L[2]-L[0],pageHeight:L[3]-L[1],pageX:L[0],pageY:L[1]})}clone({scale:L=this.scale,rotation:k=this.rotation,offsetX:e=this.offsetX,offsetY:r=this.offsetY,dontFlip:_=!1}={}){return new d({viewBox:this.viewBox.slice(),scale:L,rotation:k,offsetX:e,offsetY:r,dontFlip:_})}convertToViewportPoint(L,k){return T.Util.applyTransform([L,k],this.transform)}convertToViewportRectangle(L){const k=T.Util.applyTransform([L[0],L[1]],this.transform),e=T.Util.applyTransform([L[2],L[3]],this.transform);return[k[0],k[1],e[0],e[1]]}convertToPdfPoint(L,k){return T.Util.applyInverseTransform([L,k],this.transform)}}f.PageViewport=d;class m extends T.BaseException{constructor(L,k,e=0){super(L,"RenderingCancelledException"),this.type=k,this.extraDelay=e}}f.RenderingCancelledException=m;function s($){const L=$.length;let k=0;for(;k<L&&$[k].trim()==="";)k++;return $.substring(k,k+5).toLowerCase()==="data:"}function a($){return typeof $=="string"&&/\.pdf$/i.test($)}function F($,L=!1){return L||([$]=$.split(/[#?]/,1)),$.substring($.lastIndexOf("/")+1)}function M($,L="document.pdf"){if(typeof $!="string")return L;if(s($))return(0,T.warn)('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),L;const k=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,e=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,r=k.exec($);let _=e.exec(r[1])||e.exec(r[2])||e.exec(r[3]);if(_&&(_=_[0],_.includes("%")))try{_=e.exec(decodeURIComponent(_))[0]}catch{}return _||L}class A{constructor(){Dt(this,"started",Object.create(null));Dt(this,"times",[])}time(L){L in this.started&&(0,T.warn)(`Timer is already running for ${L}`),this.started[L]=Date.now()}timeEnd(L){L in this.started||(0,T.warn)(`Timer has not been started for ${L}`),this.times.push({name:L,start:this.started[L],end:Date.now()}),delete this.started[L]}toString(){const L=[];let k=0;for(const{name:e}of this.times)k=Math.max(e.length,k);for(const{name:e,start:r,end:_}of this.times)L.push(`${e.padEnd(k)} ${_-r}ms
`);return L.join("")}}f.StatTimer=A;function t($,L){try{const{protocol:k}=L?new URL($,L):new URL($);return k==="http:"||k==="https:"}catch{return!1}}function l($,L=!1){return new Promise((k,e)=>{const r=document.createElement("script");r.src=$,r.onload=function(_){L&&r.remove(),k(_)},r.onerror=function(){e(new Error(`Cannot load script at: ${r.src}`))},(document.head||document.documentElement).append(r)})}function o($){console.log("Deprecated API usage: "+$)}let n;class u{static toDateObject(L){if(!L||typeof L!="string")return null;n||(n=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));const k=n.exec(L);if(!k)return null;const e=parseInt(k[1],10);let r=parseInt(k[2],10);r=r>=1&&r<=12?r-1:0;let _=parseInt(k[3],10);_=_>=1&&_<=31?_:1;let E=parseInt(k[4],10);E=E>=0&&E<=23?E:0;let D=parseInt(k[5],10);D=D>=0&&D<=59?D:0;let N=parseInt(k[6],10);N=N>=0&&N<=59?N:0;const st=k[7]||"Z";let Z=parseInt(k[8],10);Z=Z>=0&&Z<=23?Z:0;let it=parseInt(k[9],10)||0;return it=it>=0&&it<=59?it:0,st==="-"?(E+=Z,D+=it):st==="+"&&(E-=Z,D-=it),new Date(Date.UTC(e,r,_,E,D,N))}}f.PDFDateString=u;function C($,{scale:L=1,rotation:k=0}){const{width:e,height:r}=$.attributes.style,_=[0,0,parseInt(e),parseInt(r)];return new d({viewBox:_,scale:L,rotation:k})}function i($){if($.startsWith("#")){const L=parseInt($.slice(1),16);return[(L&16711680)>>16,(L&65280)>>8,L&255]}return $.startsWith("rgb(")?$.slice(4,-1).split(",").map(L=>parseInt(L)):$.startsWith("rgba(")?$.slice(5,-1).split(",").map(L=>parseInt(L)).slice(0,3):((0,T.warn)(`Not a valid color format: "${$}"`),[0,0,0])}function O($){const L=document.createElement("span");L.style.visibility="hidden",document.body.append(L);for(const k of $.keys()){L.style.color=k;const e=window.getComputedStyle(L).color;$.set(k,i(e))}L.remove()}function X($){const{a:L,b:k,c:e,d:r,e:_,f:E}=$.getTransform();return[L,k,e,r,_,E]}function Y($){const{a:L,b:k,c:e,d:r,e:_,f:E}=$.getTransform().invertSelf();return[L,k,e,r,_,E]}function tt($,L,k=!1,e=!0){if(L instanceof d){const{pageWidth:r,pageHeight:_}=L.rawDims,{style:E}=$,D=`calc(var(--scale-factor) * ${r}px)`,N=`calc(var(--scale-factor) * ${_}px)`;!k||L.rotation%180===0?(E.width=D,E.height=N):(E.width=N,E.height=D)}e&&$.setAttribute("data-main-rotation",L.rotation)}},(at,f,z)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.BaseStandardFontDataFactory=f.BaseSVGFactory=f.BaseFilterFactory=f.BaseCanvasFactory=f.BaseCMapReaderFactory=void 0;var g=z(1);class T{constructor(){this.constructor===T&&(0,g.unreachable)("Cannot initialize BaseFilterFactory.")}addFilter(b){return"none"}addHCMFilter(b,w){return"none"}destroy(b=!1){}}f.BaseFilterFactory=T;class V{constructor(){this.constructor===V&&(0,g.unreachable)("Cannot initialize BaseCanvasFactory.")}create(b,w){if(b<=0||w<=0)throw new Error("Invalid canvas size");const x=this._createCanvas(b,w);return{canvas:x,context:x.getContext("2d")}}reset(b,w,x){if(!b.canvas)throw new Error("Canvas is not specified");if(w<=0||x<=0)throw new Error("Invalid canvas size");b.canvas.width=w,b.canvas.height=x}destroy(b){if(!b.canvas)throw new Error("Canvas is not specified");b.canvas.width=0,b.canvas.height=0,b.canvas=null,b.context=null}_createCanvas(b,w){(0,g.unreachable)("Abstract method `_createCanvas` called.")}}f.BaseCanvasFactory=V;class q{constructor({baseUrl:b=null,isCompressed:w=!0}){this.constructor===q&&(0,g.unreachable)("Cannot initialize BaseCMapReaderFactory."),this.baseUrl=b,this.isCompressed=w}async fetch({name:b}){if(!this.baseUrl)throw new Error('The CMap "baseUrl" parameter must be specified, ensure that the "cMapUrl" and "cMapPacked" API parameters are provided.');if(!b)throw new Error("CMap name must be specified.");const w=this.baseUrl+b+(this.isCompressed?".bcmap":""),x=this.isCompressed?g.CMapCompressionType.BINARY:g.CMapCompressionType.NONE;return this._fetchData(w,x).catch(v=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${w}`)})}_fetchData(b,w){(0,g.unreachable)("Abstract method `_fetchData` called.")}}f.BaseCMapReaderFactory=q;class et{constructor({baseUrl:b=null}){this.constructor===et&&(0,g.unreachable)("Cannot initialize BaseStandardFontDataFactory."),this.baseUrl=b}async fetch({filename:b}){if(!this.baseUrl)throw new Error('The standard font "baseUrl" parameter must be specified, ensure that the "standardFontDataUrl" API parameter is provided.');if(!b)throw new Error("Font filename must be specified.");const w=`${this.baseUrl}${b}`;return this._fetchData(w).catch(x=>{throw new Error(`Unable to load font data at: ${w}`)})}_fetchData(b){(0,g.unreachable)("Abstract method `_fetchData` called.")}}f.BaseStandardFontDataFactory=et;class I{constructor(){this.constructor===I&&(0,g.unreachable)("Cannot initialize BaseSVGFactory.")}create(b,w,x=!1){if(b<=0||w<=0)throw new Error("Invalid SVG dimensions");const v=this._createSVG("svg:svg");return v.setAttribute("version","1.1"),x||(v.setAttribute("width",`${b}px`),v.setAttribute("height",`${w}px`)),v.setAttribute("preserveAspectRatio","none"),v.setAttribute("viewBox",`0 0 ${b} ${w}`),v}createElement(b){if(typeof b!="string")throw new Error("Invalid SVG element type");return this._createSVG(b)}_createSVG(b){(0,g.unreachable)("Abstract method `_createSVG` called.")}}f.BaseSVGFactory=I},(at,f,z)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.MurmurHash3_64=void 0;var g=z(1);const T=3285377520,V=4294901760,q=65535;class et{constructor(S){this.h1=S?S&4294967295:T,this.h2=S?S&4294967295:T}update(S){let b,w;if(typeof S=="string"){b=new Uint8Array(S.length*2),w=0;for(let o=0,n=S.length;o<n;o++){const u=S.charCodeAt(o);u<=255?b[w++]=u:(b[w++]=u>>>8,b[w++]=u&255)}}else if((0,g.isArrayBuffer)(S))b=S.slice(),w=b.byteLength;else throw new Error("Wrong data format in MurmurHash3_64_update. Input must be a string or array.");const x=w>>2,v=w-x*4,d=new Uint32Array(b.buffer,0,x);let m=0,s=0,a=this.h1,F=this.h2;const M=3432918353,A=461845907,t=M&q,l=A&q;for(let o=0;o<x;o++)o&1?(m=d[o],m=m*M&V|m*t&q,m=m<<15|m>>>17,m=m*A&V|m*l&q,a^=m,a=a<<13|a>>>19,a=a*5+3864292196):(s=d[o],s=s*M&V|s*t&q,s=s<<15|s>>>17,s=s*A&V|s*l&q,F^=s,F=F<<13|F>>>19,F=F*5+3864292196);switch(m=0,v){case 3:m^=b[x*4+2]<<16;case 2:m^=b[x*4+1]<<8;case 1:m^=b[x*4],m=m*M&V|m*t&q,m=m<<15|m>>>17,m=m*A&V|m*l&q,x&1?a^=m:F^=m}this.h1=a,this.h2=F}hexdigest(){let S=this.h1,b=this.h2;return S^=b>>>1,S=S*3981806797&V|S*36045&q,b=b*4283543511&V|((b<<16|S>>>16)*2950163797&V)>>>16,S^=b>>>1,S=S*444984403&V|S*60499&q,b=b*3301882366&V|((b<<16|S>>>16)*3120437893&V)>>>16,S^=b>>>1,(S>>>0).toString(16).padStart(8,"0")+(b>>>0).toString(16).padStart(8,"0")}}f.MurmurHash3_64=et},(at,f,z)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.FontLoader=f.FontFaceObject=void 0;var g=z(1),T=z(10);class V{constructor({ownerDocument:I=globalThis.document,styleElement:S=null}){this._document=I,this.nativeFontFaces=[],this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(I){this.nativeFontFaces.push(I),this._document.fonts.add(I)}insertRule(I){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const S=this.styleElement.sheet;S.insertRule(I,S.cssRules.length)}clear(){for(const I of this.nativeFontFaces)this._document.fonts.delete(I);this.nativeFontFaces.length=0,this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async bind(I){if(I.attached||I.missingFile)return;if(I.attached=!0,this.isFontLoadingAPISupported){const b=I.createNativeFontFace();if(b){this.addNativeFontFace(b);try{await b.loaded}catch(w){throw(0,g.warn)(`Failed to load font '${b.family}': '${w}'.`),I.disableFontFace=!0,w}}return}const S=I.createFontFaceRule();if(S){if(this.insertRule(S),this.isSyncFontLoadingSupported)return;await new Promise(b=>{const w=this._queueLoadingCallback(b);this._prepareFontLoadEvent(I,w)})}}get isFontLoadingAPISupported(){var S;const I=!!((S=this._document)!=null&&S.fonts);return(0,g.shadow)(this,"isFontLoadingAPISupported",I)}get isSyncFontLoadingSupported(){let I=!1;return(T.isNodeJS||typeof navigator<"u"&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent))&&(I=!0),(0,g.shadow)(this,"isSyncFontLoadingSupported",I)}_queueLoadingCallback(I){function S(){for((0,g.assert)(!w.done,"completeRequest() cannot be called twice."),w.done=!0;b.length>0&&b[0].done;){const x=b.shift();setTimeout(x.callback,0)}}const{loadingRequests:b}=this,w={done:!1,complete:S,callback:I};return b.push(w),w}get _loadTestFont(){const I=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return(0,g.shadow)(this,"_loadTestFont",I)}_prepareFontLoadEvent(I,S){function b(i,O){return i.charCodeAt(O)<<24|i.charCodeAt(O+1)<<16|i.charCodeAt(O+2)<<8|i.charCodeAt(O+3)&255}function w(i,O,X,Y){const tt=i.substring(0,O),nt=i.substring(O+X);return tt+Y+nt}let x,v;const d=this._document.createElement("canvas");d.width=1,d.height=1;const m=d.getContext("2d");let s=0;function a(i,O){if(++s>30){(0,g.warn)("Load test font never loaded."),O();return}if(m.font="30px "+i,m.fillText(".",0,20),m.getImageData(0,0,1,1).data[3]>0){O();return}setTimeout(a.bind(null,i,O))}const F=`lt${Date.now()}${this.loadTestFontId++}`;let M=this._loadTestFont;M=w(M,976,F.length,F);const t=16,l=1482184792;let o=b(M,t);for(x=0,v=F.length-3;x<v;x+=4)o=o-l+b(F,x)|0;x<F.length&&(o=o-l+b(F+"XXX",x)|0),M=w(M,t,4,(0,g.string32)(o));const n=`url(data:font/opentype;base64,${btoa(M)});`,u=`@font-face {font-family:"${F}";src:${n}}`;this.insertRule(u);const C=this._document.createElement("div");C.style.visibility="hidden",C.style.width=C.style.height="10px",C.style.position="absolute",C.style.top=C.style.left="0px";for(const i of[I.loadedName,F]){const O=this._document.createElement("span");O.textContent="Hi",O.style.fontFamily=i,C.append(O)}this._document.body.append(C),a(F,()=>{C.remove(),S.complete()})}}f.FontLoader=V;class q{constructor(I,{isEvalSupported:S=!0,disableFontFace:b=!1,ignoreErrors:w=!1,inspectFont:x=null}){this.compiledGlyphs=Object.create(null);for(const v in I)this[v]=I[v];this.isEvalSupported=S!==!1,this.disableFontFace=b===!0,this.ignoreErrors=w===!0,this._inspectFont=x}createNativeFontFace(){var S;if(!this.data||this.disableFontFace)return null;let I;if(!this.cssFontInfo)I=new FontFace(this.loadedName,this.data,{});else{const b={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(b.style=`oblique ${this.cssFontInfo.italicAngle}deg`),I=new FontFace(this.cssFontInfo.fontFamily,this.data,b)}return(S=this._inspectFont)==null||S.call(this,this),I}createFontFaceRule(){var w;if(!this.data||this.disableFontFace)return null;const I=(0,g.bytesToString)(this.data),S=`url(data:${this.mimetype};base64,${btoa(I)});`;let b;if(!this.cssFontInfo)b=`@font-face {font-family:"${this.loadedName}";src:${S}}`;else{let x=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(x+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),b=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${x}src:${S}}`}return(w=this._inspectFont)==null||w.call(this,this,S),b}getPathGenerator(I,S){if(this.compiledGlyphs[S]!==void 0)return this.compiledGlyphs[S];let b;try{b=I.get(this.loadedName+"_path_"+S)}catch(w){if(!this.ignoreErrors)throw w;return(0,g.warn)(`getPathGenerator - ignoring character: "${w}".`),this.compiledGlyphs[S]=function(x,v){}}if(this.isEvalSupported&&g.FeatureTest.isEvalSupported){const w=[];for(const x of b){const v=x.args!==void 0?x.args.join(","):"";w.push("c.",x.cmd,"(",v,`);
`)}return this.compiledGlyphs[S]=new Function("c","size",w.join(""))}return this.compiledGlyphs[S]=function(w,x){for(const v of b)v.cmd==="scale"&&(v.args=[x,-x]),w[v.cmd].apply(w,v.args)}}}f.FontFaceObject=q},(at,f)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.isNodeJS=void 0;const z=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser");f.isNodeJS=z},(at,f,z)=>{var ut,me;Object.defineProperty(f,"__esModule",{value:!0}),f.CanvasGraphics=void 0;var g=z(1),T=z(6),V=z(12),q=z(13),et=z(10);const I=16,S=100,b=4096,w=15,x=10,v=1e3,d=16;function m(W,c){if(W._removeMirroring)throw new Error("Context is already forwarding operations.");W.__originalSave=W.save,W.__originalRestore=W.restore,W.__originalRotate=W.rotate,W.__originalScale=W.scale,W.__originalTranslate=W.translate,W.__originalTransform=W.transform,W.__originalSetTransform=W.setTransform,W.__originalResetTransform=W.resetTransform,W.__originalClip=W.clip,W.__originalMoveTo=W.moveTo,W.__originalLineTo=W.lineTo,W.__originalBezierCurveTo=W.bezierCurveTo,W.__originalRect=W.rect,W.__originalClosePath=W.closePath,W.__originalBeginPath=W.beginPath,W._removeMirroring=()=>{W.save=W.__originalSave,W.restore=W.__originalRestore,W.rotate=W.__originalRotate,W.scale=W.__originalScale,W.translate=W.__originalTranslate,W.transform=W.__originalTransform,W.setTransform=W.__originalSetTransform,W.resetTransform=W.__originalResetTransform,W.clip=W.__originalClip,W.moveTo=W.__originalMoveTo,W.lineTo=W.__originalLineTo,W.bezierCurveTo=W.__originalBezierCurveTo,W.rect=W.__originalRect,W.closePath=W.__originalClosePath,W.beginPath=W.__originalBeginPath,delete W._removeMirroring},W.save=function(){c.save(),this.__originalSave()},W.restore=function(){c.restore(),this.__originalRestore()},W.translate=function(y,j){c.translate(y,j),this.__originalTranslate(y,j)},W.scale=function(y,j){c.scale(y,j),this.__originalScale(y,j)},W.transform=function(y,j,R,G,H,K){c.transform(y,j,R,G,H,K),this.__originalTransform(y,j,R,G,H,K)},W.setTransform=function(y,j,R,G,H,K){c.setTransform(y,j,R,G,H,K),this.__originalSetTransform(y,j,R,G,H,K)},W.resetTransform=function(){c.resetTransform(),this.__originalResetTransform()},W.rotate=function(y){c.rotate(y),this.__originalRotate(y)},W.clip=function(y){c.clip(y),this.__originalClip(y)},W.moveTo=function(h,y){c.moveTo(h,y),this.__originalMoveTo(h,y)},W.lineTo=function(h,y){c.lineTo(h,y),this.__originalLineTo(h,y)},W.bezierCurveTo=function(h,y,j,R,G,H){c.bezierCurveTo(h,y,j,R,G,H),this.__originalBezierCurveTo(h,y,j,R,G,H)},W.rect=function(h,y,j,R){c.rect(h,y,j,R),this.__originalRect(h,y,j,R)},W.closePath=function(){c.closePath(),this.__originalClosePath()},W.beginPath=function(){c.beginPath(),this.__originalBeginPath()}}class s{constructor(c){this.canvasFactory=c,this.cache=Object.create(null)}getCanvas(c,h,y){let j;return this.cache[c]!==void 0?(j=this.cache[c],this.canvasFactory.reset(j,h,y)):(j=this.canvasFactory.create(h,y),this.cache[c]=j),j}delete(c){delete this.cache[c]}clear(){for(const c in this.cache){const h=this.cache[c];this.canvasFactory.destroy(h),delete this.cache[c]}}}function a(W,c,h,y,j,R,G,H,K,$){const[L,k,e,r,_,E]=(0,T.getCurrentTransform)(W);if(k===0&&e===0){const st=G*L+_,Z=Math.round(st),it=H*r+E,rt=Math.round(it),dt=(G+K)*L+_,ct=Math.abs(Math.round(dt)-Z)||1,mt=(H+$)*r+E,gt=Math.abs(Math.round(mt)-rt)||1;return W.setTransform(Math.sign(L),0,0,Math.sign(r),Z,rt),W.drawImage(c,h,y,j,R,0,0,ct,gt),W.setTransform(L,k,e,r,_,E),[ct,gt]}if(L===0&&r===0){const st=H*e+_,Z=Math.round(st),it=G*k+E,rt=Math.round(it),dt=(H+$)*e+_,ct=Math.abs(Math.round(dt)-Z)||1,mt=(G+K)*k+E,gt=Math.abs(Math.round(mt)-rt)||1;return W.setTransform(0,Math.sign(k),Math.sign(e),0,Z,rt),W.drawImage(c,h,y,j,R,0,0,gt,ct),W.setTransform(L,k,e,r,_,E),[gt,ct]}W.drawImage(c,h,y,j,R,G,H,K,$);const D=Math.hypot(L,k),N=Math.hypot(e,r);return[D*K,N*$]}function F(W){const{width:c,height:h}=W;if(c>v||h>v)return null;const y=1e3,j=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),R=c+1;let G=new Uint8Array(R*(h+1)),H,K,$;const L=c+7&-8;let k=new Uint8Array(L*h),e=0;for(const N of W.data){let st=128;for(;st>0;)k[e++]=N&st?0:255,st>>=1}let r=0;for(e=0,k[e]!==0&&(G[0]=1,++r),K=1;K<c;K++)k[e]!==k[e+1]&&(G[K]=k[e]?2:1,++r),e++;for(k[e]!==0&&(G[K]=2,++r),H=1;H<h;H++){e=H*L,$=H*R,k[e-L]!==k[e]&&(G[$]=k[e]?1:8,++r);let N=(k[e]?4:0)+(k[e-L]?8:0);for(K=1;K<c;K++)N=(N>>2)+(k[e+1]?4:0)+(k[e-L+1]?8:0),j[N]&&(G[$+K]=j[N],++r),e++;if(k[e-L]!==k[e]&&(G[$+K]=k[e]?2:4,++r),r>y)return null}for(e=L*(h-1),$=H*R,k[e]!==0&&(G[$]=8,++r),K=1;K<c;K++)k[e]!==k[e+1]&&(G[$+K]=k[e]?4:8,++r),e++;if(k[e]!==0&&(G[$+K]=4,++r),r>y)return null;const _=new Int32Array([0,R,-1,0,-R,0,0,0,1]),E=new Path2D;for(H=0;r&&H<=h;H++){let N=H*R;const st=N+c;for(;N<st&&!G[N];)N++;if(N===st)continue;E.moveTo(N%R,H);const Z=N;let it=G[N];do{const rt=_[it];do N+=rt;while(!G[N]);const dt=G[N];dt!==5&&dt!==10?(it=dt,G[N]=0):(it=dt&51*it>>4,G[N]&=it>>2|it<<2),E.lineTo(N%R,N/R|0),G[N]||--r}while(Z!==N);--H}return k=null,G=null,function(N){N.save(),N.scale(1/c,-1/h),N.translate(0,-h),N.fill(E),N.beginPath(),N.restore()}}class M{constructor(c,h){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=g.IDENTITY_MATRIX,this.textMatrixScale=1,this.fontMatrix=g.FONT_IDENTITY_MATRIX,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=g.TextRenderingMode.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,c,h])}clone(){const c=Object.create(this);return c.clipBox=this.clipBox.slice(),c}setCurrentPoint(c,h){this.x=c,this.y=h}updatePathMinMax(c,h,y){[h,y]=g.Util.applyTransform([h,y],c),this.minX=Math.min(this.minX,h),this.minY=Math.min(this.minY,y),this.maxX=Math.max(this.maxX,h),this.maxY=Math.max(this.maxY,y)}updateRectMinMax(c,h){const y=g.Util.applyTransform(h,c),j=g.Util.applyTransform(h.slice(2),c);this.minX=Math.min(this.minX,y[0],j[0]),this.minY=Math.min(this.minY,y[1],j[1]),this.maxX=Math.max(this.maxX,y[0],j[0]),this.maxY=Math.max(this.maxY,y[1],j[1])}updateScalingPathMinMax(c,h){g.Util.scaleMinMax(c,h),this.minX=Math.min(this.minX,h[0]),this.maxX=Math.max(this.maxX,h[1]),this.minY=Math.min(this.minY,h[2]),this.maxY=Math.max(this.maxY,h[3])}updateCurvePathMinMax(c,h,y,j,R,G,H,K,$,L){const k=g.Util.bezierBoundingBox(h,y,j,R,G,H,K,$);if(L){L[0]=Math.min(L[0],k[0],k[2]),L[1]=Math.max(L[1],k[0],k[2]),L[2]=Math.min(L[2],k[1],k[3]),L[3]=Math.max(L[3],k[1],k[3]);return}this.updateRectMinMax(c,k)}getPathBoundingBox(c=V.PathType.FILL,h=null){const y=[this.minX,this.minY,this.maxX,this.maxY];if(c===V.PathType.STROKE){h||(0,g.unreachable)("Stroke bounding box must include transform.");const j=g.Util.singularValueDecompose2dScale(h),R=j[0]*this.lineWidth/2,G=j[1]*this.lineWidth/2;y[0]-=R,y[1]-=G,y[2]+=R,y[3]+=G}return y}updateClipFromPath(){const c=g.Util.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(c||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(c){this.clipBox=c,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(c=V.PathType.FILL,h=null){return g.Util.intersect(this.clipBox,this.getPathBoundingBox(c,h))}}function A(W,c){if(typeof ImageData<"u"&&c instanceof ImageData){W.putImageData(c,0,0);return}const h=c.height,y=c.width,j=h%d,R=(h-j)/d,G=j===0?R:R+1,H=W.createImageData(y,d);let K=0,$;const L=c.data,k=H.data;let e,r,_,E;if(c.kind===g.ImageKind.GRAYSCALE_1BPP){const D=L.byteLength,N=new Uint32Array(k.buffer,0,k.byteLength>>2),st=N.length,Z=y+7>>3,it=4294967295,rt=g.FeatureTest.isLittleEndian?4278190080:255;for(e=0;e<G;e++){for(_=e<R?d:j,$=0,r=0;r<_;r++){const dt=D-K;let ct=0;const mt=dt>Z?y:dt*8-7,gt=mt&-8;let Et=0,At=0;for(;ct<gt;ct+=8)At=L[K++],N[$++]=At&128?it:rt,N[$++]=At&64?it:rt,N[$++]=At&32?it:rt,N[$++]=At&16?it:rt,N[$++]=At&8?it:rt,N[$++]=At&4?it:rt,N[$++]=At&2?it:rt,N[$++]=At&1?it:rt;for(;ct<mt;ct++)Et===0&&(At=L[K++],Et=128),N[$++]=At&Et?it:rt,Et>>=1}for(;$<st;)N[$++]=0;W.putImageData(H,0,e*d)}}else if(c.kind===g.ImageKind.RGBA_32BPP){for(r=0,E=y*d*4,e=0;e<R;e++)k.set(L.subarray(K,K+E)),K+=E,W.putImageData(H,0,r),r+=d;e<G&&(E=y*j*4,k.set(L.subarray(K,K+E)),W.putImageData(H,0,r))}else if(c.kind===g.ImageKind.RGB_24BPP)for(_=d,E=y*_,e=0;e<G;e++){for(e>=R&&(_=j,E=y*_),$=0,r=E;r--;)k[$++]=L[K++],k[$++]=L[K++],k[$++]=L[K++],k[$++]=255;W.putImageData(H,0,e*d)}else throw new Error(`bad image kind: ${c.kind}`)}function t(W,c){if(c.bitmap){W.drawImage(c.bitmap,0,0);return}const h=c.height,y=c.width,j=h%d,R=(h-j)/d,G=j===0?R:R+1,H=W.createImageData(y,d);let K=0;const $=c.data,L=H.data;for(let k=0;k<G;k++){const e=k<R?d:j;({srcPos:K}=(0,q.convertBlackAndWhiteToRGBA)({src:$,srcPos:K,dest:L,width:y,height:e,nonBlackColor:0})),W.putImageData(H,0,k*d)}}function l(W,c){const h=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const y of h)W[y]!==void 0&&(c[y]=W[y]);W.setLineDash!==void 0&&(c.setLineDash(W.getLineDash()),c.lineDashOffset=W.lineDashOffset)}function o(W){W.strokeStyle=W.fillStyle="#000000",W.fillRule="nonzero",W.globalAlpha=1,W.lineWidth=1,W.lineCap="butt",W.lineJoin="miter",W.miterLimit=10,W.globalCompositeOperation="source-over",W.font="10px sans-serif",W.setLineDash!==void 0&&(W.setLineDash([]),W.lineDashOffset=0),et.isNodeJS||(W.filter="none")}function n(W,c,h,y){const j=W.length;for(let R=3;R<j;R+=4){const G=W[R];if(G===0)W[R-3]=c,W[R-2]=h,W[R-1]=y;else if(G<255){const H=255-G;W[R-3]=W[R-3]*G+c*H>>8,W[R-2]=W[R-2]*G+h*H>>8,W[R-1]=W[R-1]*G+y*H>>8}}}function u(W,c,h){const y=W.length,j=1/255;for(let R=3;R<y;R+=4){const G=h?h[W[R]]:W[R];c[R]=c[R]*G*j|0}}function C(W,c,h){const y=W.length;for(let j=3;j<y;j+=4){const R=W[j-3]*77+W[j-2]*152+W[j-1]*28;c[j]=h?c[j]*h[R>>8]>>8:c[j]*R>>16}}function i(W,c,h,y,j,R,G,H,K,$,L){const k=!!R,e=k?R[0]:0,r=k?R[1]:0,_=k?R[2]:0;let E;j==="Luminosity"?E=C:E=u;const N=Math.min(y,Math.ceil(1048576/h));for(let st=0;st<y;st+=N){const Z=Math.min(N,y-st),it=W.getImageData(H-$,st+(K-L),h,Z),rt=c.getImageData(H,st+K,h,Z);k&&n(it.data,e,r,_),E(it.data,rt.data,G),c.putImageData(rt,H,st+K)}}function O(W,c,h,y){const j=y[0],R=y[1],G=y[2]-j,H=y[3]-R;G===0||H===0||(i(c.context,h,G,H,c.subtype,c.backdrop,c.transferMap,j,R,c.offsetX,c.offsetY),W.save(),W.globalAlpha=1,W.globalCompositeOperation="source-over",W.setTransform(1,0,0,1,0,0),W.drawImage(h.canvas,0,0),W.restore())}function X(W,c){const h=g.Util.singularValueDecompose2dScale(W);h[0]=Math.fround(h[0]),h[1]=Math.fround(h[1]);const y=Math.fround((globalThis.devicePixelRatio||1)*T.PixelsPerInch.PDF_TO_CSS_UNITS);return c!==void 0?c:h[0]<=y||h[1]<=y}const Y=["butt","round","square"],tt=["miter","round","bevel"],nt={},ft={},yt=class yt{constructor(c,h,y,j,R,{optionalContentConfig:G,markedContentStack:H=null},K){Q(this,ut);this.ctx=c,this.current=new M(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=h,this.objs=y,this.canvasFactory=j,this.filterFactory=R,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=H||[],this.optionalContentConfig=G,this.cachedCanvases=new s(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=K,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this._cachedScaleForStroking=null,this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(c,h=null){return typeof c=="string"?c.startsWith("g_")?this.commonObjs.get(c):this.objs.get(c):h}beginDrawing({transform:c,viewport:h,transparency:y=!1,background:j=null}){const R=this.ctx.canvas.width,G=this.ctx.canvas.height,H=this.ctx.fillStyle;if(this.ctx.fillStyle=j||"#ffffff",this.ctx.fillRect(0,0,R,G),this.ctx.fillStyle=H,y){const K=this.cachedCanvases.getCanvas("transparent",R,G);this.compositeCtx=this.ctx,this.transparentCanvas=K.canvas,this.ctx=K.context,this.ctx.save(),this.ctx.transform(...(0,T.getCurrentTransform)(this.compositeCtx))}this.ctx.save(),o(this.ctx),c&&(this.ctx.transform(...c),this.outputScaleX=c[0],this.outputScaleY=c[0]),this.ctx.transform(...h.transform),this.viewportScale=h.scale,this.baseTransform=(0,T.getCurrentTransform)(this.ctx)}executeOperatorList(c,h,y,j){const R=c.argsArray,G=c.fnArray;let H=h||0;const K=R.length;if(K===H)return H;const $=K-H>x&&typeof y=="function",L=$?Date.now()+w:0;let k=0;const e=this.commonObjs,r=this.objs;let _;for(;;){if(j!==void 0&&H===j.nextBreakPoint)return j.breakIt(H,y),H;if(_=G[H],_!==g.OPS.dependency)this[_].apply(this,R[H]);else for(const E of R[H]){const D=E.startsWith("g_")?e:r;if(!D.has(E))return D.get(E,y),H}if(H++,H===K)return H;if($&&++k>x){if(Date.now()>L)return y(),H;k=0}}}endDrawing(c=null){ot(this,ut,me).call(this),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const h of this._cachedBitmapsMap.values()){for(const y of h.values())typeof HTMLCanvasElement<"u"&&y instanceof HTMLCanvasElement&&(y.width=y.height=0);h.clear()}if(this._cachedBitmapsMap.clear(),c){const h=this.filterFactory.addHCMFilter(c.foreground,c.background);if(h!=="none"){const y=this.ctx.filter;this.ctx.filter=h,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=y}}}_scaleImage(c,h){const y=c.width,j=c.height;let R=Math.max(Math.hypot(h[0],h[1]),1),G=Math.max(Math.hypot(h[2],h[3]),1),H=y,K=j,$="prescale1",L,k;for(;R>2&&H>1||G>2&&K>1;){let e=H,r=K;R>2&&H>1&&(e=H>=16384?Math.floor(H/2)-1||1:Math.ceil(H/2),R/=H/e),G>2&&K>1&&(r=K>=16384?Math.floor(K/2)-1||1:Math.ceil(K)/2,G/=K/r),L=this.cachedCanvases.getCanvas($,e,r),k=L.context,k.clearRect(0,0,e,r),k.drawImage(c,0,0,H,K,0,0,e,r),c=L.canvas,H=e,K=r,$=$==="prescale1"?"prescale2":"prescale1"}return{img:c,paintWidth:H,paintHeight:K}}_createMaskCanvas(c){const h=this.ctx,{width:y,height:j}=c,R=this.current.fillColor,G=this.current.patternFill,H=(0,T.getCurrentTransform)(h);let K,$,L,k;if((c.bitmap||c.data)&&c.count>1){const ct=c.bitmap||c.data.buffer;$=JSON.stringify(G?H:[H.slice(0,4),R]),K=this._cachedBitmapsMap.get(ct),K||(K=new Map,this._cachedBitmapsMap.set(ct,K));const mt=K.get($);if(mt&&!G){const gt=Math.round(Math.min(H[0],H[2])+H[4]),Et=Math.round(Math.min(H[1],H[3])+H[5]);return{canvas:mt,offsetX:gt,offsetY:Et}}L=mt}L||(k=this.cachedCanvases.getCanvas("maskCanvas",y,j),t(k.context,c));let e=g.Util.transform(H,[1/y,0,0,-1/j,0,0]);e=g.Util.transform(e,[1,0,0,1,0,-j]);const r=g.Util.applyTransform([0,0],e),_=g.Util.applyTransform([y,j],e),E=g.Util.normalizeRect([r[0],r[1],_[0],_[1]]),D=Math.round(E[2]-E[0])||1,N=Math.round(E[3]-E[1])||1,st=this.cachedCanvases.getCanvas("fillCanvas",D,N),Z=st.context,it=Math.min(r[0],_[0]),rt=Math.min(r[1],_[1]);Z.translate(-it,-rt),Z.transform(...e),L||(L=this._scaleImage(k.canvas,(0,T.getCurrentTransformInverse)(Z)),L=L.img,K&&G&&K.set($,L)),Z.imageSmoothingEnabled=X((0,T.getCurrentTransform)(Z),c.interpolate),a(Z,L,0,0,L.width,L.height,0,0,y,j),Z.globalCompositeOperation="source-in";const dt=g.Util.transform((0,T.getCurrentTransformInverse)(Z),[1,0,0,1,-it,-rt]);return Z.fillStyle=G?R.getPattern(h,this,dt,V.PathType.FILL):R,Z.fillRect(0,0,y,j),K&&!G&&(this.cachedCanvases.delete("fillCanvas"),K.set($,st.canvas)),{canvas:st.canvas,offsetX:Math.round(it),offsetY:Math.round(rt)}}setLineWidth(c){c!==this.current.lineWidth&&(this._cachedScaleForStroking=null),this.current.lineWidth=c,this.ctx.lineWidth=c}setLineCap(c){this.ctx.lineCap=Y[c]}setLineJoin(c){this.ctx.lineJoin=tt[c]}setMiterLimit(c){this.ctx.miterLimit=c}setDash(c,h){const y=this.ctx;y.setLineDash!==void 0&&(y.setLineDash(c),y.lineDashOffset=h)}setRenderingIntent(c){}setFlatness(c){}setGState(c){for(const[h,y]of c)switch(h){case"LW":this.setLineWidth(y);break;case"LC":this.setLineCap(y);break;case"LJ":this.setLineJoin(y);break;case"ML":this.setMiterLimit(y);break;case"D":this.setDash(y[0],y[1]);break;case"RI":this.setRenderingIntent(y);break;case"FL":this.setFlatness(y);break;case"Font":this.setFont(y[0],y[1]);break;case"CA":this.current.strokeAlpha=y;break;case"ca":this.current.fillAlpha=y,this.ctx.globalAlpha=y;break;case"BM":this.ctx.globalCompositeOperation=y;break;case"SMask":this.current.activeSMask=y?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(y);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const c=this.inSMaskMode;this.current.activeSMask&&!c?this.beginSMaskMode():!this.current.activeSMask&&c&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const c=this.ctx.canvas.width,h=this.ctx.canvas.height,y="smaskGroupAt"+this.groupLevel,j=this.cachedCanvases.getCanvas(y,c,h);this.suspendedCtx=this.ctx,this.ctx=j.context;const R=this.ctx;R.setTransform(...(0,T.getCurrentTransform)(this.suspendedCtx)),l(this.suspendedCtx,R),m(R,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),l(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(c){if(!this.current.activeSMask)return;c?(c[0]=Math.floor(c[0]),c[1]=Math.floor(c[1]),c[2]=Math.ceil(c[2]),c[3]=Math.ceil(c[3])):c=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const h=this.current.activeSMask,y=this.suspendedCtx;O(y,h,this.ctx,c),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}save(){this.inSMaskMode?(l(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();const c=this.current;this.stateStack.push(c),this.current=c.clone()}restore(){this.stateStack.length===0&&this.inSMaskMode&&this.endSMaskMode(),this.stateStack.length!==0&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),l(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking=null,this._cachedGetSinglePixelWidth=null)}transform(c,h,y,j,R,G){this.ctx.transform(c,h,y,j,R,G),this._cachedScaleForStroking=null,this._cachedGetSinglePixelWidth=null}constructPath(c,h,y){const j=this.ctx,R=this.current;let G=R.x,H=R.y,K,$;const L=(0,T.getCurrentTransform)(j),k=L[0]===0&&L[3]===0||L[1]===0&&L[2]===0,e=k?y.slice(0):null;for(let r=0,_=0,E=c.length;r<E;r++)switch(c[r]|0){case g.OPS.rectangle:G=h[_++],H=h[_++];const D=h[_++],N=h[_++],st=G+D,Z=H+N;j.moveTo(G,H),D===0||N===0?j.lineTo(st,Z):(j.lineTo(st,H),j.lineTo(st,Z),j.lineTo(G,Z)),k||R.updateRectMinMax(L,[G,H,st,Z]),j.closePath();break;case g.OPS.moveTo:G=h[_++],H=h[_++],j.moveTo(G,H),k||R.updatePathMinMax(L,G,H);break;case g.OPS.lineTo:G=h[_++],H=h[_++],j.lineTo(G,H),k||R.updatePathMinMax(L,G,H);break;case g.OPS.curveTo:K=G,$=H,G=h[_+4],H=h[_+5],j.bezierCurveTo(h[_],h[_+1],h[_+2],h[_+3],G,H),R.updateCurvePathMinMax(L,K,$,h[_],h[_+1],h[_+2],h[_+3],G,H,e),_+=6;break;case g.OPS.curveTo2:K=G,$=H,j.bezierCurveTo(G,H,h[_],h[_+1],h[_+2],h[_+3]),R.updateCurvePathMinMax(L,K,$,G,H,h[_],h[_+1],h[_+2],h[_+3],e),G=h[_+2],H=h[_+3],_+=4;break;case g.OPS.curveTo3:K=G,$=H,G=h[_+2],H=h[_+3],j.bezierCurveTo(h[_],h[_+1],G,H,G,H),R.updateCurvePathMinMax(L,K,$,h[_],h[_+1],G,H,G,H,e),_+=4;break;case g.OPS.closePath:j.closePath();break}k&&R.updateScalingPathMinMax(L,e),R.setCurrentPoint(G,H)}closePath(){this.ctx.closePath()}stroke(c=!0){const h=this.ctx,y=this.current.strokeColor;h.globalAlpha=this.current.strokeAlpha,this.contentVisible&&(typeof y=="object"&&(y!=null&&y.getPattern)?(h.save(),h.strokeStyle=y.getPattern(h,this,(0,T.getCurrentTransformInverse)(h),V.PathType.STROKE),this.rescaleAndStroke(!1),h.restore()):this.rescaleAndStroke(!0)),c&&this.consumePath(this.current.getClippedPathBoundingBox()),h.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(c=!0){const h=this.ctx,y=this.current.fillColor,j=this.current.patternFill;let R=!1;j&&(h.save(),h.fillStyle=y.getPattern(h,this,(0,T.getCurrentTransformInverse)(h),V.PathType.FILL),R=!0);const G=this.current.getClippedPathBoundingBox();this.contentVisible&&G!==null&&(this.pendingEOFill?(h.fill("evenodd"),this.pendingEOFill=!1):h.fill()),R&&h.restore(),c&&this.consumePath(G)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=nt}eoClip(){this.pendingClip=ft}beginText(){this.current.textMatrix=g.IDENTITY_MATRIX,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){const c=this.pendingTextPaths,h=this.ctx;if(c===void 0){h.beginPath();return}h.save(),h.beginPath();for(const y of c)h.setTransform(...y.transform),h.translate(y.x,y.y),y.addToPath(h,y.fontSize);h.restore(),h.clip(),h.beginPath(),delete this.pendingTextPaths}setCharSpacing(c){this.current.charSpacing=c}setWordSpacing(c){this.current.wordSpacing=c}setHScale(c){this.current.textHScale=c/100}setLeading(c){this.current.leading=-c}setFont(c,h){const y=this.commonObjs.get(c),j=this.current;if(!y)throw new Error(`Can't find font for ${c}`);if(j.fontMatrix=y.fontMatrix||g.FONT_IDENTITY_MATRIX,(j.fontMatrix[0]===0||j.fontMatrix[3]===0)&&(0,g.warn)("Invalid font matrix for font "+c),h<0?(h=-h,j.fontDirection=-1):j.fontDirection=1,this.current.font=y,this.current.fontSize=h,y.isType3Font)return;const R=y.loadedName||"sans-serif";let G="normal";y.black?G="900":y.bold&&(G="bold");const H=y.italic?"italic":"normal",K=`"${R}", ${y.fallbackName}`;let $=h;h<I?$=I:h>S&&($=S),this.current.fontSizeScale=h/$,this.ctx.font=`${H} ${G} ${$}px ${K}`}setTextRenderingMode(c){this.current.textRenderingMode=c}setTextRise(c){this.current.textRise=c}moveText(c,h){this.current.x=this.current.lineX+=c,this.current.y=this.current.lineY+=h}setLeadingMoveText(c,h){this.setLeading(-h),this.moveText(c,h)}setTextMatrix(c,h,y,j,R,G){this.current.textMatrix=[c,h,y,j,R,G],this.current.textMatrixScale=Math.hypot(c,h),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(c,h,y,j){const R=this.ctx,G=this.current,H=G.font,K=G.textRenderingMode,$=G.fontSize/G.fontSizeScale,L=K&g.TextRenderingMode.FILL_STROKE_MASK,k=!!(K&g.TextRenderingMode.ADD_TO_PATH_FLAG),e=G.patternFill&&!H.missingFile;let r;(H.disableFontFace||k||e)&&(r=H.getPathGenerator(this.commonObjs,c)),H.disableFontFace||e?(R.save(),R.translate(h,y),R.beginPath(),r(R,$),j&&R.setTransform(...j),(L===g.TextRenderingMode.FILL||L===g.TextRenderingMode.FILL_STROKE)&&R.fill(),(L===g.TextRenderingMode.STROKE||L===g.TextRenderingMode.FILL_STROKE)&&R.stroke(),R.restore()):((L===g.TextRenderingMode.FILL||L===g.TextRenderingMode.FILL_STROKE)&&R.fillText(c,h,y),(L===g.TextRenderingMode.STROKE||L===g.TextRenderingMode.FILL_STROKE)&&R.strokeText(c,h,y)),k&&(this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:(0,T.getCurrentTransform)(R),x:h,y,fontSize:$,addToPath:r})}get isFontSubpixelAAEnabled(){const{context:c}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);c.scale(1.5,1),c.fillText("I",0,10);const h=c.getImageData(0,0,10,10).data;let y=!1;for(let j=3;j<h.length;j+=4)if(h[j]>0&&h[j]<255){y=!0;break}return(0,g.shadow)(this,"isFontSubpixelAAEnabled",y)}showText(c){const h=this.current,y=h.font;if(y.isType3Font)return this.showType3Text(c);const j=h.fontSize;if(j===0)return;const R=this.ctx,G=h.fontSizeScale,H=h.charSpacing,K=h.wordSpacing,$=h.fontDirection,L=h.textHScale*$,k=c.length,e=y.vertical,r=e?1:-1,_=y.defaultVMetrics,E=j*h.fontMatrix[0],D=h.textRenderingMode===g.TextRenderingMode.FILL&&!y.disableFontFace&&!h.patternFill;R.save(),R.transform(...h.textMatrix),R.translate(h.x,h.y+h.textRise),$>0?R.scale(L,-1):R.scale(L,1);let N;if(h.patternFill){R.save();const dt=h.fillColor.getPattern(R,this,(0,T.getCurrentTransformInverse)(R),V.PathType.FILL);N=(0,T.getCurrentTransform)(R),R.restore(),R.fillStyle=dt}let st=h.lineWidth;const Z=h.textMatrixScale;if(Z===0||st===0){const dt=h.textRenderingMode&g.TextRenderingMode.FILL_STROKE_MASK;(dt===g.TextRenderingMode.STROKE||dt===g.TextRenderingMode.FILL_STROKE)&&(st=this.getSinglePixelWidth())}else st/=Z;if(G!==1&&(R.scale(G,G),st/=G),R.lineWidth=st,y.isInvalidPDFjsFont){const dt=[];let ct=0;for(const mt of c)dt.push(mt.unicode),ct+=mt.width;R.fillText(dt.join(""),0,0),h.x+=ct*E*L,R.restore(),this.compose();return}let it=0,rt;for(rt=0;rt<k;++rt){const dt=c[rt];if(typeof dt=="number"){it+=r*dt*j/1e3;continue}let ct=!1;const mt=(dt.isSpace?K:0)+H,gt=dt.fontChar,Et=dt.accent;let At,Pt,P=dt.width;if(e){const B=dt.vmetric||_,_t=-(dt.vmetric?B[1]:P*.5)*E,Ct=B[2]*E;P=B?-B[0]:P,At=_t/G,Pt=(it+Ct)/G}else At=it/G,Pt=0;if(y.remeasure&&P>0){const B=R.measureText(gt).width*1e3/j*G;if(P<B&&this.isFontSubpixelAAEnabled){const _t=P/B;ct=!0,R.save(),R.scale(_t,1),At/=_t}else P!==B&&(At+=(P-B)/2e3*j/G)}if(this.contentVisible&&(dt.isInFont||y.missingFile)){if(D&&!Et)R.fillText(gt,At,Pt);else if(this.paintChar(gt,At,Pt,N),Et){const B=At+j*Et.offset.x/G,_t=Pt-j*Et.offset.y/G;this.paintChar(Et.fontChar,B,_t,N)}}let U;e?U=P*E-mt*$:U=P*E+mt*$,it+=U,ct&&R.restore()}e?h.y-=it:h.x+=it*L,R.restore(),this.compose()}showType3Text(c){const h=this.ctx,y=this.current,j=y.font,R=y.fontSize,G=y.fontDirection,H=j.vertical?1:-1,K=y.charSpacing,$=y.wordSpacing,L=y.textHScale*G,k=y.fontMatrix||g.FONT_IDENTITY_MATRIX,e=c.length,r=y.textRenderingMode===g.TextRenderingMode.INVISIBLE;let _,E,D,N;if(!(r||R===0)){for(this._cachedScaleForStroking=null,this._cachedGetSinglePixelWidth=null,h.save(),h.transform(...y.textMatrix),h.translate(y.x,y.y),h.scale(L,G),_=0;_<e;++_){if(E=c[_],typeof E=="number"){N=H*E*R/1e3,this.ctx.translate(N,0),y.x+=N*L;continue}const st=(E.isSpace?$:0)+K,Z=j.charProcOperatorList[E.operatorListId];if(!Z){(0,g.warn)(`Type3 character "${E.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=E,this.save(),h.scale(R,R),h.transform(...k),this.executeOperatorList(Z),this.restore()),D=g.Util.applyTransform([E.width,0],k)[0]*R+st,h.translate(D,0),y.x+=D*L}h.restore(),this.processingType3=null}}setCharWidth(c,h){}setCharWidthAndBounds(c,h,y,j,R,G){this.ctx.rect(y,j,R-y,G-j),this.ctx.clip(),this.endPath()}getColorN_Pattern(c){let h;if(c[0]==="TilingPattern"){const y=c[1],j=this.baseTransform||(0,T.getCurrentTransform)(this.ctx),R={createCanvasGraphics:G=>new yt(G,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};h=new V.TilingPattern(c,y,this.ctx,R,j)}else h=this._getPattern(c[1],c[2]);return h}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments)}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(c,h,y){const j=g.Util.makeHexColor(c,h,y);this.ctx.strokeStyle=j,this.current.strokeColor=j}setFillRGBColor(c,h,y){const j=g.Util.makeHexColor(c,h,y);this.ctx.fillStyle=j,this.current.fillColor=j,this.current.patternFill=!1}_getPattern(c,h=null){let y;return this.cachedPatterns.has(c)?y=this.cachedPatterns.get(c):(y=(0,V.getShadingPattern)(this.getObject(c)),this.cachedPatterns.set(c,y)),h&&(y.matrix=h),y}shadingFill(c){if(!this.contentVisible)return;const h=this.ctx;this.save();const y=this._getPattern(c);h.fillStyle=y.getPattern(h,this,(0,T.getCurrentTransformInverse)(h),V.PathType.SHADING);const j=(0,T.getCurrentTransformInverse)(h);if(j){const R=h.canvas,G=R.width,H=R.height,K=g.Util.applyTransform([0,0],j),$=g.Util.applyTransform([0,H],j),L=g.Util.applyTransform([G,0],j),k=g.Util.applyTransform([G,H],j),e=Math.min(K[0],$[0],L[0],k[0]),r=Math.min(K[1],$[1],L[1],k[1]),_=Math.max(K[0],$[0],L[0],k[0]),E=Math.max(K[1],$[1],L[1],k[1]);this.ctx.fillRect(e,r,_-e,E-r)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){(0,g.unreachable)("Should not call beginInlineImage")}beginImageData(){(0,g.unreachable)("Should not call beginImageData")}paintFormXObjectBegin(c,h){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),Array.isArray(c)&&c.length===6&&this.transform(...c),this.baseTransform=(0,T.getCurrentTransform)(this.ctx),h)){const y=h[2]-h[0],j=h[3]-h[1];this.ctx.rect(h[0],h[1],y,j),this.current.updateRectMinMax((0,T.getCurrentTransform)(this.ctx),h),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(c){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const h=this.ctx;c.isolated||(0,g.info)("TODO: Support non-isolated groups."),c.knockout&&(0,g.warn)("Knockout groups not supported.");const y=(0,T.getCurrentTransform)(h);if(c.matrix&&h.transform(...c.matrix),!c.bbox)throw new Error("Bounding box is required.");let j=g.Util.getAxialAlignedBoundingBox(c.bbox,(0,T.getCurrentTransform)(h));const R=[0,0,h.canvas.width,h.canvas.height];j=g.Util.intersect(j,R)||[0,0,0,0];const G=Math.floor(j[0]),H=Math.floor(j[1]);let K=Math.max(Math.ceil(j[2])-G,1),$=Math.max(Math.ceil(j[3])-H,1),L=1,k=1;K>b&&(L=K/b,K=b),$>b&&(k=$/b,$=b),this.current.startNewPathAndClipBox([0,0,K,$]);let e="groupAt"+this.groupLevel;c.smask&&(e+="_smask_"+this.smaskCounter++%2);const r=this.cachedCanvases.getCanvas(e,K,$),_=r.context;_.scale(1/L,1/k),_.translate(-G,-H),_.transform(...y),c.smask?this.smaskStack.push({canvas:r.canvas,context:_,offsetX:G,offsetY:H,scaleX:L,scaleY:k,subtype:c.smask.subtype,backdrop:c.smask.backdrop,transferMap:c.smask.transferMap||null,startTransformInverse:null}):(h.setTransform(1,0,0,1,0,0),h.translate(G,H),h.scale(L,k),h.save()),l(h,_),this.ctx=_,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(h),this.groupLevel++}endGroup(c){if(!this.contentVisible)return;this.groupLevel--;const h=this.ctx,y=this.groupStack.pop();if(this.ctx=y,this.ctx.imageSmoothingEnabled=!1,c.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();const j=(0,T.getCurrentTransform)(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...j);const R=g.Util.getAxialAlignedBoundingBox([0,0,h.canvas.width,h.canvas.height],j);this.ctx.drawImage(h.canvas,0,0),this.ctx.restore(),this.compose(R)}}beginAnnotation(c,h,y,j,R){if(ot(this,ut,me).call(this),o(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),Array.isArray(h)&&h.length===4){const G=h[2]-h[0],H=h[3]-h[1];if(R&&this.annotationCanvasMap){y=y.slice(),y[4]-=h[0],y[5]-=h[1],h=h.slice(),h[0]=h[1]=0,h[2]=G,h[3]=H;const[K,$]=g.Util.singularValueDecompose2dScale((0,T.getCurrentTransform)(this.ctx)),{viewportScale:L}=this,k=Math.ceil(G*this.outputScaleX*L),e=Math.ceil(H*this.outputScaleY*L);this.annotationCanvas=this.canvasFactory.create(k,e);const{canvas:r,context:_}=this.annotationCanvas;this.annotationCanvasMap.set(c,r),this.annotationCanvas.savedCtx=this.ctx,this.ctx=_,this.ctx.setTransform(K,0,0,-$,0,H*$),o(this.ctx)}else o(this.ctx),this.ctx.rect(h[0],h[1],G,H),this.ctx.clip(),this.endPath()}this.current=new M(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...y),this.transform(...j)}endAnnotation(){this.annotationCanvas&&(this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(c){if(!this.contentVisible)return;const h=c.count;c=this.getObject(c.data,c),c.count=h;const y=this.ctx,j=this.processingType3;if(j&&(j.compiled===void 0&&(j.compiled=F(c)),j.compiled)){j.compiled(y);return}const R=this._createMaskCanvas(c),G=R.canvas;y.save(),y.setTransform(1,0,0,1,0,0),y.drawImage(G,R.offsetX,R.offsetY),y.restore(),this.compose()}paintImageMaskXObjectRepeat(c,h,y=0,j=0,R,G){if(!this.contentVisible)return;c=this.getObject(c.data,c);const H=this.ctx;H.save();const K=(0,T.getCurrentTransform)(H);H.transform(h,y,j,R,0,0);const $=this._createMaskCanvas(c);H.setTransform(1,0,0,1,$.offsetX-K[4],$.offsetY-K[5]);for(let L=0,k=G.length;L<k;L+=2){const e=g.Util.transform(K,[h,y,j,R,G[L],G[L+1]]),[r,_]=g.Util.applyTransform([0,0],e);H.drawImage($.canvas,r,_)}H.restore(),this.compose()}paintImageMaskXObjectGroup(c){if(!this.contentVisible)return;const h=this.ctx,y=this.current.fillColor,j=this.current.patternFill;for(const R of c){const{data:G,width:H,height:K,transform:$}=R,L=this.cachedCanvases.getCanvas("maskCanvas",H,K),k=L.context;k.save();const e=this.getObject(G,R);t(k,e),k.globalCompositeOperation="source-in",k.fillStyle=j?y.getPattern(k,this,(0,T.getCurrentTransformInverse)(h),V.PathType.FILL):y,k.fillRect(0,0,H,K),k.restore(),h.save(),h.transform(...$),h.scale(1,-1),a(h,L.canvas,0,0,H,K,0,-1,1,1),h.restore()}this.compose()}paintImageXObject(c){if(!this.contentVisible)return;const h=this.getObject(c);if(!h){(0,g.warn)("Dependent image isn't ready yet");return}this.paintInlineImageXObject(h)}paintImageXObjectRepeat(c,h,y,j){if(!this.contentVisible)return;const R=this.getObject(c);if(!R){(0,g.warn)("Dependent image isn't ready yet");return}const G=R.width,H=R.height,K=[];for(let $=0,L=j.length;$<L;$+=2)K.push({transform:[h,0,0,y,j[$],j[$+1]],x:0,y:0,w:G,h:H});this.paintInlineImageXObjectGroup(R,K)}applyTransferMapsToCanvas(c){return this.current.transferMaps!=="none"&&(c.filter=this.current.transferMaps,c.drawImage(c.canvas,0,0),c.filter="none"),c.canvas}applyTransferMapsToBitmap(c){if(this.current.transferMaps==="none")return c.bitmap;const{bitmap:h,width:y,height:j}=c,R=this.cachedCanvases.getCanvas("inlineImage",y,j),G=R.context;return G.filter=this.current.transferMaps,G.drawImage(h,0,0),G.filter="none",R.canvas}paintInlineImageXObject(c){if(!this.contentVisible)return;const h=c.width,y=c.height,j=this.ctx;this.save(),et.isNodeJS||(j.filter="none"),j.scale(1/h,-1/y);let R;if(c.bitmap)R=this.applyTransferMapsToBitmap(c);else if(typeof HTMLElement=="function"&&c instanceof HTMLElement||!c.data)R=c;else{const K=this.cachedCanvases.getCanvas("inlineImage",h,y).context;A(K,c),R=this.applyTransferMapsToCanvas(K)}const G=this._scaleImage(R,(0,T.getCurrentTransformInverse)(j));j.imageSmoothingEnabled=X((0,T.getCurrentTransform)(j),c.interpolate),a(j,G.img,0,0,G.paintWidth,G.paintHeight,0,-y,h,y),this.compose(),this.restore()}paintInlineImageXObjectGroup(c,h){if(!this.contentVisible)return;const y=this.ctx;let j;if(c.bitmap)j=c.bitmap;else{const R=c.width,G=c.height,K=this.cachedCanvases.getCanvas("inlineImage",R,G).context;A(K,c),j=this.applyTransferMapsToCanvas(K)}for(const R of h)y.save(),y.transform(...R.transform),y.scale(1,-1),a(y,j,R.x,R.y,R.w,R.h,0,-1,1,1),y.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(c){}markPointProps(c,h){}beginMarkedContent(c){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(c,h){c==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(h)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(c){const h=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(c);const y=this.ctx;this.pendingClip&&(h||(this.pendingClip===ft?y.clip("evenodd"):y.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),y.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const c=(0,T.getCurrentTransform)(this.ctx);if(c[1]===0&&c[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(c[0]),Math.abs(c[3]));else{const h=Math.abs(c[0]*c[3]-c[2]*c[1]),y=Math.hypot(c[0],c[2]),j=Math.hypot(c[1],c[3]);this._cachedGetSinglePixelWidth=Math.max(y,j)/h}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(!this._cachedScaleForStroking){const{lineWidth:c}=this.current,h=(0,T.getCurrentTransform)(this.ctx);let y,j;if(h[1]===0&&h[2]===0){const R=Math.abs(h[0]),G=Math.abs(h[3]);if(c===0)y=1/R,j=1/G;else{const H=R*c,K=G*c;y=H<1?1/H:1,j=K<1?1/K:1}}else{const R=Math.abs(h[0]*h[3]-h[2]*h[1]),G=Math.hypot(h[0],h[1]),H=Math.hypot(h[2],h[3]);if(c===0)y=H/R,j=G/R;else{const K=c*R;y=H>K?H/K:1,j=G>K?G/K:1}}this._cachedScaleForStroking=[y,j]}return this._cachedScaleForStroking}rescaleAndStroke(c){const{ctx:h}=this,{lineWidth:y}=this.current,[j,R]=this.getScaleForStroking();if(h.lineWidth=y||1,j===1&&R===1){h.stroke();return}let G,H,K;c&&(G=(0,T.getCurrentTransform)(h),H=h.getLineDash().slice(),K=h.lineDashOffset),h.scale(j,R);const $=Math.max(j,R);h.setLineDash(h.getLineDash().map(L=>L/$)),h.lineDashOffset/=$,h.stroke(),c&&(h.setTransform(...G),h.setLineDash(H),h.lineDashOffset=K)}isContentVisible(){for(let c=this.markedContentStack.length-1;c>=0;c--)if(!this.markedContentStack[c].visible)return!1;return!0}};ut=new WeakSet,me=function(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)};let lt=yt;f.CanvasGraphics=lt;for(const W in g.OPS)lt.prototype[W]!==void 0&&(lt.prototype[g.OPS[W]]=lt.prototype[W])},(at,f,z)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.TilingPattern=f.PathType=void 0,f.getShadingPattern=v;var g=z(1),T=z(6);const V={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};f.PathType=V;function q(s,a){if(!a)return;const F=a[2]-a[0],M=a[3]-a[1],A=new Path2D;A.rect(a[0],a[1],F,M),s.clip(A)}class et{constructor(){this.constructor===et&&(0,g.unreachable)("Cannot initialize BaseShadingPattern.")}getPattern(){(0,g.unreachable)("Abstract method `getPattern` called.")}}class I extends et{constructor(a){super(),this._type=a[1],this._bbox=a[2],this._colorStops=a[3],this._p0=a[4],this._p1=a[5],this._r0=a[6],this._r1=a[7],this.matrix=null}_createGradient(a){let F;this._type==="axial"?F=a.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(F=a.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const M of this._colorStops)F.addColorStop(M[0],M[1]);return F}getPattern(a,F,M,A){let t;if(A===V.STROKE||A===V.FILL){const l=F.current.getClippedPathBoundingBox(A,(0,T.getCurrentTransform)(a))||[0,0,0,0],o=Math.ceil(l[2]-l[0])||1,n=Math.ceil(l[3]-l[1])||1,u=F.cachedCanvases.getCanvas("pattern",o,n,!0),C=u.context;C.clearRect(0,0,C.canvas.width,C.canvas.height),C.beginPath(),C.rect(0,0,C.canvas.width,C.canvas.height),C.translate(-l[0],-l[1]),M=g.Util.transform(M,[1,0,0,1,l[0],l[1]]),C.transform(...F.baseTransform),this.matrix&&C.transform(...this.matrix),q(C,this._bbox),C.fillStyle=this._createGradient(C),C.fill(),t=a.createPattern(u.canvas,"no-repeat");const i=new DOMMatrix(M);t.setTransform(i)}else q(a,this._bbox),t=this._createGradient(a);return t}}function S(s,a,F,M,A,t,l,o){const n=a.coords,u=a.colors,C=s.data,i=s.width*4;let O;n[F+1]>n[M+1]&&(O=F,F=M,M=O,O=t,t=l,l=O),n[M+1]>n[A+1]&&(O=M,M=A,A=O,O=l,l=o,o=O),n[F+1]>n[M+1]&&(O=F,F=M,M=O,O=t,t=l,l=O);const X=(n[F]+a.offsetX)*a.scaleX,Y=(n[F+1]+a.offsetY)*a.scaleY,tt=(n[M]+a.offsetX)*a.scaleX,nt=(n[M+1]+a.offsetY)*a.scaleY,ft=(n[A]+a.offsetX)*a.scaleX,lt=(n[A+1]+a.offsetY)*a.scaleY;if(Y>=lt)return;const ut=u[t],bt=u[t+1],yt=u[t+2],W=u[l],c=u[l+1],h=u[l+2],y=u[o],j=u[o+1],R=u[o+2],G=Math.round(Y),H=Math.round(lt);let K,$,L,k,e,r,_,E;for(let D=G;D<=H;D++){if(D<nt){let rt;D<Y?rt=0:rt=(Y-D)/(Y-nt),K=X-(X-tt)*rt,$=ut-(ut-W)*rt,L=bt-(bt-c)*rt,k=yt-(yt-h)*rt}else{let rt;D>lt?rt=1:nt===lt?rt=0:rt=(nt-D)/(nt-lt),K=tt-(tt-ft)*rt,$=W-(W-y)*rt,L=c-(c-j)*rt,k=h-(h-R)*rt}let N;D<Y?N=0:D>lt?N=1:N=(Y-D)/(Y-lt),e=X-(X-ft)*N,r=ut-(ut-y)*N,_=bt-(bt-j)*N,E=yt-(yt-R)*N;const st=Math.round(Math.min(K,e)),Z=Math.round(Math.max(K,e));let it=i*D+st*4;for(let rt=st;rt<=Z;rt++)N=(K-rt)/(K-e),N<0?N=0:N>1&&(N=1),C[it++]=$-($-r)*N|0,C[it++]=L-(L-_)*N|0,C[it++]=k-(k-E)*N|0,C[it++]=255}}function b(s,a,F){const M=a.coords,A=a.colors;let t,l;switch(a.type){case"lattice":const o=a.verticesPerRow,n=Math.floor(M.length/o)-1,u=o-1;for(t=0;t<n;t++){let C=t*o;for(let i=0;i<u;i++,C++)S(s,F,M[C],M[C+1],M[C+o],A[C],A[C+1],A[C+o]),S(s,F,M[C+o+1],M[C+1],M[C+o],A[C+o+1],A[C+1],A[C+o])}break;case"triangles":for(t=0,l=M.length;t<l;t+=3)S(s,F,M[t],M[t+1],M[t+2],A[t],A[t+1],A[t+2]);break;default:throw new Error("illegal figure")}}class w extends et{constructor(a){super(),this._coords=a[2],this._colors=a[3],this._figures=a[4],this._bounds=a[5],this._bbox=a[7],this._background=a[8],this.matrix=null}_createMeshCanvas(a,F,M){const o=Math.floor(this._bounds[0]),n=Math.floor(this._bounds[1]),u=Math.ceil(this._bounds[2])-o,C=Math.ceil(this._bounds[3])-n,i=Math.min(Math.ceil(Math.abs(u*a[0]*1.1)),3e3),O=Math.min(Math.ceil(Math.abs(C*a[1]*1.1)),3e3),X=u/i,Y=C/O,tt={coords:this._coords,colors:this._colors,offsetX:-o,offsetY:-n,scaleX:1/X,scaleY:1/Y},nt=i+2*2,ft=O+2*2,lt=M.getCanvas("mesh",nt,ft,!1),ut=lt.context,bt=ut.createImageData(i,O);if(F){const W=bt.data;for(let c=0,h=W.length;c<h;c+=4)W[c]=F[0],W[c+1]=F[1],W[c+2]=F[2],W[c+3]=255}for(const W of this._figures)b(bt,W,tt);return ut.putImageData(bt,2,2),{canvas:lt.canvas,offsetX:o-2*X,offsetY:n-2*Y,scaleX:X,scaleY:Y}}getPattern(a,F,M,A){q(a,this._bbox);let t;if(A===V.SHADING)t=g.Util.singularValueDecompose2dScale((0,T.getCurrentTransform)(a));else if(t=g.Util.singularValueDecompose2dScale(F.baseTransform),this.matrix){const o=g.Util.singularValueDecompose2dScale(this.matrix);t=[t[0]*o[0],t[1]*o[1]]}const l=this._createMeshCanvas(t,A===V.SHADING?null:this._background,F.cachedCanvases);return A!==V.SHADING&&(a.setTransform(...F.baseTransform),this.matrix&&a.transform(...this.matrix)),a.translate(l.offsetX,l.offsetY),a.scale(l.scaleX,l.scaleY),a.createPattern(l.canvas,"no-repeat")}}class x extends et{getPattern(){return"hotpink"}}function v(s){switch(s[0]){case"RadialAxial":return new I(s);case"Mesh":return new w(s);case"Dummy":return new x}throw new Error(`Unknown IR type: ${s[0]}`)}const d={COLORED:1,UNCOLORED:2};class m{static get MAX_PATTERN_SIZE(){return(0,g.shadow)(this,"MAX_PATTERN_SIZE",3e3)}constructor(a,F,M,A,t){this.operatorList=a[2],this.matrix=a[3]||[1,0,0,1,0,0],this.bbox=a[4],this.xstep=a[5],this.ystep=a[6],this.paintType=a[7],this.tilingType=a[8],this.color=F,this.ctx=M,this.canvasGraphicsFactory=A,this.baseTransform=t}createPatternCanvas(a){const F=this.operatorList,M=this.bbox,A=this.xstep,t=this.ystep,l=this.paintType,o=this.tilingType,n=this.color,u=this.canvasGraphicsFactory;(0,g.info)("TilingType: "+o);const C=M[0],i=M[1],O=M[2],X=M[3],Y=g.Util.singularValueDecompose2dScale(this.matrix),tt=g.Util.singularValueDecompose2dScale(this.baseTransform),nt=[Y[0]*tt[0],Y[1]*tt[1]],ft=this.getSizeAndScale(A,this.ctx.canvas.width,nt[0]),lt=this.getSizeAndScale(t,this.ctx.canvas.height,nt[1]),ut=a.cachedCanvases.getCanvas("pattern",ft.size,lt.size,!0),bt=ut.context,yt=u.createCanvasGraphics(bt);yt.groupLevel=a.groupLevel,this.setFillAndStrokeStyleToContext(yt,l,n);let W=C,c=i,h=O,y=X;return C<0&&(W=0,h+=Math.abs(C)),i<0&&(c=0,y+=Math.abs(i)),bt.translate(-(ft.scale*W),-(lt.scale*c)),yt.transform(ft.scale,0,0,lt.scale,0,0),bt.save(),this.clipBbox(yt,W,c,h,y),yt.baseTransform=(0,T.getCurrentTransform)(yt.ctx),yt.executeOperatorList(F),yt.endDrawing(),{canvas:ut.canvas,scaleX:ft.scale,scaleY:lt.scale,offsetX:W,offsetY:c}}getSizeAndScale(a,F,M){a=Math.abs(a);const A=Math.max(m.MAX_PATTERN_SIZE,F);let t=Math.ceil(a*M);return t>=A?t=A:M=t/a,{scale:M,size:t}}clipBbox(a,F,M,A,t){const l=A-F,o=t-M;a.ctx.rect(F,M,l,o),a.current.updateRectMinMax((0,T.getCurrentTransform)(a.ctx),[F,M,A,t]),a.clip(),a.endPath()}setFillAndStrokeStyleToContext(a,F,M){const A=a.ctx,t=a.current;switch(F){case d.COLORED:const l=this.ctx;A.fillStyle=l.fillStyle,A.strokeStyle=l.strokeStyle,t.fillColor=l.fillStyle,t.strokeColor=l.strokeStyle;break;case d.UNCOLORED:const o=g.Util.makeHexColor(M[0],M[1],M[2]);A.fillStyle=o,A.strokeStyle=o,t.fillColor=o,t.strokeColor=o;break;default:throw new g.FormatError(`Unsupported paint type: ${F}`)}}getPattern(a,F,M,A){let t=M;A!==V.SHADING&&(t=g.Util.transform(t,F.baseTransform),this.matrix&&(t=g.Util.transform(t,this.matrix)));const l=this.createPatternCanvas(F);let o=new DOMMatrix(t);o=o.translate(l.offsetX,l.offsetY),o=o.scale(1/l.scaleX,1/l.scaleY);const n=a.createPattern(l.canvas,"repeat");return n.setTransform(o),n}}f.TilingPattern=m},(at,f,z)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.convertBlackAndWhiteToRGBA=V,f.convertToRGBA=T,f.grayToRGBA=et;var g=z(1);function T(I){switch(I.kind){case g.ImageKind.GRAYSCALE_1BPP:return V(I);case g.ImageKind.RGB_24BPP:return q(I)}return null}function V({src:I,srcPos:S=0,dest:b,width:w,height:x,nonBlackColor:v=4294967295,inverseDecode:d=!1}){const m=g.FeatureTest.isLittleEndian?4278190080:255,[s,a]=d?[v,m]:[m,v],F=w>>3,M=w&7,A=I.length;b=new Uint32Array(b.buffer);let t=0;for(let l=0;l<x;l++){for(const n=S+F;S<n;S++){const u=S<A?I[S]:255;b[t++]=u&128?a:s,b[t++]=u&64?a:s,b[t++]=u&32?a:s,b[t++]=u&16?a:s,b[t++]=u&8?a:s,b[t++]=u&4?a:s,b[t++]=u&2?a:s,b[t++]=u&1?a:s}if(M===0)continue;const o=S<A?I[S++]:255;for(let n=0;n<M;n++)b[t++]=o&1<<7-n?a:s}return{srcPos:S,destPos:t}}function q({src:I,srcPos:S=0,dest:b,destPos:w=0,width:x,height:v}){let d=0;const m=I.length>>2,s=new Uint32Array(I.buffer,S,m);if(g.FeatureTest.isLittleEndian){for(;d<m-2;d+=3,w+=4){const a=s[d],F=s[d+1],M=s[d+2];b[w]=a|4278190080,b[w+1]=a>>>24|F<<8|4278190080,b[w+2]=F>>>16|M<<16|4278190080,b[w+3]=M>>>8|4278190080}for(let a=d*4,F=I.length;a<F;a+=3)b[w++]=I[a]|I[a+1]<<8|I[a+2]<<16|4278190080}else{for(;d<m-2;d+=3,w+=4){const a=s[d],F=s[d+1],M=s[d+2];b[w]=a|255,b[w+1]=a<<24|F>>>8|255,b[w+2]=F<<16|M>>>16|255,b[w+3]=M<<8|255}for(let a=d*4,F=I.length;a<F;a+=3)b[w++]=I[a]<<24|I[a+1]<<16|I[a+2]<<8|255}return{srcPos:S,destPos:w}}function et(I,S){if(g.FeatureTest.isLittleEndian)for(let b=0,w=I.length;b<w;b++)S[b]=I[b]*65793|4278190080;else for(let b=0,w=I.length;b<w;b++)S[b]=I[b]*16843008|255}},(at,f)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.GlobalWorkerOptions=void 0;const z=Object.create(null);f.GlobalWorkerOptions=z,z.workerPort=null,z.workerSrc=""},(at,f,z)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.MessageHandler=void 0;var g=z(1);const T={UNKNOWN:0,DATA:1,ERROR:2},V={UNKNOWN:0,CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function q(I){switch(I instanceof Error||typeof I=="object"&&I!==null||(0,g.unreachable)('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),I.name){case"AbortException":return new g.AbortException(I.message);case"MissingPDFException":return new g.MissingPDFException(I.message);case"PasswordException":return new g.PasswordException(I.message,I.code);case"UnexpectedResponseException":return new g.UnexpectedResponseException(I.message,I.status);case"UnknownErrorException":return new g.UnknownErrorException(I.message,I.details);default:return new g.UnknownErrorException(I.message,I.toString())}}class et{constructor(S,b,w){this.sourceName=S,this.targetName=b,this.comObj=w,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),this._onComObjOnMessage=x=>{const v=x.data;if(v.targetName!==this.sourceName)return;if(v.stream){this._processStreamMessage(v);return}if(v.callback){const m=v.callbackId,s=this.callbackCapabilities[m];if(!s)throw new Error(`Cannot resolve callback ${m}`);if(delete this.callbackCapabilities[m],v.callback===T.DATA)s.resolve(v.data);else if(v.callback===T.ERROR)s.reject(q(v.reason));else throw new Error("Unexpected callback case");return}const d=this.actionHandler[v.action];if(!d)throw new Error(`Unknown action from worker: ${v.action}`);if(v.callbackId){const m=this.sourceName,s=v.sourceName;new Promise(function(a){a(d(v.data))}).then(function(a){w.postMessage({sourceName:m,targetName:s,callback:T.DATA,callbackId:v.callbackId,data:a})},function(a){w.postMessage({sourceName:m,targetName:s,callback:T.ERROR,callbackId:v.callbackId,reason:q(a)})});return}if(v.streamId){this._createStreamSink(v);return}d(v.data)},w.addEventListener("message",this._onComObjOnMessage)}on(S,b){const w=this.actionHandler;if(w[S])throw new Error(`There is already an actionName called "${S}"`);w[S]=b}send(S,b,w){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:S,data:b},w)}sendWithPromise(S,b,w){const x=this.callbackId++,v=(0,g.createPromiseCapability)();this.callbackCapabilities[x]=v;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:S,callbackId:x,data:b},w)}catch(d){v.reject(d)}return v.promise}sendWithStream(S,b,w,x){const v=this.streamId++,d=this.sourceName,m=this.targetName,s=this.comObj;return new ReadableStream({start:a=>{const F=(0,g.createPromiseCapability)();return this.streamControllers[v]={controller:a,startCall:F,pullCall:null,cancelCall:null,isClosed:!1},s.postMessage({sourceName:d,targetName:m,action:S,streamId:v,data:b,desiredSize:a.desiredSize},x),F.promise},pull:a=>{const F=(0,g.createPromiseCapability)();return this.streamControllers[v].pullCall=F,s.postMessage({sourceName:d,targetName:m,stream:V.PULL,streamId:v,desiredSize:a.desiredSize}),F.promise},cancel:a=>{(0,g.assert)(a instanceof Error,"cancel must have a valid reason");const F=(0,g.createPromiseCapability)();return this.streamControllers[v].cancelCall=F,this.streamControllers[v].isClosed=!0,s.postMessage({sourceName:d,targetName:m,stream:V.CANCEL,streamId:v,reason:q(a)}),F.promise}},w)}_createStreamSink(S){const b=S.streamId,w=this.sourceName,x=S.sourceName,v=this.comObj,d=this,m=this.actionHandler[S.action],s={enqueue(a,F=1,M){if(this.isCancelled)return;const A=this.desiredSize;this.desiredSize-=F,A>0&&this.desiredSize<=0&&(this.sinkCapability=(0,g.createPromiseCapability)(),this.ready=this.sinkCapability.promise),v.postMessage({sourceName:w,targetName:x,stream:V.ENQUEUE,streamId:b,chunk:a},M)},close(){this.isCancelled||(this.isCancelled=!0,v.postMessage({sourceName:w,targetName:x,stream:V.CLOSE,streamId:b}),delete d.streamSinks[b])},error(a){(0,g.assert)(a instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,v.postMessage({sourceName:w,targetName:x,stream:V.ERROR,streamId:b,reason:q(a)}))},sinkCapability:(0,g.createPromiseCapability)(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:S.desiredSize,ready:null};s.sinkCapability.resolve(),s.ready=s.sinkCapability.promise,this.streamSinks[b]=s,new Promise(function(a){a(m(S.data,s))}).then(function(){v.postMessage({sourceName:w,targetName:x,stream:V.START_COMPLETE,streamId:b,success:!0})},function(a){v.postMessage({sourceName:w,targetName:x,stream:V.START_COMPLETE,streamId:b,reason:q(a)})})}_processStreamMessage(S){const b=S.streamId,w=this.sourceName,x=S.sourceName,v=this.comObj,d=this.streamControllers[b],m=this.streamSinks[b];switch(S.stream){case V.START_COMPLETE:S.success?d.startCall.resolve():d.startCall.reject(q(S.reason));break;case V.PULL_COMPLETE:S.success?d.pullCall.resolve():d.pullCall.reject(q(S.reason));break;case V.PULL:if(!m){v.postMessage({sourceName:w,targetName:x,stream:V.PULL_COMPLETE,streamId:b,success:!0});break}m.desiredSize<=0&&S.desiredSize>0&&m.sinkCapability.resolve(),m.desiredSize=S.desiredSize,new Promise(function(s){s(m.onPull&&m.onPull())}).then(function(){v.postMessage({sourceName:w,targetName:x,stream:V.PULL_COMPLETE,streamId:b,success:!0})},function(s){v.postMessage({sourceName:w,targetName:x,stream:V.PULL_COMPLETE,streamId:b,reason:q(s)})});break;case V.ENQUEUE:if((0,g.assert)(d,"enqueue should have stream controller"),d.isClosed)break;d.controller.enqueue(S.chunk);break;case V.CLOSE:if((0,g.assert)(d,"close should have stream controller"),d.isClosed)break;d.isClosed=!0,d.controller.close(),this._deleteStreamController(d,b);break;case V.ERROR:(0,g.assert)(d,"error should have stream controller"),d.controller.error(q(S.reason)),this._deleteStreamController(d,b);break;case V.CANCEL_COMPLETE:S.success?d.cancelCall.resolve():d.cancelCall.reject(q(S.reason)),this._deleteStreamController(d,b);break;case V.CANCEL:if(!m)break;new Promise(function(s){s(m.onCancel&&m.onCancel(q(S.reason)))}).then(function(){v.postMessage({sourceName:w,targetName:x,stream:V.CANCEL_COMPLETE,streamId:b,success:!0})},function(s){v.postMessage({sourceName:w,targetName:x,stream:V.CANCEL_COMPLETE,streamId:b,reason:q(s)})}),m.sinkCapability.reject(q(S.reason)),m.isCancelled=!0,delete this.streamSinks[b];break;default:throw new Error("Unexpected stream case")}}async _deleteStreamController(S,b){await Promise.allSettled([S.startCall&&S.startCall.promise,S.pullCall&&S.pullCall.promise,S.cancelCall&&S.cancelCall.promise]),delete this.streamControllers[b]}destroy(){this.comObj.removeEventListener("message",this._onComObjOnMessage)}}f.MessageHandler=et},(at,f,z)=>{var V,q;Object.defineProperty(f,"__esModule",{value:!0}),f.Metadata=void 0;var g=z(1);class T{constructor({parsedData:I,rawData:S}){Q(this,V,void 0);Q(this,q,void 0);pt(this,V,I),pt(this,q,S)}getRaw(){return p(this,q)}get(I){return p(this,V).get(I)??null}getAll(){return(0,g.objectFromMap)(p(this,V))}has(I){return p(this,V).has(I)}}V=new WeakMap,q=new WeakMap,f.Metadata=T},(at,f,z)=>{var I,S,b,w,x,v,_e;Object.defineProperty(f,"__esModule",{value:!0}),f.OptionalContentConfig=void 0;var g=z(1),T=z(8);const V=Symbol("INTERNAL");class q{constructor(s,a){Q(this,I,!0);this.name=s,this.intent=a}get visible(){return p(this,I)}_setVisible(s,a){s!==V&&(0,g.unreachable)("Internal method `_setVisible` called."),pt(this,I,a)}}I=new WeakMap;class et{constructor(s){Q(this,v);Q(this,S,null);Q(this,b,new Map);Q(this,w,null);Q(this,x,null);if(this.name=null,this.creator=null,s!==null){this.name=s.name,this.creator=s.creator,pt(this,x,s.order);for(const a of s.groups)p(this,b).set(a.id,new q(a.name,a.intent));if(s.baseState==="OFF")for(const a of p(this,b).values())a._setVisible(V,!1);for(const a of s.on)p(this,b).get(a)._setVisible(V,!0);for(const a of s.off)p(this,b).get(a)._setVisible(V,!1);pt(this,w,this.getHash())}}isVisible(s){if(p(this,b).size===0)return!0;if(!s)return(0,g.warn)("Optional content group not defined."),!0;if(s.type==="OCG")return p(this,b).has(s.id)?p(this,b).get(s.id).visible:((0,g.warn)(`Optional content group not found: ${s.id}`),!0);if(s.type==="OCMD"){if(s.expression)return ot(this,v,_e).call(this,s.expression);if(!s.policy||s.policy==="AnyOn"){for(const a of s.ids){if(!p(this,b).has(a))return(0,g.warn)(`Optional content group not found: ${a}`),!0;if(p(this,b).get(a).visible)return!0}return!1}else if(s.policy==="AllOn"){for(const a of s.ids){if(!p(this,b).has(a))return(0,g.warn)(`Optional content group not found: ${a}`),!0;if(!p(this,b).get(a).visible)return!1}return!0}else if(s.policy==="AnyOff"){for(const a of s.ids){if(!p(this,b).has(a))return(0,g.warn)(`Optional content group not found: ${a}`),!0;if(!p(this,b).get(a).visible)return!0}return!1}else if(s.policy==="AllOff"){for(const a of s.ids){if(!p(this,b).has(a))return(0,g.warn)(`Optional content group not found: ${a}`),!0;if(p(this,b).get(a).visible)return!1}return!0}return(0,g.warn)(`Unknown optional content policy ${s.policy}.`),!0}return(0,g.warn)(`Unknown group type ${s.type}.`),!0}setVisibility(s,a=!0){if(!p(this,b).has(s)){(0,g.warn)(`Optional content group not found: ${s}`);return}p(this,b).get(s)._setVisible(V,!!a),pt(this,S,null)}get hasInitialVisibility(){return this.getHash()===p(this,w)}getOrder(){return p(this,b).size?p(this,x)?p(this,x).slice():[...p(this,b).keys()]:null}getGroups(){return p(this,b).size>0?(0,g.objectFromMap)(p(this,b)):null}getGroup(s){return p(this,b).get(s)||null}getHash(){if(p(this,S)!==null)return p(this,S);const s=new T.MurmurHash3_64;for(const[a,F]of p(this,b))s.update(`${a}:${F.visible}`);return pt(this,S,s.hexdigest())}}S=new WeakMap,b=new WeakMap,w=new WeakMap,x=new WeakMap,v=new WeakSet,_e=function(s){const a=s.length;if(a<2)return!0;const F=s[0];for(let M=1;M<a;M++){const A=s[M];let t;if(Array.isArray(A))t=ot(this,v,_e).call(this,A);else if(p(this,b).has(A))t=p(this,b).get(A).visible;else return(0,g.warn)(`Optional content group not found: ${A}`),!0;switch(F){case"And":if(!t)return!1;break;case"Or":if(t)return!0;break;case"Not":return!t;default:return!0}}return F==="And"},f.OptionalContentConfig=et},(at,f,z)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.PDFDataTransportStream=void 0;var g=z(1),T=z(6);class V{constructor({length:S,initialData:b,progressiveDone:w=!1,contentDispositionFilename:x=null,disableRange:v=!1,disableStream:d=!1},m){if((0,g.assert)(m,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.'),this._queuedChunks=[],this._progressiveDone=w,this._contentDispositionFilename=x,(b==null?void 0:b.length)>0){const s=b instanceof Uint8Array&&b.byteLength===b.buffer.byteLength?b.buffer:new Uint8Array(b).buffer;this._queuedChunks.push(s)}this._pdfDataRangeTransport=m,this._isStreamingSupported=!d,this._isRangeSupported=!v,this._contentLength=S,this._fullRequestReader=null,this._rangeReaders=[],this._pdfDataRangeTransport.addRangeListener((s,a)=>{this._onReceiveData({begin:s,chunk:a})}),this._pdfDataRangeTransport.addProgressListener((s,a)=>{this._onProgress({loaded:s,total:a})}),this._pdfDataRangeTransport.addProgressiveReadListener(s=>{this._onReceiveData({chunk:s})}),this._pdfDataRangeTransport.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),this._pdfDataRangeTransport.transportReady()}_onReceiveData({begin:S,chunk:b}){const w=b instanceof Uint8Array&&b.byteLength===b.buffer.byteLength?b.buffer:new Uint8Array(b).buffer;if(S===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(w):this._queuedChunks.push(w);else{const x=this._rangeReaders.some(function(v){return v._begin!==S?!1:(v._enqueue(w),!0)});(0,g.assert)(x,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){var S;return((S=this._fullRequestReader)==null?void 0:S._loaded)??0}_onProgress(S){var b,w,x,v;S.total===void 0?(w=(b=this._rangeReaders[0])==null?void 0:b.onProgress)==null||w.call(b,{loaded:S.loaded}):(v=(x=this._fullRequestReader)==null?void 0:x.onProgress)==null||v.call(x,{loaded:S.loaded,total:S.total})}_onProgressiveDone(){var S;(S=this._fullRequestReader)==null||S.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(S){const b=this._rangeReaders.indexOf(S);b>=0&&this._rangeReaders.splice(b,1)}getFullReader(){(0,g.assert)(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const S=this._queuedChunks;return this._queuedChunks=null,new q(this,S,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(S,b){if(b<=this._progressiveDataLength)return null;const w=new et(this,S,b);return this._pdfDataRangeTransport.requestDataRange(S,b),this._rangeReaders.push(w),w}cancelAllRequests(S){var b;(b=this._fullRequestReader)==null||b.cancel(S);for(const w of this._rangeReaders.slice(0))w.cancel(S);this._pdfDataRangeTransport.abort()}}f.PDFDataTransportStream=V;class q{constructor(S,b,w=!1,x=null){this._stream=S,this._done=w||!1,this._filename=(0,T.isPdfFile)(x)?x:null,this._queuedChunks=b||[],this._loaded=0;for(const v of this._queuedChunks)this._loaded+=v.byteLength;this._requests=[],this._headersReady=Promise.resolve(),S._fullRequestReader=this,this.onProgress=null}_enqueue(S){this._done||(this._requests.length>0?this._requests.shift().resolve({value:S,done:!1}):this._queuedChunks.push(S),this._loaded+=S.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const S=(0,g.createPromiseCapability)();return this._requests.push(S),S.promise}cancel(S){this._done=!0;for(const b of this._requests)b.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class et{constructor(S,b,w){this._stream=S,this._begin=b,this._end=w,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(S){if(!this._done){if(this._requests.length===0)this._queuedChunk=S;else{this._requests.shift().resolve({value:S,done:!1});for(const w of this._requests)w.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const b=this._queuedChunk;return this._queuedChunk=null,{value:b,done:!1}}if(this._done)return{value:void 0,done:!0};const S=(0,g.createPromiseCapability)();return this._requests.push(S),S.promise}cancel(S){this._done=!0;for(const b of this._requests)b.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}},(at,f)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.XfaText=void 0;class z{static textContent(T){const V=[],q={items:V,styles:Object.create(null)};function et(I){var w;if(!I)return;let S=null;const b=I.name;if(b==="#text")S=I.value;else if(z.shouldBuildText(b))(w=I==null?void 0:I.attributes)!=null&&w.textContent?S=I.attributes.textContent:I.value&&(S=I.value);else return;if(S!==null&&V.push({str:S}),!!I.children)for(const x of I.children)et(x)}return et(T),q}static shouldBuildText(T){return!(T==="textarea"||T==="input"||T==="option"||T==="select")}}f.XfaText=z},(at,f,z)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.NodeStandardFontDataFactory=f.NodeFilterFactory=f.NodeCanvasFactory=f.NodeCMapReaderFactory=void 0;var g=z(7);const T=function(S){return new Promise((b,w)=>{require$$5.readFile(S,(v,d)=>{if(v||!d){w(new Error(v));return}b(new Uint8Array(d))})})};class V extends g.BaseFilterFactory{}f.NodeFilterFactory=V;class q extends g.BaseCanvasFactory{_createCanvas(b,w){return require$$5.createCanvas(b,w)}}f.NodeCanvasFactory=q;class et extends g.BaseCMapReaderFactory{_fetchData(b,w){return T(b).then(x=>({cMapData:x,compressionType:w}))}}f.NodeCMapReaderFactory=et;class I extends g.BaseStandardFontDataFactory{_fetchData(b){return T(b)}}f.NodeStandardFontDataFactory=I},(at,f,z)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.PDFNodeStream=void 0;var g=z(1),T=z(22);const V=require$$5,q=require$$5,et=require$$5,I=require$$5,S=/^file:\/\/\/[a-zA-Z]:\//;function b(M){const A=I.parse(M);return A.protocol==="file:"||A.host?A:/^[a-z]:[/\\]/i.test(M)?I.parse(`file:///${M}`):(A.host||(A.protocol="file:"),A)}class w{constructor(A){this.source=A,this.url=b(A.url),this.isHttp=this.url.protocol==="http:"||this.url.protocol==="https:",this.isFsUrl=this.url.protocol==="file:",this.httpHeaders=this.isHttp&&A.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var A;return((A=this._fullRequestReader)==null?void 0:A._loaded)??0}getFullReader(){return(0,g.assert)(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=this.isFsUrl?new a(this):new m(this),this._fullRequestReader}getRangeReader(A,t){if(t<=this._progressiveDataLength)return null;const l=this.isFsUrl?new F(this,A,t):new s(this,A,t);return this._rangeRequestReaders.push(l),l}cancelAllRequests(A){var t;(t=this._fullRequestReader)==null||t.cancel(A);for(const l of this._rangeRequestReaders.slice(0))l.cancel(A)}}f.PDFNodeStream=w;class x{constructor(A){this._url=A.url,this._done=!1,this._storedError=null,this.onProgress=null;const t=A.source;this._contentLength=t.length,this._loaded=0,this._filename=null,this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange,this._readableStream=null,this._readCapability=(0,g.createPromiseCapability)(),this._headersCapability=(0,g.createPromiseCapability)()}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var l;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const A=this._readableStream.read();return A===null?(this._readCapability=(0,g.createPromiseCapability)(),this.read()):(this._loaded+=A.length,(l=this.onProgress)==null||l.call(this,{loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(A).buffer,done:!1})}cancel(A){if(!this._readableStream){this._error(A);return}this._readableStream.destroy(A)}_error(A){this._storedError=A,this._readCapability.resolve()}_setReadableStream(A){this._readableStream=A,A.on("readable",()=>{this._readCapability.resolve()}),A.on("end",()=>{A.destroy(),this._done=!0,this._readCapability.resolve()}),A.on("error",t=>{this._error(t)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new g.AbortException("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class v{constructor(A){this._url=A.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=(0,g.createPromiseCapability)();const t=A.source;this._isStreamingSupported=!t.disableStream}get isStreamingSupported(){return this._isStreamingSupported}async read(){var l;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const A=this._readableStream.read();return A===null?(this._readCapability=(0,g.createPromiseCapability)(),this.read()):(this._loaded+=A.length,(l=this.onProgress)==null||l.call(this,{loaded:this._loaded}),{value:new Uint8Array(A).buffer,done:!1})}cancel(A){if(!this._readableStream){this._error(A);return}this._readableStream.destroy(A)}_error(A){this._storedError=A,this._readCapability.resolve()}_setReadableStream(A){this._readableStream=A,A.on("readable",()=>{this._readCapability.resolve()}),A.on("end",()=>{A.destroy(),this._done=!0,this._readCapability.resolve()}),A.on("error",t=>{this._error(t)}),this._storedError&&this._readableStream.destroy(this._storedError)}}function d(M,A){return{protocol:M.protocol,auth:M.auth,host:M.hostname,port:M.port,path:M.path,method:"GET",headers:A}}class m extends x{constructor(A){super(A);const t=l=>{if(l.statusCode===404){const C=new g.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=C,this._headersCapability.reject(C);return}this._headersCapability.resolve(),this._setReadableStream(l);const o=C=>this._readableStream.headers[C.toLowerCase()],{allowRangeRequests:n,suggestedLength:u}=(0,T.validateRangeRequestCapabilities)({getResponseHeader:o,isHttp:A.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=n,this._contentLength=u||this._contentLength,this._filename=(0,T.extractFilenameFromHeader)(o)};this._request=null,this._url.protocol==="http:"?this._request=q.request(d(this._url,A.httpHeaders),t):this._request=et.request(d(this._url,A.httpHeaders),t),this._request.on("error",l=>{this._storedError=l,this._headersCapability.reject(l)}),this._request.end()}}class s extends v{constructor(A,t,l){super(A),this._httpHeaders={};for(const n in A.httpHeaders){const u=A.httpHeaders[n];u!==void 0&&(this._httpHeaders[n]=u)}this._httpHeaders.Range=`bytes=${t}-${l-1}`;const o=n=>{if(n.statusCode===404){const u=new g.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=u;return}this._setReadableStream(n)};this._request=null,this._url.protocol==="http:"?this._request=q.request(d(this._url,this._httpHeaders),o):this._request=et.request(d(this._url,this._httpHeaders),o),this._request.on("error",n=>{this._storedError=n}),this._request.end()}}class a extends x{constructor(A){super(A);let t=decodeURIComponent(this._url.path);S.test(this._url.href)&&(t=t.replace(/^\//,"")),V.lstat(t,(l,o)=>{if(l){l.code==="ENOENT"&&(l=new g.MissingPDFException(`Missing PDF "${t}".`)),this._storedError=l,this._headersCapability.reject(l);return}this._contentLength=o.size,this._setReadableStream(V.createReadStream(t)),this._headersCapability.resolve()})}}class F extends v{constructor(A,t,l){super(A);let o=decodeURIComponent(this._url.path);S.test(this._url.href)&&(o=o.replace(/^\//,"")),this._setReadableStream(V.createReadStream(o,{start:t,end:l-1}))}}},(at,f,z)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.createResponseStatusError=I,f.extractFilenameFromHeader=et,f.validateRangeRequestCapabilities=q,f.validateResponseStatus=S;var g=z(1),T=z(23),V=z(6);function q({getResponseHeader:b,isHttp:w,rangeChunkSize:x,disableRange:v}){const d={allowRangeRequests:!1,suggestedLength:void 0},m=parseInt(b("Content-Length"),10);return!Number.isInteger(m)||(d.suggestedLength=m,m<=2*x)||v||!w||b("Accept-Ranges")!=="bytes"||(b("Content-Encoding")||"identity")!=="identity"||(d.allowRangeRequests=!0),d}function et(b){const w=b("Content-Disposition");if(w){let x=(0,T.getFilenameFromContentDispositionHeader)(w);if(x.includes("%"))try{x=decodeURIComponent(x)}catch{}if((0,V.isPdfFile)(x))return x}return null}function I(b,w){return b===404||b===0&&w.startsWith("file:")?new g.MissingPDFException('Missing PDF "'+w+'".'):new g.UnexpectedResponseException(`Unexpected server response (${b}) while retrieving PDF "${w}".`,b)}function S(b){return b===200||b===206}},(at,f,z)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.getFilenameFromContentDispositionHeader=T;var g=z(1);function T(V){let q=!0,et=I("filename\\*","i").exec(V);if(et){et=et[1];let m=x(et);return m=unescape(m),m=v(m),m=d(m),b(m)}if(et=w(V),et){const m=d(et);return b(m)}if(et=I("filename","i").exec(V),et){et=et[1];let m=x(et);return m=d(m),b(m)}function I(m,s){return new RegExp("(?:^|;)\\s*"+m+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',s)}function S(m,s){if(m){if(!/^[\x00-\xFF]+$/.test(s))return s;try{const a=new TextDecoder(m,{fatal:!0}),F=(0,g.stringToBytes)(s);s=a.decode(F),q=!1}catch{}}return s}function b(m){return q&&/[\x80-\xff]/.test(m)&&(m=S("utf-8",m),q&&(m=S("iso-8859-1",m))),m}function w(m){const s=[];let a;const F=I("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(a=F.exec(m))!==null;){let[,A,t,l]=a;if(A=parseInt(A,10),A in s){if(A===0)break;continue}s[A]=[t,l]}const M=[];for(let A=0;A<s.length&&A in s;++A){let[t,l]=s[A];l=x(l),t&&(l=unescape(l),A===0&&(l=v(l))),M.push(l)}return M.join("")}function x(m){if(m.startsWith('"')){const s=m.slice(1).split('\\"');for(let a=0;a<s.length;++a){const F=s[a].indexOf('"');F!==-1&&(s[a]=s[a].slice(0,F),s.length=a+1),s[a]=s[a].replaceAll(/\\(.)/g,"$1")}m=s.join('"')}return m}function v(m){const s=m.indexOf("'");if(s===-1)return m;const a=m.slice(0,s),M=m.slice(s+1).replace(/^[^']*'/,"");return S(a,M)}function d(m){return!m.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(m)?m:m.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(s,a,F,M){if(F==="q"||F==="Q")return M=M.replaceAll("_"," "),M=M.replaceAll(/=([0-9a-fA-F]{2})/g,function(A,t){return String.fromCharCode(parseInt(t,16))}),S(a,M);try{M=atob(M)}catch{}return S(a,M)})}return""}},(at,f,z)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.PDFNetworkStream=void 0;var g=z(1),T=z(22);const V=200,q=206;function et(x){const v=x.response;return typeof v!="string"?v:(0,g.stringToBytes)(v).buffer}class I{constructor(v,d={}){this.url=v,this.isHttp=/^https?:/i.test(v),this.httpHeaders=this.isHttp&&d.httpHeaders||Object.create(null),this.withCredentials=d.withCredentials||!1,this.getXhr=d.getXhr||function(){return new XMLHttpRequest},this.currXhrId=0,this.pendingRequests=Object.create(null)}requestRange(v,d,m){const s={begin:v,end:d};for(const a in m)s[a]=m[a];return this.request(s)}requestFull(v){return this.request(v)}request(v){const d=this.getXhr(),m=this.currXhrId++,s=this.pendingRequests[m]={xhr:d};d.open("GET",this.url),d.withCredentials=this.withCredentials;for(const a in this.httpHeaders){const F=this.httpHeaders[a];F!==void 0&&d.setRequestHeader(a,F)}return this.isHttp&&"begin"in v&&"end"in v?(d.setRequestHeader("Range",`bytes=${v.begin}-${v.end-1}`),s.expectedStatus=q):s.expectedStatus=V,d.responseType="arraybuffer",v.onError&&(d.onerror=function(a){v.onError(d.status)}),d.onreadystatechange=this.onStateChange.bind(this,m),d.onprogress=this.onProgress.bind(this,m),s.onHeadersReceived=v.onHeadersReceived,s.onDone=v.onDone,s.onError=v.onError,s.onProgress=v.onProgress,d.send(null),m}onProgress(v,d){var s;const m=this.pendingRequests[v];m&&((s=m.onProgress)==null||s.call(m,d))}onStateChange(v,d){var A,t,l;const m=this.pendingRequests[v];if(!m)return;const s=m.xhr;if(s.readyState>=2&&m.onHeadersReceived&&(m.onHeadersReceived(),delete m.onHeadersReceived),s.readyState!==4||!(v in this.pendingRequests))return;if(delete this.pendingRequests[v],s.status===0&&this.isHttp){(A=m.onError)==null||A.call(m,s.status);return}const a=s.status||V;if(!(a===V&&m.expectedStatus===q)&&a!==m.expectedStatus){(t=m.onError)==null||t.call(m,s.status);return}const M=et(s);if(a===q){const o=s.getResponseHeader("Content-Range"),n=/bytes (\d+)-(\d+)\/(\d+)/.exec(o);m.onDone({begin:parseInt(n[1],10),chunk:M})}else M?m.onDone({begin:0,chunk:M}):(l=m.onError)==null||l.call(m,s.status)}getRequestXhr(v){return this.pendingRequests[v].xhr}isPendingRequest(v){return v in this.pendingRequests}abortRequest(v){const d=this.pendingRequests[v].xhr;delete this.pendingRequests[v],d.abort()}}class S{constructor(v){this._source=v,this._manager=new I(v.url,{httpHeaders:v.httpHeaders,withCredentials:v.withCredentials}),this._rangeChunkSize=v.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(v){const d=this._rangeRequestReaders.indexOf(v);d>=0&&this._rangeRequestReaders.splice(d,1)}getFullReader(){return(0,g.assert)(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new b(this._manager,this._source),this._fullRequestReader}getRangeReader(v,d){const m=new w(this._manager,v,d);return m.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(m),m}cancelAllRequests(v){var d;(d=this._fullRequestReader)==null||d.cancel(v);for(const m of this._rangeRequestReaders.slice(0))m.cancel(v)}}f.PDFNetworkStream=S;class b{constructor(v,d){this._manager=v;const m={onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=d.url,this._fullRequestId=v.requestFull(m),this._headersReceivedCapability=(0,g.createPromiseCapability)(),this._disableRange=d.disableRange||!1,this._contentLength=d.length,this._rangeChunkSize=d.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const v=this._fullRequestId,d=this._manager.getRequestXhr(v),m=F=>d.getResponseHeader(F),{allowRangeRequests:s,suggestedLength:a}=(0,T.validateRangeRequestCapabilities)({getResponseHeader:m,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});s&&(this._isRangeSupported=!0),this._contentLength=a||this._contentLength,this._filename=(0,T.extractFilenameFromHeader)(m),this._isRangeSupported&&this._manager.abortRequest(v),this._headersReceivedCapability.resolve()}_onDone(v){if(v&&(this._requests.length>0?this._requests.shift().resolve({value:v.chunk,done:!1}):this._cachedChunks.push(v.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const d of this._requests)d.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(v){this._storedError=(0,T.createResponseStatusError)(v,this._url),this._headersReceivedCapability.reject(this._storedError);for(const d of this._requests)d.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(v){var d;(d=this.onProgress)==null||d.call(this,{loaded:v.loaded,total:v.lengthComputable?v.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersReceivedCapability.promise}async read(){if(this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const v=(0,g.createPromiseCapability)();return this._requests.push(v),v.promise}cancel(v){this._done=!0,this._headersReceivedCapability.reject(v);for(const d of this._requests)d.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class w{constructor(v,d,m){this._manager=v;const s={onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=v.url,this._requestId=v.requestRange(d,m,s),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_close(){var v;(v=this.onClosed)==null||v.call(this,this)}_onDone(v){const d=v.chunk;this._requests.length>0?this._requests.shift().resolve({value:d,done:!1}):this._queuedChunk=d,this._done=!0;for(const m of this._requests)m.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(v){this._storedError=(0,T.createResponseStatusError)(v,this._url);for(const d of this._requests)d.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(v){var d;this.isStreamingSupported||(d=this.onProgress)==null||d.call(this,{loaded:v.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const d=this._queuedChunk;return this._queuedChunk=null,{value:d,done:!1}}if(this._done)return{value:void 0,done:!0};const v=(0,g.createPromiseCapability)();return this._requests.push(v),v.promise}cancel(v){this._done=!0;for(const d of this._requests)d.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}},(at,f,z)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.PDFFetchStream=void 0;var g=z(1),T=z(22);function V(w,x,v){return{method:"GET",headers:w,signal:v.signal,mode:"cors",credentials:x?"include":"same-origin",redirect:"follow"}}function q(w){const x=new Headers;for(const v in w){const d=w[v];d!==void 0&&x.append(v,d)}return x}function et(w){return w instanceof Uint8Array?w.buffer:w instanceof ArrayBuffer?w:((0,g.warn)(`getArrayBuffer - unexpected data format: ${w}`),new Uint8Array(w).buffer)}class I{constructor(x){this.source=x,this.isHttp=/^https?:/i.test(x.url),this.httpHeaders=this.isHttp&&x.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var x;return((x=this._fullRequestReader)==null?void 0:x._loaded)??0}getFullReader(){return(0,g.assert)(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new S(this),this._fullRequestReader}getRangeReader(x,v){if(v<=this._progressiveDataLength)return null;const d=new b(this,x,v);return this._rangeRequestReaders.push(d),d}cancelAllRequests(x){var v;(v=this._fullRequestReader)==null||v.cancel(x);for(const d of this._rangeRequestReaders.slice(0))d.cancel(x)}}f.PDFFetchStream=I;class S{constructor(x){this._stream=x,this._reader=null,this._loaded=0,this._filename=null;const v=x.source;this._withCredentials=v.withCredentials||!1,this._contentLength=v.length,this._headersCapability=(0,g.createPromiseCapability)(),this._disableRange=v.disableRange||!1,this._rangeChunkSize=v.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!v.disableStream,this._isRangeSupported=!v.disableRange,this._headers=q(this._stream.httpHeaders);const d=v.url;fetch(d,V(this._headers,this._withCredentials,this._abortController)).then(m=>{if(!(0,T.validateResponseStatus)(m.status))throw(0,T.createResponseStatusError)(m.status,d);this._reader=m.body.getReader(),this._headersCapability.resolve();const s=M=>m.headers.get(M),{allowRangeRequests:a,suggestedLength:F}=(0,T.validateRangeRequestCapabilities)({getResponseHeader:s,isHttp:this._stream.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=a,this._contentLength=F||this._contentLength,this._filename=(0,T.extractFilenameFromHeader)(s),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new g.AbortException("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var d;await this._headersCapability.promise;const{value:x,done:v}=await this._reader.read();return v?{value:x,done:v}:(this._loaded+=x.byteLength,(d=this.onProgress)==null||d.call(this,{loaded:this._loaded,total:this._contentLength}),{value:et(x),done:!1})}cancel(x){var v;(v=this._reader)==null||v.cancel(x),this._abortController.abort()}}class b{constructor(x,v,d){this._stream=x,this._reader=null,this._loaded=0;const m=x.source;this._withCredentials=m.withCredentials||!1,this._readCapability=(0,g.createPromiseCapability)(),this._isStreamingSupported=!m.disableStream,this._abortController=new AbortController,this._headers=q(this._stream.httpHeaders),this._headers.append("Range",`bytes=${v}-${d-1}`);const s=m.url;fetch(s,V(this._headers,this._withCredentials,this._abortController)).then(a=>{if(!(0,T.validateResponseStatus)(a.status))throw(0,T.createResponseStatusError)(a.status,s);this._readCapability.resolve(),this._reader=a.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){var d;await this._readCapability.promise;const{value:x,done:v}=await this._reader.read();return v?{value:x,done:v}:(this._loaded+=x.byteLength,(d=this.onProgress)==null||d.call(this,{loaded:this._loaded}),{value:et(x),done:!1})}cancel(x){var v;(v=this._reader)==null||v.cancel(x),this._abortController.abort()}}},(at,f,z)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.TextLayerRenderTask=void 0,f.renderTextLayer=m,f.updateTextLayer=s;var g=z(1),T=z(6);const V=1e5,q=30,et=.8,I=new Map;function S(a,F){let M;if(F&&g.FeatureTest.isOffscreenCanvasSupported)M=new OffscreenCanvas(a,a).getContext("2d",{alpha:!1});else{const A=document.createElement("canvas");A.width=A.height=a,M=A.getContext("2d",{alpha:!1})}return M}function b(a,F){const M=I.get(a);if(M)return M;const A=S(q,F);A.font=`${q}px ${a}`;const t=A.measureText("");let l=t.fontBoundingBoxAscent,o=Math.abs(t.fontBoundingBoxDescent);if(l){const u=l/(l+o);return I.set(a,u),A.canvas.width=A.canvas.height=0,u}A.strokeStyle="red",A.clearRect(0,0,q,q),A.strokeText("g",0,0);let n=A.getImageData(0,0,q,q).data;o=0;for(let u=n.length-1-3;u>=0;u-=4)if(n[u]>0){o=Math.ceil(u/4/q);break}A.clearRect(0,0,q,q),A.strokeText("A",0,q),n=A.getImageData(0,0,q,q).data,l=0;for(let u=0,C=n.length;u<C;u+=4)if(n[u]>0){l=q-Math.floor(u/4/q);break}if(A.canvas.width=A.canvas.height=0,l){const u=l/(l+o);return I.set(a,u),u}return I.set(a,et),et}function w(a,F,M){const A=document.createElement("span"),t={angle:0,canvasWidth:0,hasText:F.str!=="",hasEOL:F.hasEOL,fontSize:0};a._textDivs.push(A);const l=g.Util.transform(a._transform,F.transform);let o=Math.atan2(l[1],l[0]);const n=M[F.fontName];n.vertical&&(o+=Math.PI/2);const u=Math.hypot(l[2],l[3]),C=u*b(n.fontFamily,a._isOffscreenCanvasSupported);let i,O;o===0?(i=l[4],O=l[5]-C):(i=l[4]+C*Math.sin(o),O=l[5]-C*Math.cos(o));const X="calc(var(--scale-factor)*",Y=A.style;a._container===a._rootContainer?(Y.left=`${(100*i/a._pageWidth).toFixed(2)}%`,Y.top=`${(100*O/a._pageHeight).toFixed(2)}%`):(Y.left=`${X}${i.toFixed(2)}px)`,Y.top=`${X}${O.toFixed(2)}px)`),Y.fontSize=`${X}${u.toFixed(2)}px)`,Y.fontFamily=n.fontFamily,t.fontSize=u,A.setAttribute("role","presentation"),A.textContent=F.str,A.dir=F.dir,a._fontInspectorEnabled&&(A.dataset.fontName=F.fontName),o!==0&&(t.angle=o*(180/Math.PI));let tt=!1;if(F.str.length>1)tt=!0;else if(F.str!==" "&&F.transform[0]!==F.transform[3]){const nt=Math.abs(F.transform[0]),ft=Math.abs(F.transform[3]);nt!==ft&&Math.max(nt,ft)/Math.min(nt,ft)>1.5&&(tt=!0)}tt&&(t.canvasWidth=n.vertical?F.height:F.width),a._textDivProperties.set(A,t),a._isReadableStream&&a._layoutText(A)}function x(a){const{div:F,scale:M,properties:A,ctx:t,prevFontSize:l,prevFontFamily:o}=a,{style:n}=F;let u="";if(A.canvasWidth!==0&&A.hasText){const{fontFamily:C}=n,{canvasWidth:i,fontSize:O}=A;(l!==O||o!==C)&&(t.font=`${O*M}px ${C}`,a.prevFontSize=O,a.prevFontFamily=C);const{width:X}=t.measureText(F.textContent);X>0&&(u=`scaleX(${i*M/X})`)}A.angle!==0&&(u=`rotate(${A.angle}deg) ${u}`),u.length>0&&(n.transform=u)}function v(a){if(a._canceled)return;const F=a._textDivs,M=a._capability;if(F.length>V){M.resolve();return}if(!a._isReadableStream)for(const t of F)a._layoutText(t);M.resolve()}class d{constructor({textContentSource:F,container:M,viewport:A,textDivs:t,textDivProperties:l,textContentItemsStr:o,isOffscreenCanvasSupported:n}){var X;this._textContentSource=F,this._isReadableStream=F instanceof ReadableStream,this._container=this._rootContainer=M,this._textDivs=t||[],this._textContentItemsStr=o||[],this._isOffscreenCanvasSupported=n,this._fontInspectorEnabled=!!((X=globalThis.FontInspector)!=null&&X.enabled),this._reader=null,this._textDivProperties=l||new WeakMap,this._canceled=!1,this._capability=(0,g.createPromiseCapability)(),this._layoutTextParams={prevFontSize:null,prevFontFamily:null,div:null,scale:A.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:S(0,n)};const{pageWidth:u,pageHeight:C,pageX:i,pageY:O}=A.rawDims;this._transform=[1,0,0,-1,-i,O+C],this._pageWidth=u,this._pageHeight=C,(0,T.setLayerDimensions)(M,A),this._capability.promise.finally(()=>{this._layoutTextParams=null}).catch(()=>{})}get promise(){return this._capability.promise}cancel(){this._canceled=!0,this._reader&&(this._reader.cancel(new g.AbortException("TextLayer task cancelled.")).catch(()=>{}),this._reader=null),this._capability.reject(new g.AbortException("TextLayer task cancelled."))}_processItems(F,M){for(const A of F){if(A.str===void 0){if(A.type==="beginMarkedContentProps"||A.type==="beginMarkedContent"){const t=this._container;this._container=document.createElement("span"),this._container.classList.add("markedContent"),A.id!==null&&this._container.setAttribute("id",`${A.id}`),t.append(this._container)}else A.type==="endMarkedContent"&&(this._container=this._container.parentNode);continue}this._textContentItemsStr.push(A.str),w(this,A,M)}}_layoutText(F){const M=this._layoutTextParams.properties=this._textDivProperties.get(F);if(this._layoutTextParams.div=F,x(this._layoutTextParams),M.hasText&&this._container.append(F),M.hasEOL){const A=document.createElement("br");A.setAttribute("role","presentation"),this._container.append(A)}}_render(){const F=(0,g.createPromiseCapability)();let M=Object.create(null);if(this._isReadableStream){const A=()=>{this._reader.read().then(({value:t,done:l})=>{if(l){F.resolve();return}Object.assign(M,t.styles),this._processItems(t.items,M),A()},F.reject)};this._reader=this._textContentSource.getReader(),A()}else if(this._textContentSource){const{items:A,styles:t}=this._textContentSource;this._processItems(A,t),F.resolve()}else throw new Error('No "textContentSource" parameter specified.');F.promise.then(()=>{M=null,v(this)},this._capability.reject)}}f.TextLayerRenderTask=d;function m(a){!a.textContentSource&&(a.textContent||a.textContentStream)&&((0,T.deprecated)("The TextLayerRender `textContent`/`textContentStream` parameters will be removed in the future, please use `textContentSource` instead."),a.textContentSource=a.textContent||a.textContentStream);const{container:F,viewport:M}=a,A=getComputedStyle(F),t=A.getPropertyValue("visibility"),l=parseFloat(A.getPropertyValue("--scale-factor"));t==="visible"&&(!l||Math.abs(l-M.scale)>1e-15)&&console.error("The `--scale-factor` CSS-variable must be set, to the same value as `viewport.scale`, either on the `container`-element itself or higher up in the DOM.");const o=new d(a);return o._render(),o}function s({container:a,viewport:F,textDivs:M,textDivProperties:A,isOffscreenCanvasSupported:t,mustRotate:l=!0,mustRescale:o=!0}){if(l&&(0,T.setLayerDimensions)(a,{rotation:F.rotation}),o){const n=S(0,t),C={prevFontSize:null,prevFontFamily:null,div:null,scale:F.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:n};for(const i of M)C.properties=A.get(i),C.div=i,x(C)}}},(at,f,z)=>{var S,b,w,x,v,d,m,s,a,be,M,Be,t,Ae,o,ye;Object.defineProperty(f,"__esModule",{value:!0}),f.AnnotationEditorLayer=void 0;var g=z(1),T=z(5),V=z(28),q=z(29),et=z(6);const u=class u{constructor(i){Q(this,a);Q(this,M);Q(this,t);Q(this,o);Q(this,S,void 0);Q(this,b,!1);Q(this,w,this.pointerup.bind(this));Q(this,x,this.pointerdown.bind(this));Q(this,v,new Map);Q(this,d,!1);Q(this,m,!1);Q(this,s,void 0);u._initialized||(u._initialized=!0,V.FreeTextEditor.initialize(i.l10n),q.InkEditor.initialize(i.l10n)),i.uiManager.registerEditorTypes([V.FreeTextEditor,q.InkEditor]),pt(this,s,i.uiManager),this.pageIndex=i.pageIndex,this.div=i.div,pt(this,S,i.accessibilityManager),p(this,s).addLayer(this)}get isEmpty(){return p(this,v).size===0}updateToolbar(i){p(this,s).updateToolbar(i)}updateMode(i=p(this,s).getMode()){ot(this,o,ye).call(this),i===g.AnnotationEditorType.INK?(this.addInkEditorIfNeeded(!1),this.disableClick()):this.enableClick(),p(this,s).unselectAll(),i!==g.AnnotationEditorType.NONE&&(this.div.classList.toggle("freeTextEditing",i===g.AnnotationEditorType.FREETEXT),this.div.classList.toggle("inkEditing",i===g.AnnotationEditorType.INK),this.div.hidden=!1)}addInkEditorIfNeeded(i){if(!i&&p(this,s).getMode()!==g.AnnotationEditorType.INK)return;if(!i){for(const X of p(this,v).values())if(X.isEmpty()){X.setInBackground();return}}ot(this,t,Ae).call(this,{offsetX:0,offsetY:0}).setInBackground()}setEditingState(i){p(this,s).setEditingState(i)}addCommands(i){p(this,s).addCommands(i)}enable(){this.div.style.pointerEvents="auto";for(const i of p(this,v).values())i.enableEditing()}disable(){this.div.style.pointerEvents="none";for(const i of p(this,v).values())i.disableEditing();ot(this,o,ye).call(this),this.isEmpty&&(this.div.hidden=!0)}setActiveEditor(i){p(this,s).getActive()!==i&&p(this,s).setActiveEditor(i)}enableClick(){this.div.addEventListener("pointerdown",p(this,x)),this.div.addEventListener("pointerup",p(this,w))}disableClick(){this.div.removeEventListener("pointerdown",p(this,x)),this.div.removeEventListener("pointerup",p(this,w))}attach(i){p(this,v).set(i.id,i)}detach(i){var O;p(this,v).delete(i.id),(O=p(this,S))==null||O.removePointerInTextLayer(i.contentDiv)}remove(i){p(this,s).removeEditor(i),this.detach(i),i.div.style.display="none",setTimeout(()=>{i.div.style.display="",i.div.remove(),i.isAttachedToDOM=!1,document.activeElement===document.body&&p(this,s).focusMainContainer()},0),p(this,m)||this.addInkEditorIfNeeded(!1)}add(i){if(ot(this,a,be).call(this,i),p(this,s).addEditor(i),this.attach(i),!i.isAttachedToDOM){const O=i.render();this.div.append(O),i.isAttachedToDOM=!0}this.moveEditorInDOM(i),i.onceAdded(),p(this,s).addToAnnotationStorage(i)}moveEditorInDOM(i){var O;(O=p(this,S))==null||O.moveElementInDOM(this.div,i.div,i.contentDiv,!0)}addOrRebuild(i){i.needsToBeRebuilt()?i.rebuild():this.add(i)}addANewEditor(i){const O=()=>{this.addOrRebuild(i)},X=()=>{i.remove()};this.addCommands({cmd:O,undo:X,mustExec:!0})}addUndoableEditor(i){const O=()=>{this.addOrRebuild(i)},X=()=>{i.remove()};this.addCommands({cmd:O,undo:X,mustExec:!1})}getNextId(){return p(this,s).getId()}deserialize(i){switch(i.annotationType){case g.AnnotationEditorType.FREETEXT:return V.FreeTextEditor.deserialize(i,this,p(this,s));case g.AnnotationEditorType.INK:return q.InkEditor.deserialize(i,this,p(this,s))}return null}setSelected(i){p(this,s).setSelected(i)}toggleSelected(i){p(this,s).toggleSelected(i)}isSelected(i){return p(this,s).isSelected(i)}unselect(i){p(this,s).unselect(i)}pointerup(i){const{isMac:O}=g.FeatureTest.platform;if(!(i.button!==0||i.ctrlKey&&O)&&i.target===this.div&&p(this,d)){if(pt(this,d,!1),!p(this,b)){pt(this,b,!0);return}ot(this,t,Ae).call(this,i)}}pointerdown(i){const{isMac:O}=g.FeatureTest.platform;if(i.button!==0||i.ctrlKey&&O||i.target!==this.div)return;pt(this,d,!0);const X=p(this,s).getActive();pt(this,b,!X||X.isEmpty())}drop(i){const O=i.dataTransfer.getData("text/plain"),X=p(this,s).getEditor(O);if(!X)return;i.preventDefault(),i.dataTransfer.dropEffect="move",ot(this,a,be).call(this,X);const Y=this.div.getBoundingClientRect(),tt=i.clientX-Y.x,nt=i.clientY-Y.y;X.translate(tt-X.startX,nt-X.startY),this.moveEditorInDOM(X),X.div.focus()}dragover(i){i.preventDefault()}destroy(){var i,O;((i=p(this,s).getActive())==null?void 0:i.parent)===this&&p(this,s).setActiveEditor(null);for(const X of p(this,v).values())(O=p(this,S))==null||O.removePointerInTextLayer(X.contentDiv),X.setParent(null),X.isAttachedToDOM=!1,X.div.remove();this.div=null,p(this,v).clear(),p(this,s).removeLayer(this)}render({viewport:i}){this.viewport=i,(0,et.setLayerDimensions)(this.div,i),(0,T.bindEvents)(this,this.div,["dragover","drop"]);for(const O of p(this,s).getEditors(this.pageIndex))this.add(O);this.updateMode()}update({viewport:i}){p(this,s).commitOrRemove(),this.viewport=i,(0,et.setLayerDimensions)(this.div,{rotation:i.rotation}),this.updateMode()}get pageDimensions(){const{pageWidth:i,pageHeight:O}=this.viewport.rawDims;return[i,O]}};S=new WeakMap,b=new WeakMap,w=new WeakMap,x=new WeakMap,v=new WeakMap,d=new WeakMap,m=new WeakMap,s=new WeakMap,a=new WeakSet,be=function(i){var O;i.parent!==this&&(this.attach(i),(O=i.parent)==null||O.detach(i),i.setParent(this),i.div&&i.isAttachedToDOM&&(i.div.remove(),this.div.append(i.div)))},M=new WeakSet,Be=function(i){switch(p(this,s).getMode()){case g.AnnotationEditorType.FREETEXT:return new V.FreeTextEditor(i);case g.AnnotationEditorType.INK:return new q.InkEditor(i)}return null},t=new WeakSet,Ae=function(i){const O=this.getNextId(),X=ot(this,M,Be).call(this,{parent:this,id:O,x:i.offsetX,y:i.offsetY,uiManager:p(this,s)});return X&&this.add(X),X},o=new WeakSet,ye=function(){pt(this,m,!0);for(const i of p(this,v).values())i.isEmpty()&&i.remove();pt(this,m,!1)},Dt(u,"_initialized",!1);let I=u;f.AnnotationEditorLayer=I},(at,f,z)=>{var et,I,S,b,w,x,v,d,m,s,Ue,F,We,A,He,l,ve;Object.defineProperty(f,"__esModule",{value:!0}),f.FreeTextEditor=void 0;var g=z(1),T=z(5),V=z(4);const n=class n extends V.AnnotationEditor{constructor(i){super({...i,name:"freeTextEditor"});Q(this,s);Q(this,F);Q(this,A);Q(this,l);Q(this,et,this.editorDivBlur.bind(this));Q(this,I,this.editorDivFocus.bind(this));Q(this,S,this.editorDivInput.bind(this));Q(this,b,this.editorDivKeydown.bind(this));Q(this,w,void 0);Q(this,x,"");Q(this,v,`${this.id}-editor`);Q(this,d,!1);Q(this,m,void 0);pt(this,w,i.color||n._defaultColor||V.AnnotationEditor._defaultLineColor),pt(this,m,i.fontSize||n._defaultFontSize)}static initialize(i){this._l10nPromise=new Map(["free_text2_default_content","editor_free_text2_aria_label"].map(X=>[X,i.get(X)]));const O=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(O.getPropertyValue("--freetext-padding"))}static updateDefaultParams(i,O){switch(i){case g.AnnotationEditorParamsType.FREETEXT_SIZE:n._defaultFontSize=O;break;case g.AnnotationEditorParamsType.FREETEXT_COLOR:n._defaultColor=O;break}}updateParams(i,O){switch(i){case g.AnnotationEditorParamsType.FREETEXT_SIZE:ot(this,s,Ue).call(this,O);break;case g.AnnotationEditorParamsType.FREETEXT_COLOR:ot(this,F,We).call(this,O);break}}static get defaultPropertiesToUpdate(){return[[g.AnnotationEditorParamsType.FREETEXT_SIZE,n._defaultFontSize],[g.AnnotationEditorParamsType.FREETEXT_COLOR,n._defaultColor||V.AnnotationEditor._defaultLineColor]]}get propertiesToUpdate(){return[[g.AnnotationEditorParamsType.FREETEXT_SIZE,p(this,m)],[g.AnnotationEditorParamsType.FREETEXT_COLOR,p(this,w)]]}getInitialTranslation(){const i=this.parentScale;return[-n._internalPadding*i,-(n._internalPadding+p(this,m))*i]}rebuild(){super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this))}enableEditMode(){this.isInEditMode()||(this.parent.setEditingState(!1),this.parent.updateToolbar(g.AnnotationEditorType.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this.div.draggable=!1,this.div.removeAttribute("aria-activedescendant"),this.editorDiv.addEventListener("keydown",p(this,b)),this.editorDiv.addEventListener("focus",p(this,I)),this.editorDiv.addEventListener("blur",p(this,et)),this.editorDiv.addEventListener("input",p(this,S)))}disableEditMode(){this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",p(this,v)),this.div.draggable=!0,this.editorDiv.removeEventListener("keydown",p(this,b)),this.editorDiv.removeEventListener("focus",p(this,I)),this.editorDiv.removeEventListener("blur",p(this,et)),this.editorDiv.removeEventListener("input",p(this,S)),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freeTextEditing"))}focusin(i){super.focusin(i),i.target!==this.editorDiv&&this.editorDiv.focus()}onceAdded(){this.width||(this.enableEditMode(),this.editorDiv.focus())}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent.setEditingState(!0),this.parent.div.classList.add("freeTextEditing"),super.remove()}commit(){this.isInEditMode()&&(super.commit(),p(this,d)||(pt(this,d,!0),this.parent.addUndoableEditor(this)),this.disableEditMode(),pt(this,x,ot(this,A,He).call(this).trimEnd()),ot(this,l,ve).call(this))}shouldGetKeyboardEvents(){return this.isInEditMode()}dblclick(i){this.enableEditMode(),this.editorDiv.focus()}keydown(i){i.target===this.div&&i.key==="Enter"&&(this.enableEditMode(),this.editorDiv.focus())}editorDivKeydown(i){n._keyboardManager.exec(this,i)}editorDivFocus(i){this.isEditing=!0}editorDivBlur(i){this.isEditing=!1}editorDivInput(i){this.parent.div.classList.toggle("freeTextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let i,O;this.width&&(i=this.x,O=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",p(this,v)),this.enableEditing(),n._l10nPromise.get("editor_free_text2_aria_label").then(Y=>{var tt;return(tt=this.editorDiv)==null?void 0:tt.setAttribute("aria-label",Y)}),n._l10nPromise.get("free_text2_default_content").then(Y=>{var tt;return(tt=this.editorDiv)==null?void 0:tt.setAttribute("default-content",Y)}),this.editorDiv.contentEditable=!0;const{style:X}=this.editorDiv;if(X.fontSize=`calc(${p(this,m)}px * var(--scale-factor))`,X.color=p(this,w),this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),(0,T.bindEvents)(this,this.div,["dblclick","keydown"]),this.width){const[Y,tt]=this.parentDimensions;this.setAt(i*Y,O*tt,this.width*Y,this.height*tt);for(const nt of p(this,x).split(`
`)){const ft=document.createElement("div");ft.append(nt?document.createTextNode(nt):document.createElement("br")),this.editorDiv.append(ft)}this.div.draggable=!0,this.editorDiv.contentEditable=!1}else this.div.draggable=!1,this.editorDiv.contentEditable=!0;return this.div}get contentDiv(){return this.editorDiv}static deserialize(i,O,X){const Y=super.deserialize(i,O,X);return pt(Y,m,i.fontSize),pt(Y,w,g.Util.makeHexColor(...i.color)),pt(Y,x,i.value),Y}serialize(){if(this.isEmpty())return null;const i=n._internalPadding*this.parentScale,O=this.getRect(i,i),X=V.AnnotationEditor._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:p(this,w));return{annotationType:g.AnnotationEditorType.FREETEXT,color:X,fontSize:p(this,m),value:p(this,x),pageIndex:this.pageIndex,rect:O,rotation:this.rotation}}};et=new WeakMap,I=new WeakMap,S=new WeakMap,b=new WeakMap,w=new WeakMap,x=new WeakMap,v=new WeakMap,d=new WeakMap,m=new WeakMap,s=new WeakSet,Ue=function(i){const O=Y=>{this.editorDiv.style.fontSize=`calc(${Y}px * var(--scale-factor))`,this.translate(0,-(Y-p(this,m))*this.parentScale),pt(this,m,Y),ot(this,l,ve).call(this)},X=p(this,m);this.addCommands({cmd:()=>{O(i)},undo:()=>{O(X)},mustExec:!0,type:g.AnnotationEditorParamsType.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})},F=new WeakSet,We=function(i){const O=p(this,w);this.addCommands({cmd:()=>{pt(this,w,this.editorDiv.style.color=i)},undo:()=>{pt(this,w,this.editorDiv.style.color=O)},mustExec:!0,type:g.AnnotationEditorParamsType.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})},A=new WeakSet,He=function(){const i=this.editorDiv.getElementsByTagName("div");if(i.length===0)return this.editorDiv.innerText;const O=[];for(const X of i)O.push(X.innerText.replace(/\r\n?|\n/,""));return O.join(`
`)},l=new WeakSet,ve=function(){const[i,O]=this.parentDimensions;let X;if(this.isAttachedToDOM)X=this.div.getBoundingClientRect();else{const{currentLayer:Y,div:tt}=this,nt=tt.style.display;tt.style.display="hidden",Y.div.append(this.div),X=tt.getBoundingClientRect(),tt.remove(),tt.style.display=nt}this.width=X.width/i,this.height=X.height/O},Dt(n,"_freeTextDefaultContent",""),Dt(n,"_l10nPromise"),Dt(n,"_internalPadding",0),Dt(n,"_defaultColor",null),Dt(n,"_defaultFontSize",10),Dt(n,"_keyboardManager",new T.KeyboardManager([[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],n.prototype.commitOrRemove]])),Dt(n,"_type","freetext");let q=n;f.FreeTextEditor=q},(at,f,z)=>{var S,b,w,x,v,d,m,s,a,F,M,A,t,l,o,qe,u,Ge,i,Xe,X,Ve,tt,Se,ft,$e,ut,ze,yt,Ye,c,Gt,y,Ee,R,ae,H,oe,$,Yt,k,Ce,r,le,E,Te,N,Ke,Z,Je,rt,Qe,ct,xe,gt,ce,At,Kt,P,Pe;Object.defineProperty(f,"__esModule",{value:!0}),f.InkEditor=void 0,Object.defineProperty(f,"fitCurve",{enumerable:!0,get:function(){return V.fitCurve}});var g=z(1),T=z(4),V=z(30),q=z(5);const et=16,B=class B extends T.AnnotationEditor{constructor(J){super({...J,name:"inkEditor"});Q(this,o);Q(this,u);Q(this,i);Q(this,X);Q(this,tt);Q(this,ft);Q(this,ut);Q(this,yt);Q(this,c);Q(this,y);Q(this,R);Q(this,H);Q(this,$);Q(this,k);Q(this,r);Q(this,N);Q(this,Z);Q(this,rt);Q(this,ct);Q(this,gt);Q(this,At);Q(this,P);Q(this,S,0);Q(this,b,0);Q(this,w,0);Q(this,x,this.canvasPointermove.bind(this));Q(this,v,this.canvasPointerleave.bind(this));Q(this,d,this.canvasPointerup.bind(this));Q(this,m,this.canvasPointerdown.bind(this));Q(this,s,!1);Q(this,a,!1);Q(this,F,null);Q(this,M,null);Q(this,A,0);Q(this,t,0);Q(this,l,null);this.color=J.color||null,this.thickness=J.thickness||null,this.opacity=J.opacity||null,this.paths=[],this.bezierPath2D=[],this.currentPath=[],this.scaleFactor=1,this.translationX=this.translationY=0,this.x=0,this.y=0}static initialize(J){this._l10nPromise=new Map(["editor_ink_canvas_aria_label","editor_ink2_aria_label"].map(ht=>[ht,J.get(ht)]))}static updateDefaultParams(J,ht){switch(J){case g.AnnotationEditorParamsType.INK_THICKNESS:B._defaultThickness=ht;break;case g.AnnotationEditorParamsType.INK_COLOR:B._defaultColor=ht;break;case g.AnnotationEditorParamsType.INK_OPACITY:B._defaultOpacity=ht/100;break}}updateParams(J,ht){switch(J){case g.AnnotationEditorParamsType.INK_THICKNESS:ot(this,o,qe).call(this,ht);break;case g.AnnotationEditorParamsType.INK_COLOR:ot(this,u,Ge).call(this,ht);break;case g.AnnotationEditorParamsType.INK_OPACITY:ot(this,i,Xe).call(this,ht);break}}static get defaultPropertiesToUpdate(){return[[g.AnnotationEditorParamsType.INK_THICKNESS,B._defaultThickness],[g.AnnotationEditorParamsType.INK_COLOR,B._defaultColor||T.AnnotationEditor._defaultLineColor],[g.AnnotationEditorParamsType.INK_OPACITY,Math.round(B._defaultOpacity*100)]]}get propertiesToUpdate(){return[[g.AnnotationEditorParamsType.INK_THICKNESS,this.thickness||B._defaultThickness],[g.AnnotationEditorParamsType.INK_COLOR,this.color||B._defaultColor||T.AnnotationEditor._defaultLineColor],[g.AnnotationEditorParamsType.INK_OPACITY,Math.round(100*(this.opacity??B._defaultOpacity))]]}rebuild(){super.rebuild(),this.div!==null&&(this.canvas||(ot(this,R,ae).call(this),ot(this,H,oe).call(this)),this.isAttachedToDOM||(this.parent.add(this),ot(this,$,Yt).call(this)),ot(this,At,Kt).call(this))}remove(){this.canvas!==null&&(this.isEmpty()||this.commit(),this.canvas.width=this.canvas.height=0,this.canvas.remove(),this.canvas=null,p(this,M).disconnect(),pt(this,M,null),super.remove())}setParent(J){!this.parent&&J?this._uiManager.removeShouldRescale(this):this.parent&&J===null&&this._uiManager.addShouldRescale(this),super.setParent(J)}onScaleChanging(){const[J,ht]=this.parentDimensions,vt=this.width*J,St=this.height*ht;this.setDimensions(vt,St)}enableEditMode(){p(this,s)||this.canvas===null||(super.enableEditMode(),this.div.draggable=!1,this.canvas.addEventListener("pointerdown",p(this,m)),this.canvas.addEventListener("pointerup",p(this,d)))}disableEditMode(){!this.isInEditMode()||this.canvas===null||(super.disableEditMode(),this.div.draggable=!this.isEmpty(),this.div.classList.remove("editing"),this.canvas.removeEventListener("pointerdown",p(this,m)),this.canvas.removeEventListener("pointerup",p(this,d)))}onceAdded(){this.div.draggable=!this.isEmpty()}isEmpty(){return this.paths.length===0||this.paths.length===1&&this.paths[0].length===0}commit(){p(this,s)||(super.commit(),this.isEditing=!1,this.disableEditMode(),this.setInForeground(),pt(this,s,!0),this.div.classList.add("disabled"),ot(this,At,Kt).call(this,!0),this.parent.addInkEditorIfNeeded(!0),this.parent.moveEditorInDOM(this),this.div.focus({preventScroll:!0}))}focusin(J){super.focusin(J),this.enableEditMode()}canvasPointerdown(J){J.button!==0||!this.isInEditMode()||p(this,s)||(this.setInForeground(),J.type!=="mouse"&&this.div.focus(),J.stopPropagation(),this.canvas.addEventListener("pointerleave",p(this,v)),this.canvas.addEventListener("pointermove",p(this,x)),ot(this,ft,$e).call(this,J.offsetX,J.offsetY))}canvasPointermove(J){J.stopPropagation(),ot(this,ut,ze).call(this,J.offsetX,J.offsetY)}canvasPointerup(J){J.button===0&&this.isInEditMode()&&this.currentPath.length!==0&&(J.stopPropagation(),ot(this,y,Ee).call(this,J),this.setInBackground())}canvasPointerleave(J){ot(this,y,Ee).call(this,J),this.setInBackground()}render(){if(this.div)return this.div;let J,ht;this.width&&(J=this.x,ht=this.y),super.render(),B._l10nPromise.get("editor_ink2_aria_label").then(wt=>{var xt;return(xt=this.div)==null?void 0:xt.setAttribute("aria-label",wt)});const[vt,St,Ft,kt]=ot(this,X,Ve).call(this);if(this.setAt(vt,St,0,0),this.setDims(Ft,kt),ot(this,R,ae).call(this),this.width){const[wt,xt]=this.parentDimensions;this.setAt(J*wt,ht*xt,this.width*wt,this.height*xt),pt(this,a,!0),ot(this,$,Yt).call(this),this.setDims(this.width*wt,this.height*xt),ot(this,c,Gt).call(this),ot(this,P,Pe).call(this),this.div.classList.add("disabled")}else this.div.classList.add("editing"),this.enableEditMode();return ot(this,H,oe).call(this),this.div}setDimensions(J,ht){const vt=Math.round(J),St=Math.round(ht);if(p(this,A)===vt&&p(this,t)===St)return;pt(this,A,vt),pt(this,t,St),this.canvas.style.visibility="hidden",p(this,S)&&Math.abs(p(this,S)-J/ht)>.01&&(ht=Math.ceil(J/p(this,S)),this.setDims(J,ht));const[Ft,kt]=this.parentDimensions;this.width=J/Ft,this.height=ht/kt,p(this,s)&&ot(this,k,Ce).call(this,J,ht),ot(this,$,Yt).call(this),ot(this,c,Gt).call(this),this.canvas.style.visibility="visible",this.fixDims()}static deserialize(J,ht,vt){var Mt,Ot;const St=super.deserialize(J,ht,vt);St.thickness=J.thickness,St.color=g.Util.makeHexColor(...J.color),St.opacity=J.opacity;const[Ft,kt]=St.pageDimensions,wt=St.width*Ft,xt=St.height*kt,Rt=St.parentScale,Tt=J.thickness/2;pt(St,S,wt/xt),pt(St,s,!0),pt(St,A,Math.round(wt)),pt(St,t,Math.round(xt));for(const{bezier:Lt}of J.paths){const jt=[];St.paths.push(jt);let It=Rt*(Lt[0]-Tt),Bt=Rt*(xt-Lt[1]-Tt);for(let Ut=2,Zt=Lt.length;Ut<Zt;Ut+=6){const te=Rt*(Lt[Ut]-Tt),ee=Rt*(xt-Lt[Ut+1]-Tt),se=Rt*(Lt[Ut+2]-Tt),ne=Rt*(xt-Lt[Ut+3]-Tt),Fe=Rt*(Lt[Ut+4]-Tt),Re=Rt*(xt-Lt[Ut+5]-Tt);jt.push([[It,Bt],[te,ee],[se,ne],[Fe,Re]]),It=Fe,Bt=Re}const Ht=ot(this,E,Te).call(this,jt);St.bezierPath2D.push(Ht)}const Nt=ot(Mt=St,ct,xe).call(Mt);return pt(St,w,Math.max(et,Nt[2]-Nt[0])),pt(St,b,Math.max(et,Nt[3]-Nt[1])),ot(Ot=St,k,Ce).call(Ot,wt,xt),St}serialize(){if(this.isEmpty())return null;const J=this.getRect(0,0),ht=this.rotation%180===0?J[3]-J[1]:J[2]-J[0],vt=T.AnnotationEditor._colorManager.convert(this.ctx.strokeStyle);return{annotationType:g.AnnotationEditorType.INK,color:vt,thickness:this.thickness,opacity:this.opacity,paths:ot(this,N,Ke).call(this,this.scaleFactor/this.parentScale,this.translationX,this.translationY,ht),pageIndex:this.pageIndex,rect:J,rotation:this.rotation}}};S=new WeakMap,b=new WeakMap,w=new WeakMap,x=new WeakMap,v=new WeakMap,d=new WeakMap,m=new WeakMap,s=new WeakMap,a=new WeakMap,F=new WeakMap,M=new WeakMap,A=new WeakMap,t=new WeakMap,l=new WeakMap,o=new WeakSet,qe=function(J){const ht=this.thickness;this.addCommands({cmd:()=>{this.thickness=J,ot(this,At,Kt).call(this)},undo:()=>{this.thickness=ht,ot(this,At,Kt).call(this)},mustExec:!0,type:g.AnnotationEditorParamsType.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0})},u=new WeakSet,Ge=function(J){const ht=this.color;this.addCommands({cmd:()=>{this.color=J,ot(this,c,Gt).call(this)},undo:()=>{this.color=ht,ot(this,c,Gt).call(this)},mustExec:!0,type:g.AnnotationEditorParamsType.INK_COLOR,overwriteIfSameType:!0,keepUndo:!0})},i=new WeakSet,Xe=function(J){J/=100;const ht=this.opacity;this.addCommands({cmd:()=>{this.opacity=J,ot(this,c,Gt).call(this)},undo:()=>{this.opacity=ht,ot(this,c,Gt).call(this)},mustExec:!0,type:g.AnnotationEditorParamsType.INK_OPACITY,overwriteIfSameType:!0,keepUndo:!0})},X=new WeakSet,Ve=function(){const{parentRotation:J,parentDimensions:[ht,vt]}=this;switch(J){case 90:return[0,vt,vt,ht];case 180:return[ht,vt,ht,vt];case 270:return[ht,0,vt,ht];default:return[0,0,ht,vt]}},tt=new WeakSet,Se=function(){const{ctx:J,color:ht,opacity:vt,thickness:St,parentScale:Ft,scaleFactor:kt}=this;J.lineWidth=St*Ft/kt,J.lineCap="round",J.lineJoin="round",J.miterLimit=10,J.strokeStyle=`${ht}${(0,q.opacityToHex)(vt)}`},ft=new WeakSet,$e=function(J,ht){this.isEditing=!0,p(this,a)||(pt(this,a,!0),ot(this,$,Yt).call(this),this.thickness||(this.thickness=B._defaultThickness),this.color||(this.color=B._defaultColor||T.AnnotationEditor._defaultLineColor),this.opacity??(this.opacity=B._defaultOpacity)),this.currentPath.push([J,ht]),pt(this,F,null),ot(this,tt,Se).call(this),this.ctx.beginPath(),this.ctx.moveTo(J,ht),pt(this,l,()=>{p(this,l)&&(p(this,F)&&(this.isEmpty()?(this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)):ot(this,c,Gt).call(this),this.ctx.lineTo(...p(this,F)),pt(this,F,null),this.ctx.stroke()),window.requestAnimationFrame(p(this,l)))}),window.requestAnimationFrame(p(this,l))},ut=new WeakSet,ze=function(J,ht){const[vt,St]=this.currentPath.at(-1);J===vt&&ht===St||(this.currentPath.push([J,ht]),pt(this,F,[J,ht]))},yt=new WeakSet,Ye=function(J,ht){var Rt;this.ctx.closePath(),pt(this,l,null),J=Math.min(Math.max(J,0),this.canvas.width),ht=Math.min(Math.max(ht,0),this.canvas.height);const[vt,St]=this.currentPath.at(-1);(J!==vt||ht!==St)&&this.currentPath.push([J,ht]);let Ft;if(this.currentPath.length!==1)Ft=(0,V.fitCurve)(this.currentPath,30,null);else{const Tt=[J,ht];Ft=[[Tt,Tt.slice(),Tt.slice(),Tt]]}const kt=ot(Rt=B,E,Te).call(Rt,Ft);this.currentPath.length=0;const wt=()=>{this.paths.push(Ft),this.bezierPath2D.push(kt),this.rebuild()},xt=()=>{this.paths.pop(),this.bezierPath2D.pop(),this.paths.length===0?this.remove():(this.canvas||(ot(this,R,ae).call(this),ot(this,H,oe).call(this)),ot(this,At,Kt).call(this))};this.addCommands({cmd:wt,undo:xt,mustExec:!0})},c=new WeakSet,Gt=function(){if(this.isEmpty()){ot(this,r,le).call(this);return}ot(this,tt,Se).call(this);const{canvas:J,ctx:ht}=this;ht.setTransform(1,0,0,1,0,0),ht.clearRect(0,0,J.width,J.height),ot(this,r,le).call(this);for(const vt of this.bezierPath2D)ht.stroke(vt)},y=new WeakSet,Ee=function(J){ot(this,yt,Ye).call(this,J.offsetX,J.offsetY),this.canvas.removeEventListener("pointerleave",p(this,v)),this.canvas.removeEventListener("pointermove",p(this,x)),this.addToAnnotationStorage()},R=new WeakSet,ae=function(){this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=0,this.canvas.className="inkEditorCanvas",B._l10nPromise.get("editor_ink_canvas_aria_label").then(J=>{var ht;return(ht=this.canvas)==null?void 0:ht.setAttribute("aria-label",J)}),this.div.append(this.canvas),this.ctx=this.canvas.getContext("2d")},H=new WeakSet,oe=function(){pt(this,M,new ResizeObserver(J=>{const ht=J[0].contentRect;ht.width&&ht.height&&this.setDimensions(ht.width,ht.height)})),p(this,M).observe(this.div)},$=new WeakSet,Yt=function(){if(!p(this,a))return;const[J,ht]=this.parentDimensions;this.canvas.width=Math.ceil(this.width*J),this.canvas.height=Math.ceil(this.height*ht),ot(this,r,le).call(this)},k=new WeakSet,Ce=function(J,ht){const vt=ot(this,gt,ce).call(this),St=(J-vt)/p(this,w),Ft=(ht-vt)/p(this,b);this.scaleFactor=Math.min(St,Ft)},r=new WeakSet,le=function(){const J=ot(this,gt,ce).call(this)/2;this.ctx.setTransform(this.scaleFactor,0,0,this.scaleFactor,this.translationX*this.scaleFactor+J,this.translationY*this.scaleFactor+J)},E=new WeakSet,Te=function(J){const ht=new Path2D;for(let vt=0,St=J.length;vt<St;vt++){const[Ft,kt,wt,xt]=J[vt];vt===0&&ht.moveTo(...Ft),ht.bezierCurveTo(kt[0],kt[1],wt[0],wt[1],xt[0],xt[1])}return ht},N=new WeakSet,Ke=function(J,ht,vt,St){const kt=[],wt=this.thickness/2;let xt,Rt;for(const Tt of this.paths){xt=[],Rt=[];for(let Nt=0,Mt=Tt.length;Nt<Mt;Nt++){const[Ot,Lt,jt,It]=Tt[Nt],Bt=J*(Ot[0]+ht)+wt,Ht=St-J*(Ot[1]+vt)-wt,Ut=J*(Lt[0]+ht)+wt,Zt=St-J*(Lt[1]+vt)-wt,te=J*(jt[0]+ht)+wt,ee=St-J*(jt[1]+vt)-wt,se=J*(It[0]+ht)+wt,ne=St-J*(It[1]+vt)-wt;Nt===0&&(xt.push(Bt,Ht),Rt.push(Bt,Ht)),xt.push(Ut,Zt,te,ee,se,ne),ot(this,Z,Je).call(this,Bt,Ht,Ut,Zt,te,ee,se,ne,4,Rt)}kt.push({bezier:xt,points:Rt})}return kt},Z=new WeakSet,Je=function(J,ht,vt,St,Ft,kt,wt,xt,Rt,Tt){if(ot(this,rt,Qe).call(this,J,ht,vt,St,Ft,kt,wt,xt)){Tt.push(wt,xt);return}for(let Nt=1;Nt<Rt-1;Nt++){const Mt=Nt/Rt,Ot=1-Mt;let Lt=Mt*J+Ot*vt,jt=Mt*ht+Ot*St,It=Mt*vt+Ot*Ft,Bt=Mt*St+Ot*kt;const Ht=Mt*Ft+Ot*wt,Ut=Mt*kt+Ot*xt;Lt=Mt*Lt+Ot*It,jt=Mt*jt+Ot*Bt,It=Mt*It+Ot*Ht,Bt=Mt*Bt+Ot*Ut,Lt=Mt*Lt+Ot*It,jt=Mt*jt+Ot*Bt,Tt.push(Lt,jt)}Tt.push(wt,xt)},rt=new WeakSet,Qe=function(J,ht,vt,St,Ft,kt,wt,xt){const Tt=(3*vt-2*J-wt)**2,Nt=(3*St-2*ht-xt)**2,Mt=(3*Ft-J-2*wt)**2,Ot=(3*kt-ht-2*xt)**2;return Math.max(Tt,Mt)+Math.max(Nt,Ot)<=10},ct=new WeakSet,xe=function(){let J=1/0,ht=-1/0,vt=1/0,St=-1/0;for(const Ft of this.paths)for(const[kt,wt,xt,Rt]of Ft){const Tt=g.Util.bezierBoundingBox(...kt,...wt,...xt,...Rt);J=Math.min(J,Tt[0]),vt=Math.min(vt,Tt[1]),ht=Math.max(ht,Tt[2]),St=Math.max(St,Tt[3])}return[J,vt,ht,St]},gt=new WeakSet,ce=function(){return p(this,s)?Math.ceil(this.thickness*this.parentScale):0},At=new WeakSet,Kt=function(J=!1){if(this.isEmpty())return;if(!p(this,s)){ot(this,c,Gt).call(this);return}const ht=ot(this,ct,xe).call(this),vt=ot(this,gt,ce).call(this);pt(this,w,Math.max(et,ht[2]-ht[0])),pt(this,b,Math.max(et,ht[3]-ht[1]));const St=Math.ceil(vt+p(this,w)*this.scaleFactor),Ft=Math.ceil(vt+p(this,b)*this.scaleFactor),[kt,wt]=this.parentDimensions;this.width=St/kt,this.height=Ft/wt,pt(this,S,St/Ft),ot(this,P,Pe).call(this);const xt=this.translationX,Rt=this.translationY;this.translationX=-ht[0],this.translationY=-ht[1],ot(this,$,Yt).call(this),ot(this,c,Gt).call(this),pt(this,A,St),pt(this,t,Ft),this.setDims(St,Ft);const Tt=J?vt/this.scaleFactor/2:0;this.translate(xt-this.translationX-Tt,Rt-this.translationY-Tt)},P=new WeakSet,Pe=function(){const{style:J}=this.div;p(this,S)>=1?(J.minHeight=`${et}px`,J.minWidth=`${Math.round(p(this,S)*et)}px`):(J.minWidth=`${et}px`,J.minHeight=`${Math.round(et/p(this,S))}px`)},Q(B,E),Dt(B,"_defaultColor",null),Dt(B,"_defaultOpacity",1),Dt(B,"_defaultThickness",1),Dt(B,"_l10nPromise"),Dt(B,"_type","ink");let I=B;f.InkEditor=I},(at,f,z)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.fitCurve=void 0;const g=z(31);f.fitCurve=g},at=>{function f(d,m,s){if(!Array.isArray(d))throw new TypeError("First argument should be an array");if(d.forEach(A=>{if(!Array.isArray(A)||A.some(t=>typeof t!="number")||A.length!==d[0].length)throw Error("Each point should be an array of numbers. Each point should have the same amount of numbers.")}),d=d.filter((A,t)=>t===0||!A.every((l,o)=>l===d[t-1][o])),d.length<2)return[];const a=d.length,F=w(d[1],d[0]),M=w(d[a-2],d[a-1]);return z(d,F,M,m,s)}function z(d,m,s,a,F){var A,t,l,o,n,u,C,i,O,X,Y,tt,nt;if(d.length===2)return tt=x.vectorLen(x.subtract(d[0],d[1]))/3,A=[d[0],x.addArrays(d[0],x.mulItems(m,tt)),x.addArrays(d[1],x.mulItems(s,tt)),d[1]],[A];if(t=et(d),[A,o,u]=g(d,t,t,m,s,F),o===0||o<a)return[A];if(o<a*a)for(l=t,n=o,C=u,nt=0;nt<20;nt++){if(l=V(A,d,l),[A,o,u]=g(d,t,l,m,s,F),o<a)return[A];if(u===C){let ft=o/n;if(ft>.9999&&ft<1.0001)break}n=o,C=u}return Y=[],i=x.subtract(d[u-1],d[u+1]),i.every(ft=>ft===0)&&(i=x.subtract(d[u-1],d[u]),[i[0],i[1]]=[-i[1],i[0]]),O=x.normalize(i),X=x.mulItems(O,-1),Y=Y.concat(z(d.slice(0,u+1),m,O,a,F)),Y=Y.concat(z(d.slice(u),X,s,a,F)),Y}function g(d,m,s,a,F,M){var A,t,l;return A=T(d,s,a,F),[t,l]=I(d,A,m),M&&M({bez:A,points:d,params:m,maxErr:t,maxPoint:l}),[A,t,l]}function T(d,m,s,a){var F,M,A,t,l,o,n,u,C,i,O,X,Y,tt,nt,ft,lt,ut=d[0],bt=d[d.length-1];for(F=[ut,null,null,bt],M=x.zeros_Xx2x2(m.length),Y=0,tt=m.length;Y<tt;Y++)ft=m[Y],lt=1-ft,A=M[Y],A[0]=x.mulItems(s,3*ft*(lt*lt)),A[1]=x.mulItems(a,3*lt*(ft*ft));for(t=[[0,0],[0,0]],l=[0,0],Y=0,tt=d.length;Y<tt;Y++)ft=m[Y],A=M[Y],t[0][0]+=x.dot(A[0],A[0]),t[0][1]+=x.dot(A[0],A[1]),t[1][0]+=x.dot(A[0],A[1]),t[1][1]+=x.dot(A[1],A[1]),nt=x.subtract(d[Y],v.q([ut,ut,bt,bt],ft)),l[0]+=x.dot(A[0],nt),l[1]+=x.dot(A[1],nt);return o=t[0][0]*t[1][1]-t[1][0]*t[0][1],n=t[0][0]*l[1]-t[1][0]*l[0],u=l[0]*t[1][1]-l[1]*t[0][1],C=o===0?0:u/o,i=o===0?0:n/o,X=x.vectorLen(x.subtract(ut,bt)),O=1e-6*X,C<O||i<O?(F[1]=x.addArrays(ut,x.mulItems(s,X/3)),F[2]=x.addArrays(bt,x.mulItems(a,X/3))):(F[1]=x.addArrays(ut,x.mulItems(s,C)),F[2]=x.addArrays(bt,x.mulItems(a,i))),F}function V(d,m,s){return s.map((a,F)=>q(d,m[F],a))}function q(d,m,s){var a=x.subtract(v.q(d,s),m),F=v.qprime(d,s),M=x.mulMatrix(a,F),A=x.sum(x.squareItems(F))+2*x.mulMatrix(a,v.qprimeprime(d,s));return A===0?s:s-M/A}function et(d){var m=[],s,a,F;return d.forEach((M,A)=>{s=A?a+x.vectorLen(x.subtract(M,F)):0,m.push(s),a=s,F=M}),m=m.map(M=>M/a),m}function I(d,m,s){var a,F,M,A,t,l,o,n;F=0,M=Math.floor(d.length/2);const u=S(m,10);for(t=0,l=d.length;t<l;t++)o=d[t],n=b(m,s[t],u,10),A=x.subtract(v.q(m,n),o),a=A[0]*A[0]+A[1]*A[1],a>F&&(F=a,M=t);return[F,M]}var S=function(d,m){for(var s,a=[0],F=d[0],M=0,A=1;A<=m;A++)s=v.q(d,A/m),M+=x.vectorLen(x.subtract(s,F)),a.push(M),F=s;return a=a.map(t=>t/M),a};function b(d,m,s,a){if(m<0)return 0;if(m>1)return 1;for(var F,M,A,t,l,o=1;o<=a;o++)if(m<=s[o]){t=(o-1)/a,A=o/a,M=s[o-1],F=s[o],l=(m-M)/(F-M)*(A-t)+t;break}return l}function w(d,m){return x.normalize(x.subtract(d,m))}class x{static zeros_Xx2x2(m){for(var s=[];m--;)s.push([0,0]);return s}static mulItems(m,s){return m.map(a=>a*s)}static mulMatrix(m,s){return m.reduce((a,F,M)=>a+F*s[M],0)}static subtract(m,s){return m.map((a,F)=>a-s[F])}static addArrays(m,s){return m.map((a,F)=>a+s[F])}static addItems(m,s){return m.map(a=>a+s)}static sum(m){return m.reduce((s,a)=>s+a)}static dot(m,s){return x.mulMatrix(m,s)}static vectorLen(m){return Math.hypot(...m)}static divItems(m,s){return m.map(a=>a/s)}static squareItems(m){return m.map(s=>s*s)}static normalize(m){return this.divItems(m,this.vectorLen(m))}}class v{static q(m,s){var a=1-s,F=x.mulItems(m[0],a*a*a),M=x.mulItems(m[1],3*a*a*s),A=x.mulItems(m[2],3*a*s*s),t=x.mulItems(m[3],s*s*s);return x.addArrays(x.addArrays(F,M),x.addArrays(A,t))}static qprime(m,s){var a=1-s,F=x.mulItems(x.subtract(m[1],m[0]),3*a*a),M=x.mulItems(x.subtract(m[2],m[1]),6*a*s),A=x.mulItems(x.subtract(m[3],m[2]),3*s*s);return x.addArrays(x.addArrays(F,M),A)}static qprimeprime(m,s){return x.addArrays(x.mulItems(x.addArrays(x.subtract(m[2],x.mulItems(m[1],2)),m[0]),6*(1-s)),x.mulItems(x.addArrays(x.subtract(m[3],x.mulItems(m[2],2)),m[1]),6*s))}}at.exports=f,at.exports.fitCubic=z,at.exports.createTangent=w},(at,f,z)=>{var c,Vt,y,Ze,G,we,K,ke;Object.defineProperty(f,"__esModule",{value:!0}),f.AnnotationLayer=void 0;var g=z(1),T=z(6),V=z(3),q=z(33),et=z(34);const I=1e3,S=9,b=new WeakSet;function w(k){return{width:k[2]-k[0],height:k[3]-k[1]}}class x{static create(e){switch(e.data.annotationType){case g.AnnotationType.LINK:return new d(e);case g.AnnotationType.TEXT:return new m(e);case g.AnnotationType.WIDGET:switch(e.data.fieldType){case"Tx":return new a(e);case"Btn":return e.data.radioButton?new M(e):e.data.checkBox?new F(e):new A(e);case"Ch":return new t(e)}return new s(e);case g.AnnotationType.POPUP:return new l(e);case g.AnnotationType.FREETEXT:return new n(e);case g.AnnotationType.LINE:return new u(e);case g.AnnotationType.SQUARE:return new C(e);case g.AnnotationType.CIRCLE:return new i(e);case g.AnnotationType.POLYLINE:return new O(e);case g.AnnotationType.CARET:return new Y(e);case g.AnnotationType.INK:return new tt(e);case g.AnnotationType.POLYGON:return new X(e);case g.AnnotationType.HIGHLIGHT:return new nt(e);case g.AnnotationType.UNDERLINE:return new ft(e);case g.AnnotationType.SQUIGGLY:return new lt(e);case g.AnnotationType.STRIKEOUT:return new ut(e);case g.AnnotationType.STAMP:return new bt(e);case g.AnnotationType.FILEATTACHMENT:return new yt(e);default:return new v(e)}}}class v{constructor(e,{isRenderable:r=!1,ignoreBorder:_=!1,createQuadrilaterals:E=!1}={}){this.isRenderable=r,this.data=e.data,this.layer=e.layer,this.page=e.page,this.viewport=e.viewport,this.linkService=e.linkService,this.downloadManager=e.downloadManager,this.imageResourcesPath=e.imageResourcesPath,this.renderForms=e.renderForms,this.svgFactory=e.svgFactory,this.annotationStorage=e.annotationStorage,this.enableScripting=e.enableScripting,this.hasJSActions=e.hasJSActions,this._fieldObjects=e.fieldObjects,r&&(this.container=this._createContainer(_)),E&&(this.quadrilaterals=this._createQuadrilaterals(_))}_createContainer(e=!1){const{data:r,page:_,viewport:E}=this,D=document.createElement("section");D.setAttribute("data-annotation-id",r.id),r.noRotate&&D.classList.add("norotate");const{pageWidth:N,pageHeight:st,pageX:Z,pageY:it}=E.rawDims,{width:rt,height:dt}=w(r.rect),ct=g.Util.normalizeRect([r.rect[0],_.view[3]-r.rect[1]+_.view[1],r.rect[2],_.view[3]-r.rect[3]+_.view[1]]);if(!e&&r.borderStyle.width>0){D.style.borderWidth=`${r.borderStyle.width}px`;const gt=r.borderStyle.horizontalCornerRadius,Et=r.borderStyle.verticalCornerRadius;if(gt>0||Et>0){const Pt=`calc(${gt}px * var(--scale-factor)) / calc(${Et}px * var(--scale-factor))`;D.style.borderRadius=Pt}else if(this instanceof M){const Pt=`calc(${rt}px * var(--scale-factor)) / calc(${dt}px * var(--scale-factor))`;D.style.borderRadius=Pt}switch(r.borderStyle.style){case g.AnnotationBorderStyleType.SOLID:D.style.borderStyle="solid";break;case g.AnnotationBorderStyleType.DASHED:D.style.borderStyle="dashed";break;case g.AnnotationBorderStyleType.BEVELED:(0,g.warn)("Unimplemented border style: beveled");break;case g.AnnotationBorderStyleType.INSET:(0,g.warn)("Unimplemented border style: inset");break;case g.AnnotationBorderStyleType.UNDERLINE:D.style.borderBottomStyle="solid";break}const At=r.borderColor||null;At?D.style.borderColor=g.Util.makeHexColor(At[0]|0,At[1]|0,At[2]|0):D.style.borderWidth=0}D.style.left=`${100*(ct[0]-Z)/N}%`,D.style.top=`${100*(ct[1]-it)/st}%`;const{rotation:mt}=r;return r.hasOwnCanvas||mt===0?(D.style.width=`${100*rt/N}%`,D.style.height=`${100*dt/st}%`):this.setRotation(mt,D),D}setRotation(e,r=this.container){const{pageWidth:_,pageHeight:E}=this.viewport.rawDims,{width:D,height:N}=w(this.data.rect);let st,Z;e%180===0?(st=100*D/_,Z=100*N/E):(st=100*N/_,Z=100*D/E),r.style.width=`${st}%`,r.style.height=`${Z}%`,r.setAttribute("data-main-rotation",(360-e)%360)}get _commonActions(){const e=(r,_,E)=>{const D=E.detail[r];E.target.style[_]=q.ColorConverters[`${D[0]}_HTML`](D.slice(1))};return(0,g.shadow)(this,"_commonActions",{display:r=>{const _=r.detail.display%2===1;this.container.style.visibility=_?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{hidden:_,print:r.detail.display===0||r.detail.display===3})},print:r=>{this.annotationStorage.setValue(this.data.id,{print:r.detail.print})},hidden:r=>{this.container.style.visibility=r.detail.hidden?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{hidden:r.detail.hidden})},focus:r=>{setTimeout(()=>r.target.focus({preventScroll:!1}),0)},userName:r=>{r.target.title=r.detail.userName},readonly:r=>{r.detail.readonly?r.target.setAttribute("readonly",""):r.target.removeAttribute("readonly")},required:r=>{this._setRequired(r.target,r.detail.required)},bgColor:r=>{e("bgColor","backgroundColor",r)},fillColor:r=>{e("fillColor","backgroundColor",r)},fgColor:r=>{e("fgColor","color",r)},textColor:r=>{e("textColor","color",r)},borderColor:r=>{e("borderColor","borderColor",r)},strokeColor:r=>{e("strokeColor","borderColor",r)},rotation:r=>{const _=r.detail.rotation;this.setRotation(_),this.annotationStorage.setValue(this.data.id,{rotation:_})}})}_dispatchEventFromSandbox(e,r){const _=this._commonActions;for(const E of Object.keys(r.detail)){const D=e[E]||_[E];D==null||D(r)}}_setDefaultPropertiesFromJS(e){if(!this.enableScripting)return;const r=this.annotationStorage.getRawValue(this.data.id);if(!r)return;const _=this._commonActions;for(const[E,D]of Object.entries(r)){const N=_[E];if(N){const st={detail:{[E]:D},target:e};N(st),delete r[E]}}}_createQuadrilaterals(e=!1){if(!this.data.quadPoints)return null;const r=[],_=this.data.rect;for(const E of this.data.quadPoints)this.data.rect=[E[2].x,E[2].y,E[1].x,E[1].y],r.push(this._createContainer(e));return this.data.rect=_,r}_createPopup(e,r){let _=this.container;this.quadrilaterals&&(e=e||this.quadrilaterals,_=this.quadrilaterals[0]),e||(e=document.createElement("div"),e.classList.add("popupTriggerArea"),_.append(e));const D=new o({container:_,trigger:e,color:r.color,titleObj:r.titleObj,modificationDate:r.modificationDate,contentsObj:r.contentsObj,richText:r.richText,hideWrapper:!0}).render();D.style.left="100%",_.append(D)}_renderQuadrilaterals(e){for(const r of this.quadrilaterals)r.classList.add(e);return this.quadrilaterals}render(){(0,g.unreachable)("Abstract method `AnnotationElement.render` called")}_getElementsByName(e,r=null){const _=[];if(this._fieldObjects){const E=this._fieldObjects[e];if(E)for(const{page:D,id:N,exportValues:st}of E){if(D===-1||N===r)continue;const Z=typeof st=="string"?st:null,it=document.querySelector(`[data-element-id="${N}"]`);if(it&&!b.has(it)){(0,g.warn)(`_getElementsByName - element not allowed: ${N}`);continue}_.push({id:N,exportValue:Z,domElement:it})}return _}for(const E of document.getElementsByName(e)){const{exportValue:D}=E,N=E.getAttribute("data-element-id");N!==r&&b.has(E)&&_.push({id:N,exportValue:D,domElement:E})}return _}}class d extends v{constructor(r,_=null){super(r,{isRenderable:!0,ignoreBorder:!!(_!=null&&_.ignoreBorder),createQuadrilaterals:!0});Q(this,c);Q(this,y);this.isTooltipOnly=r.data.isTooltipOnly}render(){const{data:r,linkService:_}=this,E=document.createElement("a");E.setAttribute("data-element-id",r.id);let D=!1;return r.url?(_.addLinkAttributes(E,r.url,r.newWindow),D=!0):r.action?(this._bindNamedAction(E,r.action),D=!0):r.attachment?(this._bindAttachment(E,r.attachment),D=!0):r.setOCGState?(ot(this,y,Ze).call(this,E,r.setOCGState),D=!0):r.dest?(this._bindLink(E,r.dest),D=!0):(r.actions&&(r.actions.Action||r.actions["Mouse Up"]||r.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(E,r),D=!0),r.resetForm?(this._bindResetFormAction(E,r.resetForm),D=!0):this.isTooltipOnly&&!D&&(this._bindLink(E,""),D=!0)),this.quadrilaterals?this._renderQuadrilaterals("linkAnnotation").map((N,st)=>{const Z=st===0?E:E.cloneNode();return N.append(Z),N}):(this.container.classList.add("linkAnnotation"),D&&this.container.append(E),this.container)}_bindLink(r,_){r.href=this.linkService.getDestinationHash(_),r.onclick=()=>(_&&this.linkService.goToDestination(_),!1),(_||_==="")&&ot(this,c,Vt).call(this)}_bindNamedAction(r,_){r.href=this.linkService.getAnchorUrl(""),r.onclick=()=>(this.linkService.executeNamedAction(_),!1),ot(this,c,Vt).call(this)}_bindAttachment(r,_){r.href=this.linkService.getAnchorUrl(""),r.onclick=()=>{var E;return(E=this.downloadManager)==null||E.openOrDownloadData(this.container,_.content,_.filename),!1},ot(this,c,Vt).call(this)}_bindJSAction(r,_){r.href=this.linkService.getAnchorUrl("");const E=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const D of Object.keys(_.actions)){const N=E.get(D);N&&(r[N]=()=>{var st;return(st=this.linkService.eventBus)==null||st.dispatch("dispatcheventinsandbox",{source:this,detail:{id:_.id,name:D}}),!1})}r.onclick||(r.onclick=()=>!1),ot(this,c,Vt).call(this)}_bindResetFormAction(r,_){const E=r.onclick;if(E||(r.href=this.linkService.getAnchorUrl("")),ot(this,c,Vt).call(this),!this._fieldObjects){(0,g.warn)('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),E||(r.onclick=()=>!1);return}r.onclick=()=>{var dt;E==null||E();const{fields:D,refs:N,include:st}=_,Z=[];if(D.length!==0||N.length!==0){const ct=new Set(N);for(const mt of D){const gt=this._fieldObjects[mt]||[];for(const{id:Et}of gt)ct.add(Et)}for(const mt of Object.values(this._fieldObjects))for(const gt of mt)ct.has(gt.id)===st&&Z.push(gt)}else for(const ct of Object.values(this._fieldObjects))Z.push(...ct);const it=this.annotationStorage,rt=[];for(const ct of Z){const{id:mt}=ct;switch(rt.push(mt),ct.type){case"text":{const Et=ct.defaultValue||"";it.setValue(mt,{value:Et});break}case"checkbox":case"radiobutton":{const Et=ct.defaultValue===ct.exportValues;it.setValue(mt,{value:Et});break}case"combobox":case"listbox":{const Et=ct.defaultValue||"";it.setValue(mt,{value:Et});break}default:continue}const gt=document.querySelector(`[data-element-id="${mt}"]`);if(gt){if(!b.has(gt)){(0,g.warn)(`_bindResetFormAction - element not allowed: ${mt}`);continue}}else continue;gt.dispatchEvent(new Event("resetform"))}return this.enableScripting&&((dt=this.linkService.eventBus)==null||dt.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:rt,name:"ResetForm"}})),!1}}}c=new WeakSet,Vt=function(){this.container.setAttribute("data-internal-link","")},y=new WeakSet,Ze=function(r,_){r.href=this.linkService.getAnchorUrl(""),r.onclick=()=>(this.linkService.executeSetOCGState(_),!1),ot(this,c,Vt).call(this)};class m extends v{constructor(e){var _,E,D;const r=!!(e.data.hasPopup||(_=e.data.titleObj)!=null&&_.str||(E=e.data.contentsObj)!=null&&E.str||(D=e.data.richText)!=null&&D.str);super(e,{isRenderable:r})}render(){this.container.classList.add("textAnnotation");const e=document.createElement("img");return e.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",e.alt="[{{type}} Annotation]",e.dataset.l10nId="text_annotation_type",e.dataset.l10nArgs=JSON.stringify({type:this.data.name}),this.data.hasPopup||this._createPopup(e,this.data),this.container.append(e),this.container}}class s extends v{render(){return this.data.alternativeText&&(this.container.title=this.data.alternativeText),this.container}_getKeyModifier(e){const{isWin:r,isMac:_}=g.FeatureTest.platform;return r&&e.ctrlKey||_&&e.metaKey}_setEventListener(e,r,_,E){r.includes("mouse")?e.addEventListener(r,D=>{var N;(N=this.linkService.eventBus)==null||N.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:_,value:E(D),shift:D.shiftKey,modifier:this._getKeyModifier(D)}})}):e.addEventListener(r,D=>{var N;(N=this.linkService.eventBus)==null||N.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:_,value:E(D)}})})}_setEventListeners(e,r,_){var E;for(const[D,N]of r)(N==="Action"||(E=this.data.actions)!=null&&E[N])&&this._setEventListener(e,D,N,_)}_setBackgroundColor(e){const r=this.data.backgroundColor||null;e.style.backgroundColor=r===null?"transparent":g.Util.makeHexColor(r[0],r[1],r[2])}_setTextStyle(e){const r=["left","center","right"],{fontColor:_}=this.data.defaultAppearanceData,E=this.data.defaultAppearanceData.fontSize||S,D=e.style;let N;const st=2,Z=it=>Math.round(10*it)/10;if(this.data.multiLine){const it=Math.abs(this.data.rect[3]-this.data.rect[1]-st),rt=Math.round(it/(g.LINE_FACTOR*E))||1,dt=it/rt;N=Math.min(E,Z(dt/g.LINE_FACTOR))}else{const it=Math.abs(this.data.rect[3]-this.data.rect[1]-st);N=Math.min(E,Z(it/g.LINE_FACTOR))}D.fontSize=`calc(${N}px * var(--scale-factor))`,D.color=g.Util.makeHexColor(_[0],_[1],_[2]),this.data.textAlignment!==null&&(D.textAlign=r[this.data.textAlignment])}_setRequired(e,r){r?e.setAttribute("required",!0):e.removeAttribute("required"),e.setAttribute("aria-required",r)}}class a extends s{constructor(e){const r=e.renderForms||!e.data.hasAppearance&&!!e.data.fieldValue;super(e,{isRenderable:r})}setPropertyOnSiblings(e,r,_,E){const D=this.annotationStorage;for(const N of this._getElementsByName(e.name,e.id))N.domElement&&(N.domElement[r]=_),D.setValue(N.id,{[E]:_})}render(){var E;const e=this.annotationStorage,r=this.data.id;this.container.classList.add("textWidgetAnnotation");let _=null;if(this.renderForms){const D=e.getValue(r,{value:this.data.fieldValue});let N=D.formattedValue||D.value||"";const st=e.getValue(r,{charLimit:this.data.maxLen}).charLimit;st&&N.length>st&&(N=N.slice(0,st));const Z={userValue:N,formattedValue:null,lastCommittedValue:null,commitKey:1};this.data.multiLine?(_=document.createElement("textarea"),_.textContent=N,this.data.doNotScroll&&(_.style.overflowY="hidden")):(_=document.createElement("input"),_.type="text",_.setAttribute("value",N),this.data.doNotScroll&&(_.style.overflowX="hidden")),b.add(_),_.setAttribute("data-element-id",r),_.disabled=this.data.readOnly,_.name=this.data.fieldName,_.tabIndex=I,this._setRequired(_,this.data.required),st&&(_.maxLength=st),_.addEventListener("input",rt=>{e.setValue(r,{value:rt.target.value}),this.setPropertyOnSiblings(_,"value",rt.target.value,"value")}),_.addEventListener("resetform",rt=>{const dt=this.data.defaultFieldValue??"";_.value=Z.userValue=dt,Z.formattedValue=null});let it=rt=>{const{formattedValue:dt}=Z;dt!=null&&(rt.target.value=dt),rt.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){_.addEventListener("focus",dt=>{const{target:ct}=dt;Z.userValue&&(ct.value=Z.userValue),Z.lastCommittedValue=ct.value,Z.commitKey=1}),_.addEventListener("updatefromsandbox",dt=>{const ct={value(mt){Z.userValue=mt.detail.value??"",e.setValue(r,{value:Z.userValue.toString()}),mt.target.value=Z.userValue},formattedValue(mt){const{formattedValue:gt}=mt.detail;Z.formattedValue=gt,gt!=null&&mt.target!==document.activeElement&&(mt.target.value=gt),e.setValue(r,{formattedValue:gt})},selRange(mt){mt.target.setSelectionRange(...mt.detail.selRange)},charLimit:mt=>{var Pt;const{charLimit:gt}=mt.detail,{target:Et}=mt;if(gt===0){Et.removeAttribute("maxLength");return}Et.setAttribute("maxLength",gt);let At=Z.userValue;!At||At.length<=gt||(At=At.slice(0,gt),Et.value=Z.userValue=At,e.setValue(r,{value:At}),(Pt=this.linkService.eventBus)==null||Pt.dispatch("dispatcheventinsandbox",{source:this,detail:{id:r,name:"Keystroke",value:At,willCommit:!0,commitKey:1,selStart:Et.selectionStart,selEnd:Et.selectionEnd}}))}};this._dispatchEventFromSandbox(ct,dt)}),_.addEventListener("keydown",dt=>{var gt;Z.commitKey=1;let ct=-1;if(dt.key==="Escape"?ct=0:dt.key==="Enter"&&!this.data.multiLine?ct=2:dt.key==="Tab"&&(Z.commitKey=3),ct===-1)return;const{value:mt}=dt.target;Z.lastCommittedValue!==mt&&(Z.lastCommittedValue=mt,Z.userValue=mt,(gt=this.linkService.eventBus)==null||gt.dispatch("dispatcheventinsandbox",{source:this,detail:{id:r,name:"Keystroke",value:mt,willCommit:!0,commitKey:ct,selStart:dt.target.selectionStart,selEnd:dt.target.selectionEnd}}))});const rt=it;it=null,_.addEventListener("blur",dt=>{var mt;if(!dt.relatedTarget)return;const{value:ct}=dt.target;Z.userValue=ct,Z.lastCommittedValue!==ct&&((mt=this.linkService.eventBus)==null||mt.dispatch("dispatcheventinsandbox",{source:this,detail:{id:r,name:"Keystroke",value:ct,willCommit:!0,commitKey:Z.commitKey,selStart:dt.target.selectionStart,selEnd:dt.target.selectionEnd}})),rt(dt)}),(E=this.data.actions)!=null&&E.Keystroke&&_.addEventListener("beforeinput",dt=>{var U;Z.lastCommittedValue=null;const{data:ct,target:mt}=dt,{value:gt,selectionStart:Et,selectionEnd:At}=mt;let Pt=Et,P=At;switch(dt.inputType){case"deleteWordBackward":{const B=gt.substring(0,Et).match(/\w*[^\w]*$/);B&&(Pt-=B[0].length);break}case"deleteWordForward":{const B=gt.substring(Et).match(/^[^\w]*\w*/);B&&(P+=B[0].length);break}case"deleteContentBackward":Et===At&&(Pt-=1);break;case"deleteContentForward":Et===At&&(P+=1);break}dt.preventDefault(),(U=this.linkService.eventBus)==null||U.dispatch("dispatcheventinsandbox",{source:this,detail:{id:r,name:"Keystroke",value:gt,change:ct||"",willCommit:!1,selStart:Pt,selEnd:P}})}),this._setEventListeners(_,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],dt=>dt.target.value)}if(it&&_.addEventListener("blur",it),this.data.comb){const dt=(this.data.rect[2]-this.data.rect[0])/st;_.classList.add("comb"),_.style.letterSpacing=`calc(${dt}px * var(--scale-factor) - 1ch)`}}else _=document.createElement("div"),_.textContent=this.data.fieldValue,_.style.verticalAlign="middle",_.style.display="table-cell";return this._setTextStyle(_),this._setBackgroundColor(_),this._setDefaultPropertiesFromJS(_),this.container.append(_),this.container}}class F extends s{constructor(e){super(e,{isRenderable:e.renderForms})}render(){const e=this.annotationStorage,r=this.data,_=r.id;let E=e.getValue(_,{value:r.exportValue===r.fieldValue}).value;typeof E=="string"&&(E=E!=="Off",e.setValue(_,{value:E})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const D=document.createElement("input");return b.add(D),D.setAttribute("data-element-id",_),D.disabled=r.readOnly,this._setRequired(D,this.data.required),D.type="checkbox",D.name=r.fieldName,E&&D.setAttribute("checked",!0),D.setAttribute("exportValue",r.exportValue),D.tabIndex=I,D.addEventListener("change",N=>{const{name:st,checked:Z}=N.target;for(const it of this._getElementsByName(st,_)){const rt=Z&&it.exportValue===r.exportValue;it.domElement&&(it.domElement.checked=rt),e.setValue(it.id,{value:rt})}e.setValue(_,{value:Z})}),D.addEventListener("resetform",N=>{const st=r.defaultFieldValue||"Off";N.target.checked=st===r.exportValue}),this.enableScripting&&this.hasJSActions&&(D.addEventListener("updatefromsandbox",N=>{const st={value(Z){Z.target.checked=Z.detail.value!=="Off",e.setValue(_,{value:Z.target.checked})}};this._dispatchEventFromSandbox(st,N)}),this._setEventListeners(D,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],N=>N.target.checked)),this._setBackgroundColor(D),this._setDefaultPropertiesFromJS(D),this.container.append(D),this.container}}class M extends s{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const e=this.annotationStorage,r=this.data,_=r.id;let E=e.getValue(_,{value:r.fieldValue===r.buttonValue}).value;typeof E=="string"&&(E=E!==r.buttonValue,e.setValue(_,{value:E}));const D=document.createElement("input");if(b.add(D),D.setAttribute("data-element-id",_),D.disabled=r.readOnly,this._setRequired(D,this.data.required),D.type="radio",D.name=r.fieldName,E&&D.setAttribute("checked",!0),D.tabIndex=I,D.addEventListener("change",N=>{const{name:st,checked:Z}=N.target;for(const it of this._getElementsByName(st,_))e.setValue(it.id,{value:!1});e.setValue(_,{value:Z})}),D.addEventListener("resetform",N=>{const st=r.defaultFieldValue;N.target.checked=st!=null&&st===r.buttonValue}),this.enableScripting&&this.hasJSActions){const N=r.buttonValue;D.addEventListener("updatefromsandbox",st=>{const Z={value:it=>{const rt=N===it.detail.value;for(const dt of this._getElementsByName(it.target.name)){const ct=rt&&dt.id===_;dt.domElement&&(dt.domElement.checked=ct),e.setValue(dt.id,{value:ct})}}};this._dispatchEventFromSandbox(Z,st)}),this._setEventListeners(D,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],st=>st.target.checked)}return this._setBackgroundColor(D),this._setDefaultPropertiesFromJS(D),this.container.append(D),this.container}}class A extends d{constructor(e){super(e,{ignoreBorder:e.data.hasAppearance})}render(){const e=super.render();e.classList.add("buttonWidgetAnnotation","pushButton"),this.data.alternativeText&&(e.title=this.data.alternativeText);const r=e.lastChild;return this.enableScripting&&this.hasJSActions&&r&&(this._setDefaultPropertiesFromJS(r),r.addEventListener("updatefromsandbox",_=>{this._dispatchEventFromSandbox({},_)})),e}}class t extends s{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const e=this.annotationStorage,r=this.data.id,_=e.getValue(r,{value:this.data.fieldValue}),E=document.createElement("select");b.add(E),E.setAttribute("data-element-id",r),E.disabled=this.data.readOnly,this._setRequired(E,this.data.required),E.name=this.data.fieldName,E.tabIndex=I;let D=this.data.combo&&this.data.options.length>0;this.data.combo||(E.size=this.data.options.length,this.data.multiSelect&&(E.multiple=!0)),E.addEventListener("resetform",rt=>{const dt=this.data.defaultFieldValue;for(const ct of E.options)ct.selected=ct.value===dt});for(const rt of this.data.options){const dt=document.createElement("option");dt.textContent=rt.displayValue,dt.value=rt.exportValue,_.value.includes(rt.exportValue)&&(dt.setAttribute("selected",!0),D=!1),E.append(dt)}let N=null;if(D){const rt=document.createElement("option");rt.value=" ",rt.setAttribute("hidden",!0),rt.setAttribute("selected",!0),E.prepend(rt),N=()=>{rt.remove(),E.removeEventListener("input",N),N=null},E.addEventListener("input",N)}const st=rt=>{const dt=rt?"value":"textContent",{options:ct,multiple:mt}=E;return mt?Array.prototype.filter.call(ct,gt=>gt.selected).map(gt=>gt[dt]):ct.selectedIndex===-1?null:ct[ct.selectedIndex][dt]};let Z=st(!1);const it=rt=>{const dt=rt.target.options;return Array.prototype.map.call(dt,ct=>({displayValue:ct.textContent,exportValue:ct.value}))};return this.enableScripting&&this.hasJSActions?(E.addEventListener("updatefromsandbox",rt=>{const dt={value(ct){N==null||N();const mt=ct.detail.value,gt=new Set(Array.isArray(mt)?mt:[mt]);for(const Et of E.options)Et.selected=gt.has(Et.value);e.setValue(r,{value:st(!0)}),Z=st(!1)},multipleSelection(ct){E.multiple=!0},remove(ct){const mt=E.options,gt=ct.detail.remove;mt[gt].selected=!1,E.remove(gt),mt.length>0&&Array.prototype.findIndex.call(mt,At=>At.selected)===-1&&(mt[0].selected=!0),e.setValue(r,{value:st(!0),items:it(ct)}),Z=st(!1)},clear(ct){for(;E.length!==0;)E.remove(0);e.setValue(r,{value:null,items:[]}),Z=st(!1)},insert(ct){const{index:mt,displayValue:gt,exportValue:Et}=ct.detail.insert,At=E.children[mt],Pt=document.createElement("option");Pt.textContent=gt,Pt.value=Et,At?At.before(Pt):E.append(Pt),e.setValue(r,{value:st(!0),items:it(ct)}),Z=st(!1)},items(ct){const{items:mt}=ct.detail;for(;E.length!==0;)E.remove(0);for(const gt of mt){const{displayValue:Et,exportValue:At}=gt,Pt=document.createElement("option");Pt.textContent=Et,Pt.value=At,E.append(Pt)}E.options.length>0&&(E.options[0].selected=!0),e.setValue(r,{value:st(!0),items:it(ct)}),Z=st(!1)},indices(ct){const mt=new Set(ct.detail.indices);for(const gt of ct.target.options)gt.selected=mt.has(gt.index);e.setValue(r,{value:st(!0)}),Z=st(!1)},editable(ct){ct.target.disabled=!ct.detail.editable}};this._dispatchEventFromSandbox(dt,rt)}),E.addEventListener("input",rt=>{var ct;const dt=st(!0);e.setValue(r,{value:dt}),rt.preventDefault(),(ct=this.linkService.eventBus)==null||ct.dispatch("dispatcheventinsandbox",{source:this,detail:{id:r,name:"Keystroke",value:Z,changeEx:dt,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(E,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],rt=>rt.target.value)):E.addEventListener("input",function(rt){e.setValue(r,{value:st(!0)})}),this.data.combo&&this._setTextStyle(E),this._setBackgroundColor(E),this._setDefaultPropertiesFromJS(E),this.container.append(E),this.container}}const R=class R extends v{constructor(e){var E,D,N;const{data:r}=e,_=!R.IGNORE_TYPES.has(r.parentType)&&!!((E=r.titleObj)!=null&&E.str||(D=r.contentsObj)!=null&&D.str||(N=r.richText)!=null&&N.str);super(e,{isRenderable:_})}render(){this.container.classList.add("popupAnnotation");const e=this.layer.querySelectorAll(`[data-annotation-id="${this.data.parentId}"]`);if(e.length===0)return this.container;const r=new o({container:this.container,trigger:Array.from(e),color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText}),_=this.page,E=g.Util.normalizeRect([this.data.parentRect[0],_.view[3]-this.data.parentRect[1]+_.view[1],this.data.parentRect[2],_.view[3]-this.data.parentRect[3]+_.view[1]]),D=E[0]+this.data.parentRect[2]-this.data.parentRect[0],N=E[1],{pageWidth:st,pageHeight:Z,pageX:it,pageY:rt}=this.viewport.rawDims;return this.container.style.left=`${100*(D-it)/st}%`,this.container.style.top=`${100*(N-rt)/Z}%`,this.container.append(r.render()),this.container}};Dt(R,"IGNORE_TYPES",new Set(["Line","Square","Circle","PolyLine","Polygon","Ink"]));let l=R;class o{constructor(e){this.container=e.container,this.trigger=e.trigger,this.color=e.color,this.titleObj=e.titleObj,this.modificationDate=e.modificationDate,this.contentsObj=e.contentsObj,this.richText=e.richText,this.hideWrapper=e.hideWrapper||!1,this.pinned=!1}render(){var st,Z;const r=document.createElement("div");r.classList.add("popupWrapper"),this.hideElement=this.hideWrapper?r:this.container,this.hideElement.hidden=!0;const _=document.createElement("div");_.classList.add("popup");const E=this.color;if(E){const it=.7*(255-E[0])+E[0],rt=.7*(255-E[1])+E[1],dt=.7*(255-E[2])+E[2];_.style.backgroundColor=g.Util.makeHexColor(it|0,rt|0,dt|0)}const D=document.createElement("h1");D.dir=this.titleObj.dir,D.textContent=this.titleObj.str,_.append(D);const N=T.PDFDateString.toDateObject(this.modificationDate);if(N){const it=document.createElement("span");it.classList.add("popupDate"),it.textContent="{{date}}, {{time}}",it.dataset.l10nId="annotation_date_string",it.dataset.l10nArgs=JSON.stringify({date:N.toLocaleDateString(),time:N.toLocaleTimeString()}),_.append(it)}if((st=this.richText)!=null&&st.str&&(!((Z=this.contentsObj)!=null&&Z.str)||this.contentsObj.str===this.richText.str))et.XfaLayer.render({xfaHtml:this.richText.html,intent:"richText",div:_}),_.lastChild.classList.add("richText","popupContent");else{const it=this._formatContents(this.contentsObj);_.append(it)}Array.isArray(this.trigger)||(this.trigger=[this.trigger]);for(const it of this.trigger)it.addEventListener("click",this._toggle.bind(this)),it.addEventListener("mouseover",this._show.bind(this,!1)),it.addEventListener("mouseout",this._hide.bind(this,!1));return _.addEventListener("click",this._hide.bind(this,!0)),r.append(_),r}_formatContents({str:e,dir:r}){const _=document.createElement("p");_.classList.add("popupContent"),_.dir=r;const E=e.split(/(?:\r\n?|\n)/);for(let D=0,N=E.length;D<N;++D){const st=E[D];_.append(document.createTextNode(st)),D<N-1&&_.append(document.createElement("br"))}return _}_toggle(){this.pinned?this._hide(!0):this._show(!0)}_show(e=!1){e&&(this.pinned=!0),this.hideElement.hidden&&(this.hideElement.hidden=!1,this.container.style.zIndex=parseInt(this.container.style.zIndex)+1e3)}_hide(e=!0){e&&(this.pinned=!1),!this.hideElement.hidden&&!this.pinned&&(this.hideElement.hidden=!0,this.container.style.zIndex=parseInt(this.container.style.zIndex)-1e3)}}class n extends v{constructor(e){var _,E,D;const r=!!(e.data.hasPopup||(_=e.data.titleObj)!=null&&_.str||(E=e.data.contentsObj)!=null&&E.str||(D=e.data.richText)!=null&&D.str);super(e,{isRenderable:r,ignoreBorder:!0}),this.textContent=e.data.textContent}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const e=document.createElement("div");e.classList.add("annotationTextContent"),e.setAttribute("role","comment");for(const r of this.textContent){const _=document.createElement("span");_.textContent=r,e.append(_)}this.container.append(e)}return this.data.hasPopup||this._createPopup(null,this.data),this.container}}class u extends v{constructor(e){var _,E,D;const r=!!(e.data.hasPopup||(_=e.data.titleObj)!=null&&_.str||(E=e.data.contentsObj)!=null&&E.str||(D=e.data.richText)!=null&&D.str);super(e,{isRenderable:r,ignoreBorder:!0})}render(){this.container.classList.add("lineAnnotation");const e=this.data,{width:r,height:_}=w(e.rect),E=this.svgFactory.create(r,_,!0),D=this.svgFactory.createElement("svg:line");return D.setAttribute("x1",e.rect[2]-e.lineCoordinates[0]),D.setAttribute("y1",e.rect[3]-e.lineCoordinates[1]),D.setAttribute("x2",e.rect[2]-e.lineCoordinates[2]),D.setAttribute("y2",e.rect[3]-e.lineCoordinates[3]),D.setAttribute("stroke-width",e.borderStyle.width||1),D.setAttribute("stroke","transparent"),D.setAttribute("fill","transparent"),E.append(D),this.container.append(E),this._createPopup(D,e),this.container}}class C extends v{constructor(e){var _,E,D;const r=!!(e.data.hasPopup||(_=e.data.titleObj)!=null&&_.str||(E=e.data.contentsObj)!=null&&E.str||(D=e.data.richText)!=null&&D.str);super(e,{isRenderable:r,ignoreBorder:!0})}render(){this.container.classList.add("squareAnnotation");const e=this.data,{width:r,height:_}=w(e.rect),E=this.svgFactory.create(r,_,!0),D=e.borderStyle.width,N=this.svgFactory.createElement("svg:rect");return N.setAttribute("x",D/2),N.setAttribute("y",D/2),N.setAttribute("width",r-D),N.setAttribute("height",_-D),N.setAttribute("stroke-width",D||1),N.setAttribute("stroke","transparent"),N.setAttribute("fill","transparent"),E.append(N),this.container.append(E),this._createPopup(N,e),this.container}}class i extends v{constructor(e){var _,E,D;const r=!!(e.data.hasPopup||(_=e.data.titleObj)!=null&&_.str||(E=e.data.contentsObj)!=null&&E.str||(D=e.data.richText)!=null&&D.str);super(e,{isRenderable:r,ignoreBorder:!0})}render(){this.container.classList.add("circleAnnotation");const e=this.data,{width:r,height:_}=w(e.rect),E=this.svgFactory.create(r,_,!0),D=e.borderStyle.width,N=this.svgFactory.createElement("svg:ellipse");return N.setAttribute("cx",r/2),N.setAttribute("cy",_/2),N.setAttribute("rx",r/2-D/2),N.setAttribute("ry",_/2-D/2),N.setAttribute("stroke-width",D||1),N.setAttribute("stroke","transparent"),N.setAttribute("fill","transparent"),E.append(N),this.container.append(E),this._createPopup(N,e),this.container}}class O extends v{constructor(e){var _,E,D;const r=!!(e.data.hasPopup||(_=e.data.titleObj)!=null&&_.str||(E=e.data.contentsObj)!=null&&E.str||(D=e.data.richText)!=null&&D.str);super(e,{isRenderable:r,ignoreBorder:!0}),this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const e=this.data,{width:r,height:_}=w(e.rect),E=this.svgFactory.create(r,_,!0);let D=[];for(const st of e.vertices){const Z=st.x-e.rect[0],it=e.rect[3]-st.y;D.push(Z+","+it)}D=D.join(" ");const N=this.svgFactory.createElement(this.svgElementName);return N.setAttribute("points",D),N.setAttribute("stroke-width",e.borderStyle.width||1),N.setAttribute("stroke","transparent"),N.setAttribute("fill","transparent"),E.append(N),this.container.append(E),this._createPopup(N,e),this.container}}class X extends O{constructor(e){super(e),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class Y extends v{constructor(e){var _,E,D;const r=!!(e.data.hasPopup||(_=e.data.titleObj)!=null&&_.str||(E=e.data.contentsObj)!=null&&E.str||(D=e.data.richText)!=null&&D.str);super(e,{isRenderable:r,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),this.data.hasPopup||this._createPopup(null,this.data),this.container}}class tt extends v{constructor(e){var _,E,D;const r=!!(e.data.hasPopup||(_=e.data.titleObj)!=null&&_.str||(E=e.data.contentsObj)!=null&&E.str||(D=e.data.richText)!=null&&D.str);super(e,{isRenderable:r,ignoreBorder:!0}),this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const e=this.data,{width:r,height:_}=w(e.rect),E=this.svgFactory.create(r,_,!0);for(const D of e.inkLists){let N=[];for(const Z of D){const it=Z.x-e.rect[0],rt=e.rect[3]-Z.y;N.push(`${it},${rt}`)}N=N.join(" ");const st=this.svgFactory.createElement(this.svgElementName);st.setAttribute("points",N),st.setAttribute("stroke-width",e.borderStyle.width||1),st.setAttribute("stroke","transparent"),st.setAttribute("fill","transparent"),this._createPopup(st,e),E.append(st)}return this.container.append(E),this.container}}class nt extends v{constructor(e){var _,E,D;const r=!!(e.data.hasPopup||(_=e.data.titleObj)!=null&&_.str||(E=e.data.contentsObj)!=null&&E.str||(D=e.data.richText)!=null&&D.str);super(e,{isRenderable:r,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.hasPopup||this._createPopup(null,this.data),this.quadrilaterals?this._renderQuadrilaterals("highlightAnnotation"):(this.container.classList.add("highlightAnnotation"),this.container)}}class ft extends v{constructor(e){var _,E,D;const r=!!(e.data.hasPopup||(_=e.data.titleObj)!=null&&_.str||(E=e.data.contentsObj)!=null&&E.str||(D=e.data.richText)!=null&&D.str);super(e,{isRenderable:r,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.hasPopup||this._createPopup(null,this.data),this.quadrilaterals?this._renderQuadrilaterals("underlineAnnotation"):(this.container.classList.add("underlineAnnotation"),this.container)}}class lt extends v{constructor(e){var _,E,D;const r=!!(e.data.hasPopup||(_=e.data.titleObj)!=null&&_.str||(E=e.data.contentsObj)!=null&&E.str||(D=e.data.richText)!=null&&D.str);super(e,{isRenderable:r,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.hasPopup||this._createPopup(null,this.data),this.quadrilaterals?this._renderQuadrilaterals("squigglyAnnotation"):(this.container.classList.add("squigglyAnnotation"),this.container)}}class ut extends v{constructor(e){var _,E,D;const r=!!(e.data.hasPopup||(_=e.data.titleObj)!=null&&_.str||(E=e.data.contentsObj)!=null&&E.str||(D=e.data.richText)!=null&&D.str);super(e,{isRenderable:r,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.hasPopup||this._createPopup(null,this.data),this.quadrilaterals?this._renderQuadrilaterals("strikeoutAnnotation"):(this.container.classList.add("strikeoutAnnotation"),this.container)}}class bt extends v{constructor(e){var _,E,D;const r=!!(e.data.hasPopup||(_=e.data.titleObj)!=null&&_.str||(E=e.data.contentsObj)!=null&&E.str||(D=e.data.richText)!=null&&D.str);super(e,{isRenderable:r,ignoreBorder:!0})}render(){return this.container.classList.add("stampAnnotation"),this.data.hasPopup||this._createPopup(null,this.data),this.container}}class yt extends v{constructor(e){var E;super(e,{isRenderable:!0});const{filename:r,content:_}=this.data.file;this.filename=(0,T.getFilenameFromUrl)(r,!0),this.content=_,(E=this.linkService.eventBus)==null||E.dispatch("fileattachmentannotation",{source:this,filename:r,content:_})}render(){var r,_;this.container.classList.add("fileAttachmentAnnotation");let e;return this.data.hasAppearance?e=document.createElement("div"):(e=document.createElement("img"),e.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(this.data.name)?"paperclip":"pushpin"}.svg`),e.classList.add("popupTriggerArea"),e.addEventListener("dblclick",this._download.bind(this)),!this.data.hasPopup&&((r=this.data.titleObj)!=null&&r.str||(_=this.data.contentsObj)!=null&&_.str||this.data.richText)&&this._createPopup(e,this.data),this.container.append(e),this.container}_download(){var e;(e=this.downloadManager)==null||e.openOrDownloadData(this.container,this.content,this.filename)}}const L=class L{static render(e){var Z,it;const{annotations:r,div:_,viewport:E,accessibilityManager:D}=e;(0,T.setLayerDimensions)(_,E);const N={data:null,layer:_,page:e.page,viewport:E,linkService:e.linkService,downloadManager:e.downloadManager,imageResourcesPath:e.imageResourcesPath||"",renderForms:e.renderForms!==!1,svgFactory:new T.DOMSVGFactory,annotationStorage:e.annotationStorage||new V.AnnotationStorage,enableScripting:e.enableScripting===!0,hasJSActions:e.hasJSActions,fieldObjects:e.fieldObjects};let st=0;for(const rt of r){if(rt.noHTML)continue;if(rt.annotationType!==g.AnnotationType.POPUP){const{width:mt,height:gt}=w(rt.rect);if(mt<=0||gt<=0)continue}N.data=rt;const dt=x.create(N);if(!dt.isRenderable)continue;const ct=dt.render();if(rt.hidden&&(ct.style.visibility="hidden"),Array.isArray(ct))for(const mt of ct)mt.style.zIndex=st++,ot(Z=L,G,we).call(Z,mt,rt.id,_,D);else ct.style.zIndex=st++,dt instanceof l?_.prepend(ct):ot(it=L,G,we).call(it,ct,rt.id,_,D)}ot(this,K,ke).call(this,_,e.annotationCanvasMap)}static update(e){const{annotationCanvasMap:r,div:_,viewport:E}=e;(0,T.setLayerDimensions)(_,{rotation:E.rotation}),ot(this,K,ke).call(this,_,r),_.hidden=!1}};G=new WeakSet,we=function(e,r,_,E){const D=e.firstChild||e;D.id=`${T.AnnotationPrefix}${r}`,_.append(e),E==null||E.moveElementInDOM(_,e,D,!1)},K=new WeakSet,ke=function(e,r){if(r){for(const[_,E]of r){const D=e.querySelector(`[data-annotation-id="${_}"]`);if(!D)continue;const{firstChild:N}=D;N?N.nodeName==="CANVAS"?N.replaceWith(E):N.before(E):D.append(E)}r.clear()}},Q(L,G),Q(L,K);let W=L;f.AnnotationLayer=W},(at,f)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.ColorConverters=void 0;function z(T){return Math.floor(Math.max(0,Math.min(1,T))*255).toString(16).padStart(2,"0")}class g{static CMYK_G([V,q,et,I]){return["G",1-Math.min(1,.3*V+.59*et+.11*q+I)]}static G_CMYK([V]){return["CMYK",0,0,0,1-V]}static G_RGB([V]){return["RGB",V,V,V]}static G_HTML([V]){const q=z(V);return`#${q}${q}${q}`}static RGB_G([V,q,et]){return["G",.3*V+.59*q+.11*et]}static RGB_HTML([V,q,et]){const I=z(V),S=z(q),b=z(et);return`#${I}${S}${b}`}static T_HTML(){return"#00000000"}static CMYK_RGB([V,q,et,I]){return["RGB",1-Math.min(1,V+I),1-Math.min(1,et+I),1-Math.min(1,q+I)]}static CMYK_HTML(V){const q=this.CMYK_RGB(V).slice(1);return this.RGB_HTML(q)}static RGB_CMYK([V,q,et]){const I=1-V,S=1-q,b=1-et,w=Math.min(I,S,b);return["CMYK",I,S,b,w]}}f.ColorConverters=g},(at,f,z)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.XfaLayer=void 0;var g=z(19);class T{static setupStorage(q,et,I,S,b){const w=S.getValue(et,{value:null});switch(I.name){case"textarea":if(w.value!==null&&(q.textContent=w.value),b==="print")break;q.addEventListener("input",x=>{S.setValue(et,{value:x.target.value})});break;case"input":if(I.attributes.type==="radio"||I.attributes.type==="checkbox"){if(w.value===I.attributes.xfaOn?q.setAttribute("checked",!0):w.value===I.attributes.xfaOff&&q.removeAttribute("checked"),b==="print")break;q.addEventListener("change",x=>{S.setValue(et,{value:x.target.checked?x.target.getAttribute("xfaOn"):x.target.getAttribute("xfaOff")})})}else{if(w.value!==null&&q.setAttribute("value",w.value),b==="print")break;q.addEventListener("input",x=>{S.setValue(et,{value:x.target.value})})}break;case"select":if(w.value!==null)for(const x of I.children)x.attributes.value===w.value&&(x.attributes.selected=!0);q.addEventListener("input",x=>{const v=x.target.options,d=v.selectedIndex===-1?"":v[v.selectedIndex].value;S.setValue(et,{value:d})});break}}static setAttributes({html:q,element:et,storage:I=null,intent:S,linkService:b}){const{attributes:w}=et,x=q instanceof HTMLAnchorElement;w.type==="radio"&&(w.name=`${w.name}-${S}`);for(const[v,d]of Object.entries(w))if(d!=null)switch(v){case"class":d.length&&q.setAttribute(v,d.join(" "));break;case"dataId":break;case"id":q.setAttribute("data-element-id",d);break;case"style":Object.assign(q.style,d);break;case"textContent":q.textContent=d;break;default:(!x||v!=="href"&&v!=="newWindow")&&q.setAttribute(v,d)}x&&b.addLinkAttributes(q,w.href,w.newWindow),I&&w.dataId&&this.setupStorage(q,w.dataId,et,I)}static render(q){var m;const et=q.annotationStorage,I=q.linkService,S=q.xfaHtml,b=q.intent||"display",w=document.createElement(S.name);S.attributes&&this.setAttributes({html:w,element:S,intent:b,linkService:I});const x=[[S,-1,w]],v=q.div;if(v.append(w),q.viewport){const s=`matrix(${q.viewport.transform.join(",")})`;v.style.transform=s}b!=="richText"&&v.setAttribute("class","xfaLayer xfaFont");const d=[];for(;x.length>0;){const[s,a,F]=x.at(-1);if(a+1===s.children.length){x.pop();continue}const M=s.children[++x.at(-1)[1]];if(M===null)continue;const{name:A}=M;if(A==="#text"){const l=document.createTextNode(M.value);d.push(l),F.append(l);continue}let t;if((m=M==null?void 0:M.attributes)!=null&&m.xmlns?t=document.createElementNS(M.attributes.xmlns,A):t=document.createElement(A),F.append(t),M.attributes&&this.setAttributes({html:t,element:M,storage:et,intent:b,linkService:I}),M.children&&M.children.length>0)x.push([M,-1,t]);else if(M.value){const l=document.createTextNode(M.value);g.XfaText.shouldBuildText(A)&&d.push(l),t.append(l)}}for(const s of v.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))s.setAttribute("readOnly",!0);return{textDivs:d}}static update(q){const et=`matrix(${q.viewport.transform.join(",")})`;q.div.style.transform=et,q.div.hidden=!1}}f.XfaLayer=T},(at,f,z)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.SVGGraphics=void 0;var g=z(6),T=z(1),V=z(10);let q=class{constructor(){(0,T.unreachable)("Not implemented: SVGGraphics")}};f.SVGGraphics=q;{let m=function(t){let l=[];const o=[];for(const n of t){if(n.fn==="save"){l.push({fnId:92,fn:"group",items:[]}),o.push(l),l=l.at(-1).items;continue}n.fn==="restore"?l=o.pop():l.push(n)}return l},s=function(t){if(Number.isInteger(t))return t.toString();const l=t.toFixed(10);let o=l.length-1;if(l[o]!=="0")return l;do o--;while(l[o]==="0");return l.substring(0,l[o]==="."?o:o+1)},a=function(t){if(t[4]===0&&t[5]===0){if(t[1]===0&&t[2]===0)return t[0]===1&&t[3]===1?"":`scale(${s(t[0])} ${s(t[3])})`;if(t[0]===t[3]&&t[1]===-t[2]){const l=Math.acos(t[0])*180/Math.PI;return`rotate(${s(l)})`}}else if(t[0]===1&&t[1]===0&&t[2]===0&&t[3]===1)return`translate(${s(t[4])} ${s(t[5])})`;return`matrix(${s(t[0])} ${s(t[1])} ${s(t[2])} ${s(t[3])} ${s(t[4])} ${s(t[5])})`};const et={fontStyle:"normal",fontWeight:"normal",fillColor:"#000000"},I="http://www.w3.org/XML/1998/namespace",S="http://www.w3.org/1999/xlink",b=["butt","round","square"],w=["miter","round","bevel"],x=function(t,l="",o=!1){if(URL.createObjectURL&&typeof Blob<"u"&&!o)return URL.createObjectURL(new Blob([t],{type:l}));const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let u=`data:${l};base64,`;for(let C=0,i=t.length;C<i;C+=3){const O=t[C]&255,X=t[C+1]&255,Y=t[C+2]&255,tt=O>>2,nt=(O&3)<<4|X>>4,ft=C+1<i?(X&15)<<2|Y>>6:64,lt=C+2<i?Y&63:64;u+=n[tt]+n[nt]+n[ft]+n[lt]}return u},v=function(){const t=new Uint8Array([137,80,78,71,13,10,26,10]),l=12,o=new Int32Array(256);for(let Y=0;Y<256;Y++){let tt=Y;for(let nt=0;nt<8;nt++)tt&1?tt=3988292384^tt>>1&2147483647:tt=tt>>1&2147483647;o[Y]=tt}function n(Y,tt,nt){let ft=-1;for(let lt=tt;lt<nt;lt++){const ut=(ft^Y[lt])&255,bt=o[ut];ft=ft>>>8^bt}return ft^-1}function u(Y,tt,nt,ft){let lt=ft;const ut=tt.length;nt[lt]=ut>>24&255,nt[lt+1]=ut>>16&255,nt[lt+2]=ut>>8&255,nt[lt+3]=ut&255,lt+=4,nt[lt]=Y.charCodeAt(0)&255,nt[lt+1]=Y.charCodeAt(1)&255,nt[lt+2]=Y.charCodeAt(2)&255,nt[lt+3]=Y.charCodeAt(3)&255,lt+=4,nt.set(tt,lt),lt+=tt.length;const bt=n(nt,ft+4,lt);nt[lt]=bt>>24&255,nt[lt+1]=bt>>16&255,nt[lt+2]=bt>>8&255,nt[lt+3]=bt&255}function C(Y,tt,nt){let ft=1,lt=0;for(let ut=tt;ut<nt;++ut)ft=(ft+(Y[ut]&255))%65521,lt=(lt+ft)%65521;return lt<<16|ft}function i(Y){if(!V.isNodeJS)return O(Y);try{let tt;parseInt(process.versions.node)>=8?tt=Y:tt=Buffer.from(Y);const nt=require$$5.deflateSync(tt,{level:9});return nt instanceof Uint8Array?nt:new Uint8Array(nt)}catch(tt){(0,T.warn)("Not compressing PNG because zlib.deflateSync is unavailable: "+tt)}return O(Y)}function O(Y){let tt=Y.length;const nt=65535,ft=Math.ceil(tt/nt),lt=new Uint8Array(2+tt+ft*5+4);let ut=0;lt[ut++]=120,lt[ut++]=156;let bt=0;for(;tt>nt;)lt[ut++]=0,lt[ut++]=255,lt[ut++]=255,lt[ut++]=0,lt[ut++]=0,lt.set(Y.subarray(bt,bt+nt),ut),ut+=nt,bt+=nt,tt-=nt;lt[ut++]=1,lt[ut++]=tt&255,lt[ut++]=tt>>8&255,lt[ut++]=~tt&65535&255,lt[ut++]=(~tt&65535)>>8&255,lt.set(Y.subarray(bt),ut),ut+=Y.length-bt;const yt=C(Y,0,Y.length);return lt[ut++]=yt>>24&255,lt[ut++]=yt>>16&255,lt[ut++]=yt>>8&255,lt[ut++]=yt&255,lt}function X(Y,tt,nt,ft){const lt=Y.width,ut=Y.height;let bt,yt,W;const c=Y.data;switch(tt){case T.ImageKind.GRAYSCALE_1BPP:yt=0,bt=1,W=lt+7>>3;break;case T.ImageKind.RGB_24BPP:yt=2,bt=8,W=lt*3;break;case T.ImageKind.RGBA_32BPP:yt=6,bt=8,W=lt*4;break;default:throw new Error("invalid format")}const h=new Uint8Array((1+W)*ut);let y=0,j=0;for(let L=0;L<ut;++L)h[y++]=0,h.set(c.subarray(j,j+W),y),j+=W,y+=W;if(tt===T.ImageKind.GRAYSCALE_1BPP&&ft){y=0;for(let L=0;L<ut;L++){y++;for(let k=0;k<W;k++)h[y++]^=255}}const R=new Uint8Array([lt>>24&255,lt>>16&255,lt>>8&255,lt&255,ut>>24&255,ut>>16&255,ut>>8&255,ut&255,bt,yt,0,0,0]),G=i(h),H=t.length+l*3+R.length+G.length,K=new Uint8Array(H);let $=0;return K.set(t,$),$+=t.length,u("IHDR",R,K,$),$+=l+R.length,u("IDATA",G,K,$),$+=l+G.length,u("IEND",new Uint8Array(0),K,$),x(K,"image/png",nt)}return function(tt,nt,ft){const lt=tt.kind===void 0?T.ImageKind.GRAYSCALE_1BPP:tt.kind;return X(tt,lt,nt,ft)}}();class d{constructor(){this.fontSizeScale=1,this.fontWeight=et.fontWeight,this.fontSize=0,this.textMatrix=T.IDENTITY_MATRIX,this.fontMatrix=T.FONT_IDENTITY_MATRIX,this.leading=0,this.textRenderingMode=T.TextRenderingMode.FILL,this.textMatrixScale=1,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRise=0,this.fillColor=et.fillColor,this.strokeColor="#000000",this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.lineJoin="",this.lineCap="",this.miterLimit=0,this.dashArray=[],this.dashPhase=0,this.dependencies=[],this.activeClipUrl=null,this.clipGroup=null,this.maskId=""}clone(){return Object.create(this)}setCurrentPoint(l,o){this.x=l,this.y=o}}let F=0,M=0,A=0;f.SVGGraphics=q=class{constructor(t,l,o=!1){(0,g.deprecated)("The SVG back-end is no longer maintained and *may* be removed in the future."),this.svgFactory=new g.DOMSVGFactory,this.current=new d,this.transformMatrix=T.IDENTITY_MATRIX,this.transformStack=[],this.extraStack=[],this.commonObjs=t,this.objs=l,this.pendingClip=null,this.pendingEOFill=!1,this.embedFonts=!1,this.embeddedFonts=Object.create(null),this.cssStyle=null,this.forceDataSchema=!!o,this._operatorIdMapping=[];for(const n in T.OPS)this._operatorIdMapping[T.OPS[n]]=n}getObject(t,l=null){return typeof t=="string"?t.startsWith("g_")?this.commonObjs.get(t):this.objs.get(t):l}save(){this.transformStack.push(this.transformMatrix);const t=this.current;this.extraStack.push(t),this.current=t.clone()}restore(){this.transformMatrix=this.transformStack.pop(),this.current=this.extraStack.pop(),this.pendingClip=null,this.tgrp=null}group(t){this.save(),this.executeOpTree(t),this.restore()}loadDependencies(t){const l=t.fnArray,o=t.argsArray;for(let n=0,u=l.length;n<u;n++)if(l[n]===T.OPS.dependency)for(const C of o[n]){const i=C.startsWith("g_")?this.commonObjs:this.objs,O=new Promise(X=>{i.get(C,X)});this.current.dependencies.push(O)}return Promise.all(this.current.dependencies)}transform(t,l,o,n,u,C){const i=[t,l,o,n,u,C];this.transformMatrix=T.Util.transform(this.transformMatrix,i),this.tgrp=null}getSVG(t,l){this.viewport=l;const o=this._initialize(l);return this.loadDependencies(t).then(()=>(this.transformMatrix=T.IDENTITY_MATRIX,this.executeOpTree(this.convertOpList(t)),o))}convertOpList(t){const l=this._operatorIdMapping,o=t.argsArray,n=t.fnArray,u=[];for(let C=0,i=n.length;C<i;C++){const O=n[C];u.push({fnId:O,fn:l[O],args:o[C]})}return m(u)}executeOpTree(t){for(const l of t){const o=l.fn,n=l.fnId,u=l.args;switch(n|0){case T.OPS.beginText:this.beginText();break;case T.OPS.dependency:break;case T.OPS.setLeading:this.setLeading(u);break;case T.OPS.setLeadingMoveText:this.setLeadingMoveText(u[0],u[1]);break;case T.OPS.setFont:this.setFont(u);break;case T.OPS.showText:this.showText(u[0]);break;case T.OPS.showSpacedText:this.showText(u[0]);break;case T.OPS.endText:this.endText();break;case T.OPS.moveText:this.moveText(u[0],u[1]);break;case T.OPS.setCharSpacing:this.setCharSpacing(u[0]);break;case T.OPS.setWordSpacing:this.setWordSpacing(u[0]);break;case T.OPS.setHScale:this.setHScale(u[0]);break;case T.OPS.setTextMatrix:this.setTextMatrix(u[0],u[1],u[2],u[3],u[4],u[5]);break;case T.OPS.setTextRise:this.setTextRise(u[0]);break;case T.OPS.setTextRenderingMode:this.setTextRenderingMode(u[0]);break;case T.OPS.setLineWidth:this.setLineWidth(u[0]);break;case T.OPS.setLineJoin:this.setLineJoin(u[0]);break;case T.OPS.setLineCap:this.setLineCap(u[0]);break;case T.OPS.setMiterLimit:this.setMiterLimit(u[0]);break;case T.OPS.setFillRGBColor:this.setFillRGBColor(u[0],u[1],u[2]);break;case T.OPS.setStrokeRGBColor:this.setStrokeRGBColor(u[0],u[1],u[2]);break;case T.OPS.setStrokeColorN:this.setStrokeColorN(u);break;case T.OPS.setFillColorN:this.setFillColorN(u);break;case T.OPS.shadingFill:this.shadingFill(u[0]);break;case T.OPS.setDash:this.setDash(u[0],u[1]);break;case T.OPS.setRenderingIntent:this.setRenderingIntent(u[0]);break;case T.OPS.setFlatness:this.setFlatness(u[0]);break;case T.OPS.setGState:this.setGState(u[0]);break;case T.OPS.fill:this.fill();break;case T.OPS.eoFill:this.eoFill();break;case T.OPS.stroke:this.stroke();break;case T.OPS.fillStroke:this.fillStroke();break;case T.OPS.eoFillStroke:this.eoFillStroke();break;case T.OPS.clip:this.clip("nonzero");break;case T.OPS.eoClip:this.clip("evenodd");break;case T.OPS.paintSolidColorImageMask:this.paintSolidColorImageMask();break;case T.OPS.paintImageXObject:this.paintImageXObject(u[0]);break;case T.OPS.paintInlineImageXObject:this.paintInlineImageXObject(u[0]);break;case T.OPS.paintImageMaskXObject:this.paintImageMaskXObject(u[0]);break;case T.OPS.paintFormXObjectBegin:this.paintFormXObjectBegin(u[0],u[1]);break;case T.OPS.paintFormXObjectEnd:this.paintFormXObjectEnd();break;case T.OPS.closePath:this.closePath();break;case T.OPS.closeStroke:this.closeStroke();break;case T.OPS.closeFillStroke:this.closeFillStroke();break;case T.OPS.closeEOFillStroke:this.closeEOFillStroke();break;case T.OPS.nextLine:this.nextLine();break;case T.OPS.transform:this.transform(u[0],u[1],u[2],u[3],u[4],u[5]);break;case T.OPS.constructPath:this.constructPath(u[0],u[1]);break;case T.OPS.endPath:this.endPath();break;case 92:this.group(l.items);break;default:(0,T.warn)(`Unimplemented operator ${o}`);break}}}setWordSpacing(t){this.current.wordSpacing=t}setCharSpacing(t){this.current.charSpacing=t}nextLine(){this.moveText(0,this.current.leading)}setTextMatrix(t,l,o,n,u,C){const i=this.current;i.textMatrix=i.lineMatrix=[t,l,o,n,u,C],i.textMatrixScale=Math.hypot(t,l),i.x=i.lineX=0,i.y=i.lineY=0,i.xcoords=[],i.ycoords=[],i.tspan=this.svgFactory.createElement("svg:tspan"),i.tspan.setAttributeNS(null,"font-family",i.fontFamily),i.tspan.setAttributeNS(null,"font-size",`${s(i.fontSize)}px`),i.tspan.setAttributeNS(null,"y",s(-i.y)),i.txtElement=this.svgFactory.createElement("svg:text"),i.txtElement.append(i.tspan)}beginText(){const t=this.current;t.x=t.lineX=0,t.y=t.lineY=0,t.textMatrix=T.IDENTITY_MATRIX,t.lineMatrix=T.IDENTITY_MATRIX,t.textMatrixScale=1,t.tspan=this.svgFactory.createElement("svg:tspan"),t.txtElement=this.svgFactory.createElement("svg:text"),t.txtgrp=this.svgFactory.createElement("svg:g"),t.xcoords=[],t.ycoords=[]}moveText(t,l){const o=this.current;o.x=o.lineX+=t,o.y=o.lineY+=l,o.xcoords=[],o.ycoords=[],o.tspan=this.svgFactory.createElement("svg:tspan"),o.tspan.setAttributeNS(null,"font-family",o.fontFamily),o.tspan.setAttributeNS(null,"font-size",`${s(o.fontSize)}px`),o.tspan.setAttributeNS(null,"y",s(-o.y))}showText(t){const l=this.current,o=l.font,n=l.fontSize;if(n===0)return;const u=l.fontSizeScale,C=l.charSpacing,i=l.wordSpacing,O=l.fontDirection,X=l.textHScale*O,Y=o.vertical,tt=Y?1:-1,nt=o.defaultVMetrics,ft=n*l.fontMatrix[0];let lt=0;for(const yt of t){if(yt===null){lt+=O*i;continue}else if(typeof yt=="number"){lt+=tt*yt*n/1e3;continue}const W=(yt.isSpace?i:0)+C,c=yt.fontChar;let h,y,j=yt.width;if(Y){let G;const H=yt.vmetric||nt;G=yt.vmetric?H[1]:j*.5,G=-G*ft;const K=H[2]*ft;j=H?-H[0]:j,h=G/u,y=(lt+K)/u}else h=lt/u,y=0;(yt.isInFont||o.missingFile)&&(l.xcoords.push(l.x+h),Y&&l.ycoords.push(-l.y+y),l.tspan.textContent+=c);let R;Y?R=j*ft-W*O:R=j*ft+W*O,lt+=R}l.tspan.setAttributeNS(null,"x",l.xcoords.map(s).join(" ")),Y?l.tspan.setAttributeNS(null,"y",l.ycoords.map(s).join(" ")):l.tspan.setAttributeNS(null,"y",s(-l.y)),Y?l.y-=lt:l.x+=lt*X,l.tspan.setAttributeNS(null,"font-family",l.fontFamily),l.tspan.setAttributeNS(null,"font-size",`${s(l.fontSize)}px`),l.fontStyle!==et.fontStyle&&l.tspan.setAttributeNS(null,"font-style",l.fontStyle),l.fontWeight!==et.fontWeight&&l.tspan.setAttributeNS(null,"font-weight",l.fontWeight);const ut=l.textRenderingMode&T.TextRenderingMode.FILL_STROKE_MASK;if(ut===T.TextRenderingMode.FILL||ut===T.TextRenderingMode.FILL_STROKE?(l.fillColor!==et.fillColor&&l.tspan.setAttributeNS(null,"fill",l.fillColor),l.fillAlpha<1&&l.tspan.setAttributeNS(null,"fill-opacity",l.fillAlpha)):l.textRenderingMode===T.TextRenderingMode.ADD_TO_PATH?l.tspan.setAttributeNS(null,"fill","transparent"):l.tspan.setAttributeNS(null,"fill","none"),ut===T.TextRenderingMode.STROKE||ut===T.TextRenderingMode.FILL_STROKE){const yt=1/(l.textMatrixScale||1);this._setStrokeAttributes(l.tspan,yt)}let bt=l.textMatrix;l.textRise!==0&&(bt=bt.slice(),bt[5]+=l.textRise),l.txtElement.setAttributeNS(null,"transform",`${a(bt)} scale(${s(X)}, -1)`),l.txtElement.setAttributeNS(I,"xml:space","preserve"),l.txtElement.append(l.tspan),l.txtgrp.append(l.txtElement),this._ensureTransformGroup().append(l.txtElement)}setLeadingMoveText(t,l){this.setLeading(-l),this.moveText(t,l)}addFontStyle(t){if(!t.data)throw new Error('addFontStyle: No font data available, ensure that the "fontExtraProperties" API parameter is set.');this.cssStyle||(this.cssStyle=this.svgFactory.createElement("svg:style"),this.cssStyle.setAttributeNS(null,"type","text/css"),this.defs.append(this.cssStyle));const l=x(t.data,t.mimetype,this.forceDataSchema);this.cssStyle.textContent+=`@font-face { font-family: "${t.loadedName}"; src: url(${l}); }
`}setFont(t){const l=this.current,o=this.commonObjs.get(t[0]);let n=t[1];l.font=o,this.embedFonts&&!o.missingFile&&!this.embeddedFonts[o.loadedName]&&(this.addFontStyle(o),this.embeddedFonts[o.loadedName]=o),l.fontMatrix=o.fontMatrix||T.FONT_IDENTITY_MATRIX;let u="normal";o.black?u="900":o.bold&&(u="bold");const C=o.italic?"italic":"normal";n<0?(n=-n,l.fontDirection=-1):l.fontDirection=1,l.fontSize=n,l.fontFamily=o.loadedName,l.fontWeight=u,l.fontStyle=C,l.tspan=this.svgFactory.createElement("svg:tspan"),l.tspan.setAttributeNS(null,"y",s(-l.y)),l.xcoords=[],l.ycoords=[]}endText(){var l;const t=this.current;t.textRenderingMode&T.TextRenderingMode.ADD_TO_PATH_FLAG&&((l=t.txtElement)!=null&&l.hasChildNodes())&&(t.element=t.txtElement,this.clip("nonzero"),this.endPath())}setLineWidth(t){t>0&&(this.current.lineWidth=t)}setLineCap(t){this.current.lineCap=b[t]}setLineJoin(t){this.current.lineJoin=w[t]}setMiterLimit(t){this.current.miterLimit=t}setStrokeAlpha(t){this.current.strokeAlpha=t}setStrokeRGBColor(t,l,o){this.current.strokeColor=T.Util.makeHexColor(t,l,o)}setFillAlpha(t){this.current.fillAlpha=t}setFillRGBColor(t,l,o){this.current.fillColor=T.Util.makeHexColor(t,l,o),this.current.tspan=this.svgFactory.createElement("svg:tspan"),this.current.xcoords=[],this.current.ycoords=[]}setStrokeColorN(t){this.current.strokeColor=this._makeColorN_Pattern(t)}setFillColorN(t){this.current.fillColor=this._makeColorN_Pattern(t)}shadingFill(t){const l=this.viewport.width,o=this.viewport.height,n=T.Util.inverseTransform(this.transformMatrix),u=T.Util.applyTransform([0,0],n),C=T.Util.applyTransform([0,o],n),i=T.Util.applyTransform([l,0],n),O=T.Util.applyTransform([l,o],n),X=Math.min(u[0],C[0],i[0],O[0]),Y=Math.min(u[1],C[1],i[1],O[1]),tt=Math.max(u[0],C[0],i[0],O[0]),nt=Math.max(u[1],C[1],i[1],O[1]),ft=this.svgFactory.createElement("svg:rect");ft.setAttributeNS(null,"x",X),ft.setAttributeNS(null,"y",Y),ft.setAttributeNS(null,"width",tt-X),ft.setAttributeNS(null,"height",nt-Y),ft.setAttributeNS(null,"fill",this._makeShadingPattern(t)),this.current.fillAlpha<1&&ft.setAttributeNS(null,"fill-opacity",this.current.fillAlpha),this._ensureTransformGroup().append(ft)}_makeColorN_Pattern(t){return t[0]==="TilingPattern"?this._makeTilingPattern(t):this._makeShadingPattern(t)}_makeTilingPattern(t){const l=t[1],o=t[2],n=t[3]||T.IDENTITY_MATRIX,[u,C,i,O]=t[4],X=t[5],Y=t[6],tt=t[7],nt=`shading${A++}`,[ft,lt,ut,bt]=T.Util.normalizeRect([...T.Util.applyTransform([u,C],n),...T.Util.applyTransform([i,O],n)]),[yt,W]=T.Util.singularValueDecompose2dScale(n),c=X*yt,h=Y*W,y=this.svgFactory.createElement("svg:pattern");y.setAttributeNS(null,"id",nt),y.setAttributeNS(null,"patternUnits","userSpaceOnUse"),y.setAttributeNS(null,"width",c),y.setAttributeNS(null,"height",h),y.setAttributeNS(null,"x",`${ft}`),y.setAttributeNS(null,"y",`${lt}`);const j=this.svg,R=this.transformMatrix,G=this.current.fillColor,H=this.current.strokeColor,K=this.svgFactory.create(ut-ft,bt-lt);if(this.svg=K,this.transformMatrix=n,tt===2){const $=T.Util.makeHexColor(...l);this.current.fillColor=$,this.current.strokeColor=$}return this.executeOpTree(this.convertOpList(o)),this.svg=j,this.transformMatrix=R,this.current.fillColor=G,this.current.strokeColor=H,y.append(K.childNodes[0]),this.defs.append(y),`url(#${nt})`}_makeShadingPattern(t){switch(typeof t=="string"&&(t=this.objs.get(t)),t[0]){case"RadialAxial":const l=`shading${A++}`,o=t[3];let n;switch(t[1]){case"axial":const u=t[4],C=t[5];n=this.svgFactory.createElement("svg:linearGradient"),n.setAttributeNS(null,"id",l),n.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),n.setAttributeNS(null,"x1",u[0]),n.setAttributeNS(null,"y1",u[1]),n.setAttributeNS(null,"x2",C[0]),n.setAttributeNS(null,"y2",C[1]);break;case"radial":const i=t[4],O=t[5],X=t[6],Y=t[7];n=this.svgFactory.createElement("svg:radialGradient"),n.setAttributeNS(null,"id",l),n.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),n.setAttributeNS(null,"cx",O[0]),n.setAttributeNS(null,"cy",O[1]),n.setAttributeNS(null,"r",Y),n.setAttributeNS(null,"fx",i[0]),n.setAttributeNS(null,"fy",i[1]),n.setAttributeNS(null,"fr",X);break;default:throw new Error(`Unknown RadialAxial type: ${t[1]}`)}for(const u of o){const C=this.svgFactory.createElement("svg:stop");C.setAttributeNS(null,"offset",u[0]),C.setAttributeNS(null,"stop-color",u[1]),n.append(C)}return this.defs.append(n),`url(#${l})`;case"Mesh":return(0,T.warn)("Unimplemented pattern Mesh"),null;case"Dummy":return"hotpink";default:throw new Error(`Unknown IR type: ${t[0]}`)}}setDash(t,l){this.current.dashArray=t,this.current.dashPhase=l}constructPath(t,l){const o=this.current;let n=o.x,u=o.y,C=[],i=0;for(const O of t)switch(O|0){case T.OPS.rectangle:n=l[i++],u=l[i++];const X=l[i++],Y=l[i++],tt=n+X,nt=u+Y;C.push("M",s(n),s(u),"L",s(tt),s(u),"L",s(tt),s(nt),"L",s(n),s(nt),"Z");break;case T.OPS.moveTo:n=l[i++],u=l[i++],C.push("M",s(n),s(u));break;case T.OPS.lineTo:n=l[i++],u=l[i++],C.push("L",s(n),s(u));break;case T.OPS.curveTo:n=l[i+4],u=l[i+5],C.push("C",s(l[i]),s(l[i+1]),s(l[i+2]),s(l[i+3]),s(n),s(u)),i+=6;break;case T.OPS.curveTo2:C.push("C",s(n),s(u),s(l[i]),s(l[i+1]),s(l[i+2]),s(l[i+3])),n=l[i+2],u=l[i+3],i+=4;break;case T.OPS.curveTo3:n=l[i+2],u=l[i+3],C.push("C",s(l[i]),s(l[i+1]),s(n),s(u),s(n),s(u)),i+=4;break;case T.OPS.closePath:C.push("Z");break}C=C.join(" "),o.path&&t.length>0&&t[0]!==T.OPS.rectangle&&t[0]!==T.OPS.moveTo?C=o.path.getAttributeNS(null,"d")+C:(o.path=this.svgFactory.createElement("svg:path"),this._ensureTransformGroup().append(o.path)),o.path.setAttributeNS(null,"d",C),o.path.setAttributeNS(null,"fill","none"),o.element=o.path,o.setCurrentPoint(n,u)}endPath(){const t=this.current;if(t.path=null,!this.pendingClip)return;if(!t.element){this.pendingClip=null;return}const l=`clippath${F++}`,o=this.svgFactory.createElement("svg:clipPath");o.setAttributeNS(null,"id",l),o.setAttributeNS(null,"transform",a(this.transformMatrix));const n=t.element.cloneNode(!0);if(this.pendingClip==="evenodd"?n.setAttributeNS(null,"clip-rule","evenodd"):n.setAttributeNS(null,"clip-rule","nonzero"),this.pendingClip=null,o.append(n),this.defs.append(o),t.activeClipUrl){t.clipGroup=null;for(const u of this.extraStack)u.clipGroup=null;o.setAttributeNS(null,"clip-path",t.activeClipUrl)}t.activeClipUrl=`url(#${l})`,this.tgrp=null}clip(t){this.pendingClip=t}closePath(){const t=this.current;if(t.path){const l=`${t.path.getAttributeNS(null,"d")}Z`;t.path.setAttributeNS(null,"d",l)}}setLeading(t){this.current.leading=-t}setTextRise(t){this.current.textRise=t}setTextRenderingMode(t){this.current.textRenderingMode=t}setHScale(t){this.current.textHScale=t/100}setRenderingIntent(t){}setFlatness(t){}setGState(t){for(const[l,o]of t)switch(l){case"LW":this.setLineWidth(o);break;case"LC":this.setLineCap(o);break;case"LJ":this.setLineJoin(o);break;case"ML":this.setMiterLimit(o);break;case"D":this.setDash(o[0],o[1]);break;case"RI":this.setRenderingIntent(o);break;case"FL":this.setFlatness(o);break;case"Font":this.setFont(o);break;case"CA":this.setStrokeAlpha(o);break;case"ca":this.setFillAlpha(o);break;default:(0,T.warn)(`Unimplemented graphic state operator ${l}`);break}}fill(){const t=this.current;t.element&&(t.element.setAttributeNS(null,"fill",t.fillColor),t.element.setAttributeNS(null,"fill-opacity",t.fillAlpha),this.endPath())}stroke(){const t=this.current;t.element&&(this._setStrokeAttributes(t.element),t.element.setAttributeNS(null,"fill","none"),this.endPath())}_setStrokeAttributes(t,l=1){const o=this.current;let n=o.dashArray;l!==1&&n.length>0&&(n=n.map(function(u){return l*u})),t.setAttributeNS(null,"stroke",o.strokeColor),t.setAttributeNS(null,"stroke-opacity",o.strokeAlpha),t.setAttributeNS(null,"stroke-miterlimit",s(o.miterLimit)),t.setAttributeNS(null,"stroke-linecap",o.lineCap),t.setAttributeNS(null,"stroke-linejoin",o.lineJoin),t.setAttributeNS(null,"stroke-width",s(l*o.lineWidth)+"px"),t.setAttributeNS(null,"stroke-dasharray",n.map(s).join(" ")),t.setAttributeNS(null,"stroke-dashoffset",s(l*o.dashPhase)+"px")}eoFill(){var t;(t=this.current.element)==null||t.setAttributeNS(null,"fill-rule","evenodd"),this.fill()}fillStroke(){this.stroke(),this.fill()}eoFillStroke(){var t;(t=this.current.element)==null||t.setAttributeNS(null,"fill-rule","evenodd"),this.fillStroke()}closeStroke(){this.closePath(),this.stroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.closePath(),this.eoFillStroke()}paintSolidColorImageMask(){const t=this.svgFactory.createElement("svg:rect");t.setAttributeNS(null,"x","0"),t.setAttributeNS(null,"y","0"),t.setAttributeNS(null,"width","1px"),t.setAttributeNS(null,"height","1px"),t.setAttributeNS(null,"fill",this.current.fillColor),this._ensureTransformGroup().append(t)}paintImageXObject(t){const l=this.getObject(t);if(!l){(0,T.warn)(`Dependent image with object ID ${t} is not ready yet`);return}this.paintInlineImageXObject(l)}paintInlineImageXObject(t,l){const o=t.width,n=t.height,u=v(t,this.forceDataSchema,!!l),C=this.svgFactory.createElement("svg:rect");C.setAttributeNS(null,"x","0"),C.setAttributeNS(null,"y","0"),C.setAttributeNS(null,"width",s(o)),C.setAttributeNS(null,"height",s(n)),this.current.element=C,this.clip("nonzero");const i=this.svgFactory.createElement("svg:image");i.setAttributeNS(S,"xlink:href",u),i.setAttributeNS(null,"x","0"),i.setAttributeNS(null,"y",s(-n)),i.setAttributeNS(null,"width",s(o)+"px"),i.setAttributeNS(null,"height",s(n)+"px"),i.setAttributeNS(null,"transform",`scale(${s(1/o)} ${s(-1/n)})`),l?l.append(i):this._ensureTransformGroup().append(i)}paintImageMaskXObject(t){const l=this.getObject(t.data,t);if(l.bitmap){(0,T.warn)("paintImageMaskXObject: ImageBitmap support is not implemented, ensure that the `isOffscreenCanvasSupported` API parameter is disabled.");return}const o=this.current,n=l.width,u=l.height,C=o.fillColor;o.maskId=`mask${M++}`;const i=this.svgFactory.createElement("svg:mask");i.setAttributeNS(null,"id",o.maskId);const O=this.svgFactory.createElement("svg:rect");O.setAttributeNS(null,"x","0"),O.setAttributeNS(null,"y","0"),O.setAttributeNS(null,"width",s(n)),O.setAttributeNS(null,"height",s(u)),O.setAttributeNS(null,"fill",C),O.setAttributeNS(null,"mask",`url(#${o.maskId})`),this.defs.append(i),this._ensureTransformGroup().append(O),this.paintInlineImageXObject(l,i)}paintFormXObjectBegin(t,l){if(Array.isArray(t)&&t.length===6&&this.transform(t[0],t[1],t[2],t[3],t[4],t[5]),l){const o=l[2]-l[0],n=l[3]-l[1],u=this.svgFactory.createElement("svg:rect");u.setAttributeNS(null,"x",l[0]),u.setAttributeNS(null,"y",l[1]),u.setAttributeNS(null,"width",s(o)),u.setAttributeNS(null,"height",s(n)),this.current.element=u,this.clip("nonzero"),this.endPath()}}paintFormXObjectEnd(){}_initialize(t){const l=this.svgFactory.create(t.width,t.height),o=this.svgFactory.createElement("svg:defs");l.append(o),this.defs=o;const n=this.svgFactory.createElement("svg:g");return n.setAttributeNS(null,"transform",a(t.transform)),l.append(n),this.svg=n,l}_ensureClipGroup(){if(!this.current.clipGroup){const t=this.svgFactory.createElement("svg:g");t.setAttributeNS(null,"clip-path",this.current.activeClipUrl),this.svg.append(t),this.current.clipGroup=t}return this.current.clipGroup}_ensureTransformGroup(){return this.tgrp||(this.tgrp=this.svgFactory.createElement("svg:g"),this.tgrp.setAttributeNS(null,"transform",a(this.transformMatrix)),this.current.activeClipUrl?this._ensureClipGroup().append(this.tgrp):this.svg.append(this.tgrp)),this.tgrp}}}}],__webpack_module_cache__={};function __w_pdfjs_require__(at){var f=__webpack_module_cache__[at];if(f!==void 0)return f.exports;var z=__webpack_module_cache__[at]={exports:{}};return __webpack_modules__[at](z,z.exports,__w_pdfjs_require__),z.exports}var __webpack_exports__={};return(()=>{var at=__webpack_exports__;Object.defineProperty(at,"__esModule",{value:!0}),Object.defineProperty(at,"AbortException",{enumerable:!0,get:function(){return f.AbortException}}),Object.defineProperty(at,"AnnotationEditorLayer",{enumerable:!0,get:function(){return V.AnnotationEditorLayer}}),Object.defineProperty(at,"AnnotationEditorParamsType",{enumerable:!0,get:function(){return f.AnnotationEditorParamsType}}),Object.defineProperty(at,"AnnotationEditorType",{enumerable:!0,get:function(){return f.AnnotationEditorType}}),Object.defineProperty(at,"AnnotationEditorUIManager",{enumerable:!0,get:function(){return q.AnnotationEditorUIManager}}),Object.defineProperty(at,"AnnotationLayer",{enumerable:!0,get:function(){return et.AnnotationLayer}}),Object.defineProperty(at,"AnnotationMode",{enumerable:!0,get:function(){return f.AnnotationMode}}),Object.defineProperty(at,"CMapCompressionType",{enumerable:!0,get:function(){return f.CMapCompressionType}}),Object.defineProperty(at,"FeatureTest",{enumerable:!0,get:function(){return f.FeatureTest}}),Object.defineProperty(at,"GlobalWorkerOptions",{enumerable:!0,get:function(){return I.GlobalWorkerOptions}}),Object.defineProperty(at,"InvalidPDFException",{enumerable:!0,get:function(){return f.InvalidPDFException}}),Object.defineProperty(at,"MissingPDFException",{enumerable:!0,get:function(){return f.MissingPDFException}}),Object.defineProperty(at,"OPS",{enumerable:!0,get:function(){return f.OPS}}),Object.defineProperty(at,"PDFDataRangeTransport",{enumerable:!0,get:function(){return z.PDFDataRangeTransport}}),Object.defineProperty(at,"PDFDateString",{enumerable:!0,get:function(){return g.PDFDateString}}),Object.defineProperty(at,"PDFWorker",{enumerable:!0,get:function(){return z.PDFWorker}}),Object.defineProperty(at,"PasswordResponses",{enumerable:!0,get:function(){return f.PasswordResponses}}),Object.defineProperty(at,"PermissionFlag",{enumerable:!0,get:function(){return f.PermissionFlag}}),Object.defineProperty(at,"PixelsPerInch",{enumerable:!0,get:function(){return g.PixelsPerInch}}),Object.defineProperty(at,"RenderingCancelledException",{enumerable:!0,get:function(){return g.RenderingCancelledException}}),Object.defineProperty(at,"SVGGraphics",{enumerable:!0,get:function(){return S.SVGGraphics}}),Object.defineProperty(at,"UnexpectedResponseException",{enumerable:!0,get:function(){return f.UnexpectedResponseException}}),Object.defineProperty(at,"Util",{enumerable:!0,get:function(){return f.Util}}),Object.defineProperty(at,"VerbosityLevel",{enumerable:!0,get:function(){return f.VerbosityLevel}}),Object.defineProperty(at,"XfaLayer",{enumerable:!0,get:function(){return b.XfaLayer}}),Object.defineProperty(at,"build",{enumerable:!0,get:function(){return z.build}}),Object.defineProperty(at,"createPromiseCapability",{enumerable:!0,get:function(){return f.createPromiseCapability}}),Object.defineProperty(at,"createValidAbsoluteUrl",{enumerable:!0,get:function(){return f.createValidAbsoluteUrl}}),Object.defineProperty(at,"getDocument",{enumerable:!0,get:function(){return z.getDocument}}),Object.defineProperty(at,"getFilenameFromUrl",{enumerable:!0,get:function(){return g.getFilenameFromUrl}}),Object.defineProperty(at,"getPdfFilenameFromUrl",{enumerable:!0,get:function(){return g.getPdfFilenameFromUrl}}),Object.defineProperty(at,"getXfaPageViewport",{enumerable:!0,get:function(){return g.getXfaPageViewport}}),Object.defineProperty(at,"isDataScheme",{enumerable:!0,get:function(){return g.isDataScheme}}),Object.defineProperty(at,"isPdfFile",{enumerable:!0,get:function(){return g.isPdfFile}}),Object.defineProperty(at,"loadScript",{enumerable:!0,get:function(){return g.loadScript}}),Object.defineProperty(at,"renderTextLayer",{enumerable:!0,get:function(){return T.renderTextLayer}}),Object.defineProperty(at,"setLayerDimensions",{enumerable:!0,get:function(){return g.setLayerDimensions}}),Object.defineProperty(at,"shadow",{enumerable:!0,get:function(){return f.shadow}}),Object.defineProperty(at,"updateTextLayer",{enumerable:!0,get:function(){return T.updateTextLayer}}),Object.defineProperty(at,"version",{enumerable:!0,get:function(){return z.version}});var f=__w_pdfjs_require__(1),z=__w_pdfjs_require__(2),g=__w_pdfjs_require__(6),T=__w_pdfjs_require__(26),V=__w_pdfjs_require__(27),q=__w_pdfjs_require__(5),et=__w_pdfjs_require__(32),I=__w_pdfjs_require__(14),S=__w_pdfjs_require__(35),b=__w_pdfjs_require__(34)})(),__webpack_exports__})())})(pdf);var pdfExports=pdf.exports;const PdfViewer_svelte_svelte_type_style_lang="";function create_fragment$1(at){let f,z;return{c(){f=element("div"),z=element("div"),this.h()},l(g){f=claim_element(g,"DIV",{class:!0});var T=children(f);z=claim_element(T,"DIV",{class:!0,style:!0}),children(z).forEach(detach),T.forEach(detach),this.h()},h(){attr(z,"class","pdf-wrapper svelte-r9i6p1"),set_style(z,"--scale-factor","1.2"),attr(f,"class","pdf-container svelte-r9i6p1")},m(g,T){insert_hydration(g,f,T),append_hydration(f,z),at[2](z)},p:noop,i:noop,o:noop,d(g){g&&detach(f),at[2](null)}}}function instance$1(at,f,z){pdfExports.GlobalWorkerOptions.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.5.141/pdf.worker.min.js";let{url:g=""}=f,T;async function V(I){const S=I.getViewport({scale:1.2}),b=document.createElement("div");b.style.marginBottom="16px",b.style.position="relative",b.id=`page-${I._pageIndex+1}`;const w=document.createElement("canvas"),x=w.getContext("2d");if(!x)return;w.height=S.height,w.width=S.width,b.appendChild(w),T.appendChild(b),I.render({canvasContext:x,viewport:S});const v=document.createElement("div");v.className="textLayer";const d=await I.getTextContent();pdfExports.renderTextLayer({textContentSource:d,viewport:I.getViewport(),container:v}),b.appendChild(v)}let q=!1;onMount(async()=>{const I=await pdfExports.getDocument(g).promise;if(!q)for(let S=1;S<=I.numPages;S++)I.getPage(S).then(V)}),onDestroy(()=>{q=!0});function et(I){binding_callbacks[I?"unshift":"push"](()=>{T=I,z(0,T)})}return at.$$set=I=>{"url"in I&&z(1,g=I.url)},[T,g,et]}class PdfViewer extends SvelteComponent{constructor(f){super(),init(this,f,instance$1,create_fragment$1,safe_not_equal,{url:1})}}function create_if_block_1(at){let f=at[0].error+"",z;return{c(){z=text(f)},l(g){z=claim_text(g,f)},m(g,T){insert_hydration(g,z,T)},p(g,T){T&1&&f!==(f=g[0].error+"")&&set_data(z,f)},d(g){g&&detach(z)}}}function create_if_block(at){let f,z,g,T,V,q,et;return g=new ChatPanel({props:{documentId:at[1].id,onSubmit:at[3]}}),q=new PdfViewer({props:{url:at[2]}}),{c(){f=element("div"),z=element("div"),create_component(g.$$.fragment),T=space(),V=element("div"),create_component(q.$$.fragment),this.h()},l(I){f=claim_element(I,"DIV",{class:!0,style:!0});var S=children(f);z=claim_element(S,"DIV",{class:!0});var b=children(z);claim_component(g.$$.fragment,b),b.forEach(detach),T=claim_space(S),V=claim_element(S,"DIV",{class:!0});var w=children(V);claim_component(q.$$.fragment,w),w.forEach(detach),S.forEach(detach),this.h()},h(){attr(z,"class","col-span-1"),attr(V,"class","col-span-2"),attr(f,"class","grid grid-cols-3 gap-2"),set_style(f,"height","calc(100vh - 80px)")},m(I,S){insert_hydration(I,f,S),append_hydration(f,z),mount_component(g,z,null),append_hydration(f,T),append_hydration(f,V),mount_component(q,V,null),et=!0},p:noop,i(I){et||(transition_in(g.$$.fragment,I),transition_in(q.$$.fragment,I),et=!0)},o(I){transition_out(g.$$.fragment,I),transition_out(q.$$.fragment,I),et=!1},d(I){I&&detach(f),destroy_component(g),destroy_component(q)}}}function create_fragment(at){let f,z,g,T=at[0].error&&create_if_block_1(at),V=at[1]&&create_if_block(at);return{c(){T&&T.c(),f=space(),V&&V.c(),z=empty()},l(q){T&&T.l(q),f=claim_space(q),V&&V.l(q),z=empty()},m(q,et){T&&T.m(q,et),insert_hydration(q,f,et),V&&V.m(q,et),insert_hydration(q,z,et),g=!0},p(q,[et]){q[0].error?T?T.p(q,et):(T=create_if_block_1(q),T.c(),T.m(f.parentNode,f)):T&&(T.d(1),T=null),q[1]&&V.p(q,et)},i(q){g||(transition_in(V),g=!0)},o(q){transition_out(V),g=!1},d(q){T&&T.d(q),q&&detach(f),V&&V.d(q),q&&detach(z)}}}function instance(at,f,z){let{data:g}=f;const T=g.document,V=g.documentUrl;function q(et,I){sendMessage({role:"user",content:et},{useStreaming:I,documentId:T.id})}return beforeNavigate(resetAll),at.$$set=et=>{"data"in et&&z(0,g=et.data)},[g,T,V,q]}class Page extends SvelteComponent{constructor(f){super(),init(this,f,instance,create_fragment,safe_not_equal,{data:0})}}export{Page as component,_page as universal};
